<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <title>CCC Request Form</title>
    <link rel="shortcut icon" href="/favicon.ico">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!-- Bootstrap DatePicker -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker3.min.css"
        integrity="sha256-FAOaXTpl90/K8cXmSdsskbQN3nKYulhCpPbcFzGTWKI=" crossorigin="anonymous" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Editable CSS -->
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.css" />
    <link type="text/css" rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.min.css" />
    <!-- jQuery Toast -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        .jsgrid-cell {
            word-wrap: break-word;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-light bg-light navbar-fixed-top">
        <ul class="nav navbar-nav">
            <a class="navbar-brand" href="#">
                <img src="images/genesys.png" width="30" height="30" class="d-inline-block align-top" alt="">
                Cloud Competency Center Request Form
            </a>
        </ul>
        <ul>
            <ul class="nav navbar-nav" style="float: right">
                <li><a href="./index.html" class="admin btn btn-primary ml-2">Submit a new Request</a></li>
            </ul>
            <ul class="nav navbar-nav" style="float: right">
                <li><button id="refresh" class="admin btn btn-secondary"><em class="fa fa-refresh"></em></button></li>
            </ul>
        </ul>
    </nav>

    <div class="col-12 admin">
        <div id="basicgrid"></div>
    </div>

    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header" id="modal-header">
                    <h5 id="title" class="modal-title">Request</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form class="modal-body form-horizontal" id="modal-form">
                    <div class="form-group">

                        <form id="modal-form">
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="id">Id</label>
                                    <input type="text" class="form-control" id="id" name="id" disabled>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-5">
                                    <label for="region">Region</label>
                                    <select id="region" name="region" class="form-control" required>
                                        <option value="" disabled selected>Select a Region</option>
                                        <option value="APAC">APAC</option>
                                        <option value="EMEA">EMEA</option>
                                        <option value="LATAM">LATAM</option>
                                        <option value="NA">North America</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-5">
                                    <label for="subRegion">Sub-Region</label>
                                    <select id="subRegion" name="subRegion" class="form-control" required>
                                        <option value="" disabled selected>Select a Sub-Region</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-5">
                                    <label for="product">Product</label>
                                    <select id="product" name="product" class="form-control" required>
                                        <option value="" disabled selected>Select a Product</option>
                                        <option value="Genesys Cloud">Genesys Cloud</option>
                                        <option value="Genesys Engage">Genesys Engage</option>
                                        <option value="Genesys Engage Cloud">Genesys Engage Cloud</option>
                                        <option value="PureConnect">PureConnect</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-5">
                                    <label for="requestType">Request Type</label>
                                    <select id="requestType" name="requestType" class="form-control" required>
                                        <option value="" disabled selected>Select a Request Type</option>
                                        <option value="Additional Privacy Support">Additional Privacy Support</option>
                                        <option value="Additional Security Support">Additional Security Support</option>
                                        <option value="Associate SC & AE Enablement">Associate SC & AE Enablement
                                        </option>
                                        <option value="Cloud Migrations">Cloud Migrations</option>
                                        <option value="Critical Situation Management">Critical Situation Management
                                        </option>
                                        <option value="End to End Partner Enablement">End to End Partner Enablement
                                        </option>
                                        <option value="Innovation (Custom Demos, Integrations, Beta Testing)">Innovation
                                            (Custom
                                            Demos,
                                            Integrations, Beta Testing)</option>
                                        <option value="Must Win/Strategic Opportunity Support">Must Win/Strategic
                                            Opportunity
                                            Support
                                        </option>
                                        <option value="Partner Enablement">Partner Enablement (Summits/Events/Webinars)
                                        </option>
                                        <option value="POCs & Pilots for Strategic Opportunities">POCs & Pilots for
                                            Strategic
                                            Opportunities</option>
                                        <option value="Technical Design/Architecture Review">Technical
                                            Design/Architecture
                                            Review
                                        </option>
                                        <option value="Test Drive">Test Drive</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-5">
                                    <label for="requesterName">Requester Name</label>
                                    <input type="text" class="form-control" id="requesterName" name="requesterName"
                                        placeholder="Your Name" required>
                                </div>
                                <div class="form-group col-md-5">
                                    <label for="requesterEmail">Requester Email</label>
                                    <input type="text" class="form-control" id="requesterEmail" name="requesterEmail"
                                        placeholder="Your Email Address" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-3">
                                    <label for="datepicker">Need Completed By</label>
                                    <div class="input-group date">
                                        <input type="text" id="datepicker" class="form-control" required />
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-10">
                                    <label for="description">Description</label>
                                    <textarea class="form-control" id="description" name="description"
                                        placeholder="Describe your request" required></textarea>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-10">
                                    <label for="partnerCustomerName">Partner and/or Customer Name</label>
                                    <input type="text" class="form-control" id="partnerCustomerName"
                                        name="partnerCustomerName" placeholder="Partner and/or Customer Name" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-10">
                                    <label for="salesforceAccountOpportunity">Salesforce Account / Opportunity
                                        URL</label>
                                    <input type="text" class="form-control" id="salesforceAccountOpportunity"
                                        name="salesforceAccountOpportunity"
                                        placeholder="Link to Salesforce opportunity or account" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-3">
                                    <label for="priority">Priority</label>
                                    <select id="priority" name="priority" class="form-control" required>
                                        <option value="" disabled selected>Select a Priority</option>
                                        <option value="Low">Low</option>
                                        <option value="Medium">Medium</option>
                                        <option value="High">High</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="status">Status</label>
                                    <select id="status" name="status" class="form-control" required>
                                        <option value="" disabled selected>Select a Status</option>
                                        <option value="Open">Open</option>
                                        <option value="On Hold">On Hold</option>
                                        <option value="Waiting On Additional Information">Waiting On Additional
                                            Information</option>
                                        <option value="Closed">Closed</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="programManager">Program Manager</label>
                                    <input type="text" class="form-control" id="programManager" name="programManager"
                                        placeholder="Program Manager" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <label id="bAcceptedRequest" hidden></label>
                                <div class="form-group col-md-8">
                                    <label id="lblAcceptedRejectedNotes" for="description">Accepted / Rejected
                                        Notes</label>
                                    <textarea class="form-control" id="txtAcceptedRejectedNotes" name="description"
                                        placeholder="Notes" required> </textarea>
                                </div>
                                <div class="form-group col-md-2">
                                    <label for="time">Time</label>
                                    <input type="number" class="form-control" id="time" name="time" placeholder="Hours"
                                        required>

                                </div>
                            </div>
                        </form>

                        <div class="modal-footer">

                            <button type="button" id="btnRejectRequest" class="btn btn-danger pull-left">Save and Reject</button>
                            <button type="button" id="btnAcceptRequest" class="btn btn-success pull-left">Save and Accept</button>
                            <button id="submit" type="submit" class="btn btn-primary pull-left">Save</button>
                            <button type="button" class="btn btn-secondary pull-right"
                                data-dismiss="modal">Close</button>

                        </div>
                </form>>
            </div>
        </div>
    </div>


    <noscript>You need to enable JavaScript to run this app.</noscript>
    <!-- Bootstrap core JavaScript-->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <!-- Core plugin JavaScript-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"
        integrity="sha256-4iQZ6BVL4qNKlQ27TExEhBN1HFPvAvAMbFavKKosSWQ=" crossorigin="anonymous"></script>
    <!-- Bootstrap DatePicker -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"
        integrity="sha256-bqVeqGdJ7h/lYPq6xrPv/YGzMEb6dNxlfiTUHSgRCp8=" crossorigin="anonymous"></script>
    <!-- Genesys Cloud -->
    <script src="https://sdk-cdn.mypurecloud.com/javascript/61.0.0/purecloud-platform-client-v2.min.js"></script>
    <!-- Editable -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js"></script>
    <!-- JQuery Validate -->
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/additional-methods.min.js"></script>
    <!-- jQuery Toast -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.js"></script>
    <!-- Our Scripts -->
    <script src="js/gc.js"></script>
    <script src="js/requests.js"></script>
    <script src="js/tools.js"></script>

    <script>

        let regions = {
            APAC: [
                "Asia", "Australia", "New Zeland"
            ],
            EMEA: [
                "Central", "North", "South"
            ],
            LATAM: [
                "Andean", "Brazil", "Mexico", "Southern-Cone"
            ],
            NA: [
                "Central", "Eastern", "Western"
            ]
        }

        let region = getUrlParameter("region");
        console.log('Region:', region);

        var requests = {
            loadData: function (filter) {
                return $.grep(this.requests, function (request) {
                    return (!filter.requesterName || request.requesterName.indexOf(filter.requesterName) > -1)
                        && (!filter.id || request.id.indexOf(filter.id) > -1)
                        && (!filter.product || request.product.indexOf(filter.product) > -1)
                        && (!filter.partnerCustomerName || request.partnerCustomerName.indexOf(filter.partnerCustomerName) > -1)
                        && (!filter.partnerCustomerName || request.partnerCustomerName.indexOf(filter.partnerCustomerName) > -1)
                        && (!filter.partnerCustomerName || request.partnerCustomerName.indexOf(filter.partnerCustomerName) > -1)
                        && (!filter.partnerCustomerName || request.partnerCustomerName.indexOf(filter.partnerCustomerName) > -1)
                        && (!filter.requesterEmail || request.requesterEmail.indexOf(filter.requesterEmail) > -1);
                });
            },
            updateItem: function (updatingRequest) { },
            deleteItem: function (deletingRequest) {
                var requestIndex = $.inArray(deletingRequest, this.requests);
                this.requests.splice(requestIndex, 1);
            }
        }

        $(function () {
            $("#datepicker").datepicker({
                daysOfWeekDisabled: "0,6",
                todayHighlight: true,
                autoclose: true,
                startDate: new Date()
            });
        });

        init();
        async function init() {
            var userInfo = await getMe();
            showRequests();
        }

        function initModal() {
            $("#editModal #id").val("");
            $("#editModal #region").val("");
            $("#editModal #region").change();
            $("#editModal #subRegion").val("");
            $("#editModal #product").val("");
            $("#editModal #requestType").val("");
            $("#editModal #requesterName").val("");
            $("#editModal #requesterEmail").val("");
            console.log('Clearing date...');
            $("#editModal #datepicker").datepicker('update', '');
            $("#editModal #description").val("");
            $("#editModal #partnerCustomerName").val("");
            $("#editModal #salesforceAccountOpportunity").val("");
            $("#editModal #priority").val("");
            $("#editModal #bAcceptedRequest").val("");
            $("#editModal #status").val("");
            $("#editModal #programManager").val("");
            $("#editModal #time").val("");
            $("#editModal #txtAcceptedRejectedNotes").val("");

        }

        async function loadRequests() {
            try {
                requests.requests = await getRequests(region)
                console.log('Requests:', requests.requests);
            } catch (error) {
                console.error(error);
            }
        }

        function refreshGrid() {
            $("#basicgrid").jsGrid("loadData")
        }

        $("#refresh").on("click", (e) => {
            e.preventDefault();
            refreshGrid();
        });

        function showRequests() {
            console.log('Showing requests...');
            try {

                jsGrid.setDefaults({ tableClass: "jsgrid-table table table-striped table-hover" });
                jsGrid.setDefaults("text", {
                    _createTextBox: function () {
                        return $("<input>").attr("type", "text").attr("class", "form-control input-sm")
                    }
                });
                jsGrid.setDefaults("number", {
                    _createTextBox: function () {
                        return $("<input>").attr("type", "number").attr("class", "form-control input-sm")
                    }
                });
                jsGrid.setDefaults("textarea", {
                    _createTextBox: function () {
                        return $("<input>").attr("type", "textarea").attr("class", "form-control")
                    }
                });
                jsGrid.setDefaults("control", {
                    _createGridButton: function (cls, tooltip, clickHandler) {
                        var grid = this._grid;
                        return $("<button>").addClass(this.buttonClass).addClass(cls).attr({
                            type: "button",
                            title: tooltip
                        }).on("click", function (e) {
                            clickHandler(grid, e)
                        })
                    }
                });
                jsGrid.setDefaults("select", {
                    _createSelect: function () {
                        var $result = $("<select>").attr("class", "form-control input-sm"),
                            valueField = this.valueField,
                            textField = this.textField,
                            selectedIndex = this.selectedIndex;
                        return $.each(this.items, function (index, item) {
                            var value = valueField ? item[valueField] : index,
                                text = textField ? item[textField] : item,
                                $option = $("<option>").attr("value", value).text(text).appendTo($result);
                            $option.prop("selected", selectedIndex === index)
                        }), $result
                    }
                });

                $("#basicgrid").jsGrid({
                    height: "100vh",
                    width: "100%",
                    filtering: true,
                    editing: false,
                    sorting: true,
                    paging: true,
                    autoload: true,
                    pageSize: 25,
                    pageButtonCount: 5,
                    loadIndication: true,
                    loadIndicationDelay: 500,
                    loadMessage: "Loading...",
                    loadShading: true,
                    autoload: true,
                    rowClick: function (args) {
                        showModal(args.item);
                    },
                    deleteItem: async function (deletingRequest) {
                        let r = confirm('Do you really want to delete this request?');
                        if (r) {
                            console.log('Deleting:', deletingRequest);
                            try {
                                await deleteRequest(deletingRequest.id);
                                refreshGrid();
                            } catch (error) {
                                console.error(error);
                                showMessage(error, true);
                            }
                        }
                    },
                    controller: {
                        loadData: function () {
                            return getRequests(region);
                        }
                    },
                    noDataContent: "No Requests",
                    fields: [
                        {
                            name: "id",
                            title: "Id",
                            type: "text",
                            width: "auto",
                            itemTemplate: function (value, item) {
                                return `<small>${value}</small>`;
                            }
                        }, {
                            name: "region",
                            title: "Region",
                            type: "text",
                            width: "auto"
                        }, {
                            name: "subRegion",
                            title: "Sub-Region",
                            type: "text",
                            width: "auto"
                        }, {
                            name: "product",
                            title: "Product",
                            type: "text",
                            width: "auto"
                        }, {
                            name: "requestType",
                            title: "Request Type",
                            type: "text",
                            width: "auto"
                        }, {
                            name: "requesterName",
                            title: "Requester Name",
                            type: "text",
                            width: "auto"
                        }, {
                            name: "needCompletedBy",
                            title: "Need Completed By",
                            type: "text",
                            itemTemplate: function (value, item) {
                                return `${moment.utc(value).fromNow()} (${moment.utc(value).calendar()})`;
                            },
                            width: "auto"
                        }, {
                            name: "partnerCustomerName",
                            title: "Partner or Customer Name",
                            type: "text",
                            width: "auto"
                        }, {
                            name: "salesforceAccountOpportunity",
                            title: "SF Account or Opportunity",
                            type: "text",
                            itemTemplate: function (value, item) {
                                return `<a href="${value}" target="_blank">${value}</a>`;
                            },
                            width: "auto"
                        }, {
                            name: "createdAt",
                            title: "Created",
                            type: "text",
                            itemTemplate: function (value, item) {
                                return `<small>${moment(value).fromNow()}</small>`;
                            },
                            width: "auto",
                            filtering: false
                        }, {
                            name: "updatedAt",
                            title: "Last Updated",
                            type: "text",
                            itemTemplate: function (value, item) {
                                return `<small>${moment(value).fromNow()}</small>`;
                            },
                            width: "auto",
                            filtering: false
                        }, {
                            type: "control",
                            editButton: false
                        }]
                });
            } catch (error) {
                console.error(error);
            }
        }

        function showModal(request) {
            console.log("Showing modal for:", request);
            if (request.acceptedRejected == "Accepted") {
                $("#modal-header").css('background', 'lightgreen');
                $("#btnAcceptRequest").prop('disabled', true);
                $("#btnRejectRequest").prop('disabled', false);
            }
            else if (request.acceptedRejected == "Rejected") {
                $("#modal-header").css('background', 'red');
                $("#btnAcceptRequest").prop('disabled', false);
                $("#btnRejectRequest").prop('disabled', true);
            } else {
                $("#btnAcceptRequest").prop('disabled', false);
                $("#btnRejectRequest").prop('disabled', false);
            }


            if (request.acceptedRejected)
                $("#editModal #title").text(`Request (${request.acceptedRejected})`)
            else
                $("#editModal #title").text(`Request (not handled)`);

            $("#editModal #id").val(request.id);
            $("#editModal #region").val(request.region);
            $("#editModal #region").change();
            $("#editModal #subRegion").val(request.subRegion);
            $("#editModal #product").val(request.product);
            $("#editModal #requestType").val(request.requestType);
            $("#editModal #requesterName").val(request.requesterName);
            $("#editModal #requesterEmail").val(request.requesterEmail);
            $("#editModal #datepicker").datepicker('update', new Date(request.needCompletedBy));
            $("#editModal #description").val(request.description);
            $("#editModal #partnerCustomerName").val(request.partnerCustomerName);
            $("#editModal #salesforceAccountOpportunity").val(request.salesforceAccountOpportunity);
            $("#editModal #priority").val(request.priority);
            $("#editModal #bAcceptedRequest").val(request.acceptedRejected);
            $("#editModal #status").val(request.status);
            $("#editModal #programManager").val(request.programManager);
            $("#editModal #time").val(request.time);
            $("#editModal #txtAcceptedRejectedNotes").val(request.acceptedRejectedNotes);
            $("#editModal").modal("show");
        }

        $("#editModal #region").on("change", () => {
            $("#editModal #subRegion").empty();
            if (!$("#editModal #region").val()) return;
            for (let subregion of regions[$("#editModal #region").val()]) {
                $("<option/>", { value: subregion }).text(subregion).appendTo("#editModal #subRegion");
            }
        });

        $('#editModal').on('shown.bs.modal', (e) => {
        });

        $('#editModal').on('hidden.bs.modal', async () => {
            refreshGrid();
            initModal();
        });

        $("#editModal #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success"
        });

        $("#btnAcceptRequest").on("click", async (e) => {
            $("#editModal #bAcceptedRequest").val("Accepted");
            $("#editModal #submit").click();

        });

        $("#btnRejectRequest").on("click", async (e) => {
            $("#editModal #bAcceptedRequest").val("Rejected");
            $("#editModal #submit").click();
        });



        $("#editModal #submit").on("click", async (e) => {
            e.preventDefault();
            if (!$("#modal-form").valid()) {
                showMessage("Missing or invalid fields", true);
                return;
            }

            let id = $("#editModal #id").val();
            let region = $("#editModal #region").val();
            let subRegion = $("#editModal #subRegion").val();
            let product = $("#editModal #product").val();
            let requestType = $("#editModal #requestType").val();
            let requesterName = $("#editModal #requesterName").val();
            let requesterEmail = $("#editModal #requesterEmail").val();
            let needCompletedBy = moment($("#datepicker").datepicker('getDate')).format("YYYY-MM-DDT00:00:00.000") + "Z";
            let description = $("#editModal #description").val();
            let partnerCustomerName = $("#editModal #partnerCustomerName").val();
            let salesforceAccountOpportunity = $("#editModal #salesforceAccountOpportunity").val();
            let priority = $("#editModal #priority").val();
            let acceptedRejected = $("#editModal #bAcceptedRequest").val();
            let acceptedRejectedNotes = $("#editModal #txtAcceptedRejectedNotes").val();
            let status = $("#editModal #status").val();
            let programManager = $("#editModal #programManager").val();
            let time = $("#editModal #time").val();

            if (acceptedRejectedNotes === "") acceptedRejectedNotes = "N/A";
            
            console.log(`Region: ${region}, subRegion: ${subRegion}, Product: ${product}, Request Type: ${requestType}, Requester Name: ${requesterName}, Requester Email: ${requesterEmail}, Need Completed By: ${needCompletedBy}, Description: ${description}, Partner or Customer Name: ${partnerCustomerName}, Salesforce Opportunity: ${salesforceAccountOpportunity}`);
            console.log(`Priority: ${priority}, Accepted/Rejected: ${acceptedRejected}, Status: ${status}, Program Manager: ${programManager}, Time: ${time}, AcceptedRejectedNotes: ${acceptedRejectedNotes}`);

            try {
                await putRequest(id, region, subRegion, product, requestType, requesterName, requesterEmail, needCompletedBy, description, partnerCustomerName, salesforceAccountOpportunity, priority, acceptedRejected, status, programManager, time, acceptedRejectedNotes);
                console.log('Success!');
                showMessage("Request updated. Thanks!");
                $("#editModal").modal("hide");
            } catch (error) {
                console.error(error);
                showMessage(error, true);
            }
        });

        function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
        };

    </script>

</body>

</html>