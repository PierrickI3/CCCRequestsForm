<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <title>CC PS Questionnaire</title>
    <link rel="shortcut icon" href="/favicon.ico">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Tempus Dominus -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/css/tempusdominus-bootstrap-4.min.css" />
    <!-- jQuery Toast -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.css" rel="stylesheet">
    <!-- Bootstrap Select -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
    <!-- jQuery UI Theme -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/flick/jquery-ui.css">
    <!-- JSGrid -->
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.css" />
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.min.css" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="./css/ps_questionnaire.css">



</head>

<body>
    <img class="overlay" src="./images/devmode.png" id="devModeImage" hidden alt="devMode" />
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand" href="#">
            <img src="images/genesys.png" width="30" height="30" class="d-inline-block align-top" alt="">
            <span class="badge badge-info mr-2">#ps</span>Rapid Response Questionnaire <small><span id="badgePill" class="badge badge-pill badge-warning"></span></small>
        </a>
        <ul class="mb-0">

            <ul class="nav navbar-nav" style="float: right;">
                <li><button id="exportCSV" onclick="exportCSV();" href="#" class="btn btn-dark btn-sm ml-2" disabled>Generate CSV</button></li>
            </ul>

            <ul class="nav navbar-nav" style="float: right;">
                <li><button id="saveDraft" href="#" onclick="saveDraft();" class="btn btn-primary btn-sm ml-2" disabled>Save draft</button></li>
            </ul>
        </ul>
    </nav>

    <div class="alert alert-danger fade show" role="alert" id="alert" hidden>
        <strong>Maintenance Alert</strong> This site is being updated. Please wait.
        <a class="btn btn-light" href="#" onclick="location.reload();"><i class="fa fa-refresh"></i> Refresh</a>
    </div>

    <div class="container-fluid mt-4">
        <div class="form-row">
            <div class="form-group col-md-12">
                <div id="status">

                </div>
                <center>
                    <div id="spinner" class="justify-content-center">
                        <div class="spinner-grow text-secondary" role="status">
                        </div>
                        <br>
                        <p id="spinner_message" class="text-secondary">loading...</p>
                    </div>

                    <div id="accordion">
                        <div class="card" id="divRequestDetails" hidden>
                            <div class="card-header card-header-top" id="headingOne">
                                <h5 class="mb-0">
                                    <button class="btn btn-outline-success collapsed" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                        Request details
                                    </button>
                                </h5>
                            </div>

                            <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                                <div class="card-body">
                                    <label id="requestDetails"></label>


                                </div>
                            </div>
                        </div>

                    </div>
                </center>

                <section id="mainForm" hidden>
                    <div class="row">
                        <div class="col-md-8 offset-md-2">
                            <div class="bd-example" data-example-id="">
                                <div id="accordion" role="tablist" aria-multiselectable="true">

                                    <!-- Organization Setup -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingOrgSetup">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOrg" aria-expanded="false" aria-controls="collapseOrg" class="collapsed">
                                                    <i class="fa fa-sitemap" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>Organization Setup</h3>
                                                    <p>First things first, let's define some basic information about the customer</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseOrg" class="collapse" role="tabpanel" aria-labelledby="headingOrgSetup" aria-expanded="false">
                                            <div class="card-block">
                                                <div class="form-group row">
                                                    <label for="companyName" class="col-sm-2 col-form-label">Company Name</label>
                                                    <div class="col-sm-10">
                                                        <input type="text" class="form-control" id="companyName" name="companyName" placeholder="Enter the name of the company">
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="genesysCloudRegion" class="col-sm-2 col-form-label">Genesys Cloud Region</label>
                                                    <div class="col-sm-10">
                                                        <select class="custom-select" id="genesysCloudRegion" name="genesysCloudRegion">
                                                            <option selected disabled>Select a Genesys Cloud Region</option>
                                                            <optgroup label="North America">
                                                                <option value="cac1.pure.cloud" disabled>cac1.pure.cloud - Canada</option>
                                                                <option value="mypurecloud.com">mypurecloud.com - East</option>
                                                                <option value="usw2.pure.cloud">usw2.pure.cloud - West</option>
                                                            </optgroup>
                                                            <optgroup label="EMEA">
                                                                <option value="euw2.pure.cloud" disabled>euw2.pure.cloud - UK</option>
                                                                <option value="mypurecloud.de">mypurecloud.de - Frankfurt</option>
                                                                <option value="mypurecloud.ie">mypurecloud.ie - Ireland</option>
                                                            </optgroup>
                                                            <optgroup label="APAC">
                                                                <option value="apne2.pure.cloud" disabled>apne2.pure.cloud - Seoul </option>
                                                                <option value="mypurecloud.com.au">mypurecloud.com.au - Australia/New Zealand </option>
                                                                <option value="mypurecloud.jp">mypurecloud.jp - Japan </option>
                                                            </optgroup>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="numberOfUsers" class="col-sm-2 col-form-label">Number of Users</label>
                                                    <div class="col-sm-10">
                                                        <input type="number" class="form-control" id="numberOfUsers" name="numberOfUsers" placeholder="Enter the number of users">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Locations -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingLocations">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseLocations" aria-expanded="false" aria-controls="collapseLocations" class="collapsed">
                                                    <i class="fa fa-globe" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>Locations</h3>
                                                    <p>Information about each location</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseLocations" class="collapse" role="tabpanel" aria-labelledby="headingLocations" aria-expanded="false">
                                            <div class="card-block">
                                                <button id="addLocation" class="btn btn-primary mb-2" type="button"><i class="fa fa-plus"></i> Add</button>
                                                <div id="jsGridLocations"></div>

                                                <div class="modal fade" id="editModalLocations" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title">Location</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">

                                                                    <div class="form-group row">
                                                                        <label for="locationName" class="col-sm-3 col-form-label">Location Name <span class="text-danger font-weight-bold">*</span></label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="locationName" name="locationName" placeholder="Enter the name of this location" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="streetAddress" class="col-sm-3 col-form-label">Street Address <span class="text-danger font-weight-bold">*</span></label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="streetAddress" name="streetAddress" placeholder="Enter the street address" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="city" class="col-sm-3 col-form-label">City <span class="text-danger font-weight-bold">*</span></label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="city" name="city" placeholder="Enter the name of the city for this location" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="state" class="col-sm-3 col-form-label">State</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="state" name="state" placeholder="(optional) Enter the name of the state for this location">
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="zipCode" class="col-sm-3 col-form-label">Zip Code <span class="text-danger font-weight-bold">*</span></label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="zipCode" name="zipCode" placeholder="Enter the zip code for this location" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="country" class="col-sm-3 col-form-label">Country <span class="text-danger font-weight-bold">*</span></label>
                                                                        <div class="col-sm-9">
                                                                            <select class="selectpicker" id="country" name="country" class="form-control" required data-live-search="true">
                                                                            </select>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="notes" class="col-sm-3 col-form-label">Notes</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="notes" name="notes" placeholder="(optional) Describe the location (e.g. Main HQ)">
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="emergencyNumber" class="col-sm-3 col-form-label">Emergency Number <span class="text-danger font-weight-bold">*</span></label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="emergencyNumber" name="emergencyNumber" placeholder="Enter the emergency phone number for this location" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="modal-footer">
                                                                        <button id="btnClose" type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                        <button id="submit" type="submit" class="btn btn-primary pull-left"><i class="fa fa-plus"></i> Add</button>
                                                                    </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Schedules -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingSchedules">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseSchedules" aria-expanded="false" aria-controls="collapseSchedules" class="collapsed">
                                                    <i class="fa fa-calendar-o" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>Schedules</h3>
                                                    <p>Set up schedules</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseSchedules" class="collapse" role="tabpanel" aria-labelledby="headingSchedules" aria-expanded="false">
                                            <div class="card-block">
                                                <button id="addSchedule" class="btn btn-primary mb-2" type="button"><i class="fa fa-plus"></i> Add</button>
                                                <div id="jsGridSchedules"></div>

                                                <div class="modal fade" id="editModalSchedules" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title">Schedule</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">

                                                                    <div class="form-group row">
                                                                        <label for="scheduleName" class="col-sm-3 col-form-label">Schedule Name</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="scheduleName" name="scheduleName" placeholder="Enter the name of this schedule (e.g. Open Hours Weekday)" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-check row">
                                                                        <div class="form-group col-md-12">
                                                                            <input class="form-check-input" type="checkbox" value="" id="repeatingEvent">
                                                                            <label class="form-check-label" for="repeatingEvent">
                                                                                Repeating event
                                                                            </label>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Repeating Event -->
                                                                    <div id="repeatingEventDiv" style="display: none;">
                                                                        <div class="form-group row">
                                                                            <label for="interval" class="col-sm-3 col-form-label">Repeats every</label>
                                                                            <div class="col-sm-9 row">
                                                                                <input type="number" class="form-control col-md-3" id="interval" name="interval" value="1" min="1" required>
                                                                                <select id="recurrenceType" name="recurrenceType" class="form-control col-md-3 ml-1" required>
                                                                                    <option value="" disabled>Frequency</option>
                                                                                    <option value="Daily">Day</option>
                                                                                    <option value="Weekly">Week</option>
                                                                                    <option value="Monthly">Month</option>
                                                                                    <option value="Yearly">Year</option>
                                                                                </select>
                                                                                <div id="yearMonth" class="col-md-3" style="display: none;">
                                                                                    <select name="yearMonthSelect" id="yearMonthSelect" class="form-control" required>
                                                                                        <option value="" selected>Month</option>
                                                                                        <option value="1">January</option>
                                                                                        <option value="2">February</option>
                                                                                        <option value="3">March</option>
                                                                                        <option value="4">April</option>
                                                                                        <option value="5">May</option>
                                                                                        <option value="6">June</option>
                                                                                        <option value="7">July</option>
                                                                                        <option value="8">August</option>
                                                                                        <option value="9">September</option>
                                                                                        <option value="10">October</option>
                                                                                        <option value="11">November</option>
                                                                                        <option value="12">December</option>
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <!-- Weekly -->
                                                                        <div class="form-group row" id="weeklyControlsDiv" style="display: none;">
                                                                            <label for="weeklyDays" class="col-sm-2 offset-sm-3 col-form-label">Every</label>
                                                                            <div class="btn-group" data-toggle="buttons" id="weeklyDays">
                                                                                <label class="btn btn-primary active"><input type="checkbox" id="chkMonday" checked> Mo</label>
                                                                                <label class="btn btn-primary"><input type="checkbox" id="chkTuesday"> Tu</label>
                                                                                <label class="btn btn-primary"><input type="checkbox" id="chkWednesday"> We</label>
                                                                                <label class="btn btn-primary"><input type="checkbox" id="chkThursday"> Th</label>
                                                                                <label class="btn btn-primary"><input type="checkbox" id="chkFriday"> Fr</label>
                                                                                <label class="btn btn-primary"><input type="checkbox" id="chkSaturday"> Sa</label>
                                                                                <label class="btn btn-primary"><input type="checkbox" id="chkSunday"> Su</label>
                                                                            </div>
                                                                        </div>

                                                                        <!-- Monthly -->
                                                                        <div class="form-group row" id="monthlyControlsDiv" style="display: none;">
                                                                            <div class="col-md-3"></div>
                                                                            <select name="monthlyRecurrenceType" id="monthlyRecurrenceType" class="form-control col-md-2 mr-1" required>
                                                                                <optgroup label="Date">
                                                                                    <option value="On" selected>On</option>
                                                                                </optgroup>
                                                                                <optgroup label="Day of the Week">
                                                                                    <option value="IfDayIs">If Day is</option>
                                                                                    <option value="First">First</option>
                                                                                    <option value="Second">Second</option>
                                                                                    <option value="Third">Third</option>
                                                                                    <option value="Fourth">Fourth</option>
                                                                                    <option value="Last">Last</option>
                                                                                </optgroup>
                                                                            </select>

                                                                            <div class="col-md-6 row" id="byMonthDayDiv">
                                                                                <input type="text" class="form-control col-md-3" id="byMonthDay" name="byMonthDay" value="30" required data-toggle="tooltip" data-placement="top" title="Add a single day (e.g. 24) or mutliple days (e.g. 24,25,26)">
                                                                            </div>
                                                                            <div class="col-md-6 row" id="byDayDiv" style="display: none;">
                                                                                <div class="btn-group" data-toggle="buttons" id="byDay">
                                                                                    <label class="btn btn-primary active"><input type="checkbox" id="chkMonday" checked> Mo</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkTuesday"> Tu</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkWednesday"> We</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkThursday"> Th</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkFriday"> Fr</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkSaturday"> Sa</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkSunday"> Su</label>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <!-- Yearly -->
                                                                        <div class="form-group row" id="yearlyControlsDiv" style="display: none;">
                                                                            <div class="col-md-3"></div>
                                                                            <select name="yearlyRecurrenceType" id="yearlyRecurrenceType" class="form-control col-md-2 mr-1" required>
                                                                                <optgroup label="Date">
                                                                                    <option value="On" selected>On</option>
                                                                                </optgroup>
                                                                                <optgroup label="Day of the Week">
                                                                                    <option value="IfDayIs">If Day is</option>
                                                                                    <option value="First">First</option>
                                                                                    <option value="Second">Second</option>
                                                                                    <option value="Third">Third</option>
                                                                                    <option value="Fourth">Fourth</option>
                                                                                    <option value="Last">Last</option>
                                                                                </optgroup>
                                                                            </select>

                                                                            <div class="col-md-6 row" id="byYearDayDiv">
                                                                                <input type="text" class="form-control col-md-3" id="byYearDay" name="byYearDay" value="30" required data-toggle="tooltip" data-placement="top" title="Add a single day (e.g. 24) or mutliple days (e.g. 24,25,26)">
                                                                            </div>
                                                                            <div class="col-md-6 row" id="byDayDiv" style="display: none;">
                                                                                <div class="btn-group" data-toggle="buttons" id="byYearDay">
                                                                                    <label class="btn btn-primary active"><input type="checkbox" id="chkMonday" checked> Mo</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkTuesday"> Tu</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkWednesday"> We</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkThursday"> Th</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkFriday"> Fr</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkSaturday"> Sa</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkSunday"> Su</label>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                    </div>

                                                                    <!-- Single Event -->
                                                                    <div id="singleEventDiv">
                                                                    </div>

                                                                    <!-- All Day -->
                                                                    <div class="form-check row">
                                                                        <div class="form-group col-md-12">
                                                                            <input class="form-check-input" type="checkbox" value="" id="allDay">
                                                                            <label class="form-check-label" for="allDay">
                                                                                All Day
                                                                            </label>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Start Date -->
                                                                    <div class="form-group row date-row">
                                                                        <label class="col-sm-3 col-form-label">Start Date</label>
                                                                        <div class="input-group date col-md-3 date-only" id="startDate" data-target-input="nearest">
                                                                            <input type="text" class="form-control datetimepicker-input" data-target="#startDate" required />
                                                                            <div class="input-group-append" data-target="#startDate" data-toggle="datetimepicker">
                                                                                <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Start Time -->
                                                                    <div class="form-group row time-row">
                                                                        <label class="col-sm-3 col-form-label">Start Time</label>
                                                                        <div class="input-group date col-md-3 time-only" id="startTime" data-target-input="nearest">
                                                                            <input type="text" class="form-control datetimepicker-input" data-target="#startTime" />
                                                                            <div class="input-group-append" data-target="#startTime" data-toggle="datetimepicker">
                                                                                <div class="input-group-text"><i class="fa fa-clock-o"></i></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <!-- End Time -->
                                                                    <div class="form-group row time-row">
                                                                        <label class="col-sm-3 col-form-label">End Time</label>
                                                                        <div class="input-group date col-md-3 time-only" id="endTime" data-target-input="nearest">
                                                                            <input type="text" class="form-control datetimepicker-input" data-target="#endTime" />
                                                                            <div class="input-group-append" data-target="#endTime" data-toggle="datetimepicker">
                                                                                <div class="input-group-text"><i class="fa fa-clock-o"></i></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <!-- End Date -->
                                                                    <div class="form-group row date-row">
                                                                        <label class="col-sm-3 col-form-label">End Date</label>
                                                                        <div class="input-group date col-md-3 date-only" id="endDate" data-target-input="nearest">
                                                                            <input type="text" class="form-control datetimepicker-input" data-target="#endDate" />
                                                                            <div class="input-group-append" data-target="#endDate" data-toggle="datetimepicker">
                                                                                <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <!-- Footer -->
                                                                <div class="modal-footer">
                                                                    <code id="generatedRRuleCode"></code>
                                                                    <button id="generateRRule" type="button" class="btn btn-dark">Generate Rule</button>
                                                                    <button id="btnClose" type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                    <button id="submit" type="submit" class="btn btn-primary pull-left"><i class="fa fa-plus"></i> Add</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ACD Skills -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingSkils">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseSkills" aria-expanded="false" aria-controls="collapseSkills" class="collapsed">
                                                    <i class="fa fa-vcard-o" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>ACD Skills</h3>
                                                    <p>Information about ACD Skills</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseSkills" class="collapse" role="tabpanel" aria-labelledby="headingSkills" aria-expanded="false">
                                            <div class="card-block">
                                                <button id="addSkill" class="btn btn-primary mb-2" type="button"><i class="fa fa-plus"></i> Add</button>
                                                <div id="jsGridSkills"></div>

                                                <div class="modal fade" id="editModalSkills" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title">ACD Skill</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">

                                                                    <div class="form-group row">
                                                                        <label for="skillName" class="col-sm-3 col-form-label">Skill Name</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="skillName" tabindex="-1" name="skillName" placeholder="Enter the name of the Skill" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="modal-footer">
                                                                        <button id="btnClose" type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                        <button id="submit" type="submit" class="btn btn-primary pull-left"><i class="fa fa-plus"></i> Add</button>
                                                                    </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- WrapUp Codes -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingWrapUpCodes">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseWrapUpCodes" aria-expanded="false" aria-controls="collapseWrapUpCodes" class="collapsed">
                                                    <i class="fa fa-sticky-note-o" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>WrapUp Codes</h3>
                                                    <p>Information about WrapUp Codes</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseWrapUpCodes" class="collapse" role="tabpanel" aria-labelledby="headingWrapUpCodes" aria-expanded="false">
                                            <div class="card-block">
                                                <button id="addWrapUpCode" class="btn btn-primary mb-2" type="button"><i class="fa fa-plus"></i> Add</button>
                                                <div id="jsGridWrapUpCodes"></div>

                                                <div class="modal fade" id="editModalWrapUpCodes" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title">WrapUp Code Name</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">

                                                                    <div class="form-group row">
                                                                        <label for="wrapUpCode" class="col-sm-3 col-form-label">WrapUp Code Name</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="wrapUpCode" tabindex="-1" name="wrapUpCode" placeholder="Enter the name of the WrapUp Code" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="modal-footer">
                                                                        <button id="btnClose" type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                        <button id="submit" type="submit" class="btn btn-primary pull-left"><i class="fa fa-plus"></i> Add</button>
                                                                    </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Queues -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingSkils">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseQueues" aria-expanded="false" aria-controls="collapseQueues" class="collapsed">
                                                    <i class="fa fa-group" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>Queues</h3>
                                                    <p>Information about Queues</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseQueues" class="collapse" role="tabpanel" aria-labelledby="headingQueues" aria-expanded="false">
                                            <div class="card-block">
                                                <button id="addQueue" class="btn btn-primary mb-2" type="button"><i class="fa fa-plus"></i> Add</button>
                                                <div id="jsGridQueues"></div>

                                                <div class="modal fade" id="editModalQueues" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title">Queue setup</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">
                                                                    <!-- QueueName -->
                                                                    <div class="form-group row">
                                                                        <div class="form-group col-md-12">
                                                                            <label for="itInfrastructure">Queue Name <span class="text-danger font-weight-bold">*</span></label>
                                                                            <input type="text" class="form-control" id="queueName" name="queueName" placeholder="Enter the name of the Queue" required></input>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Support MediaTypes -->
                                                                    <div class="form-group row">
                                                                        <div class="form-group col-md-6">
                                                                            <input class="col-form-input" type="checkbox" value="" id="enableCallbacks">
                                                                            <label class="form-check-label" for="enableCallbacks">
                                                                                Supports Callbacks?
                                                                            </label>
                                                                        </div>
                                                                        <div class="form-group col-md-6">
                                                                            <input class="col-form-input" type="checkbox" value="" id="enableEmails">
                                                                            <label class="form-check-label" for="enableEmails">
                                                                                Supports Emails?
                                                                            </label>
                                                                        </div>
                                                                    </div>

                                                                    <p>
                                                                        <center>
                                                                            <a class="btn btn-dark" data-toggle="collapse" href="#queueAdvancedSettings" role="button" aria-expanded="false" aria-controls="queueAdvancedSettings">Advanced Settings</a>
                                                                        </center>
                                                                    </p>
                                                                    <div class="row">
                                                                        <div class="col">
                                                                            <div class="collapse collapse" id="queueAdvancedSettings">
                                                                                <div class="card card-body">

                                                                                    <!-- Pre-filled values -->
                                                                                    <div class="form-group row">
                                                                                        <div class="form-group col-md-6">
                                                                                            <label for="acw">ACW Type</label>
                                                                                            <select id="acw" name="acw" class="form-control" required>
                                                                                                <option value="MANDATORY, OPTIONAL" selected>MANDATORY, OPTIONAL</option>
                                                                                                <option value="MANDATORY_TIMEOUT">MANDATORY_TIMEOUT</option>
                                                                                                <option value="MANDATORY_FORCED_TIMEOUT">MANDATORY_FORCED_TIMEOUT</option>
                                                                                            </select>
                                                                                        </div>
                                                                                        <div class="form-group col-md-4">
                                                                                            <label for="acwTimeout">ACW Timeout</label>
                                                                                            <input type="number" class="form-control" id="acwTimeout" name="acwTimeout" placeholder="ACW Timeout" disabled>
                                                                                        </div>
                                                                                    </div>

                                                                                    <div class="form-group row">
                                                                                        <div class="form-group col-md-6">
                                                                                            <label for="evaluationMethod">Evaluation Method</label>
                                                                                            <select id="evaluationMethod" name="evaluationMethod" class="form-control" required>
                                                                                                <option value="NONE" selected>NONE</option>
                                                                                                <option value="BEST">BEST</option>
                                                                                                <option value="ALL">ALL</option>
                                                                                            </select>
                                                                                        </div>
                                                                                        <div class="form-group col-md-4">
                                                                                            <label for="alertingTimeout">Alerting Timeout</label>
                                                                                            <input type="number" class="form-control" id="alertingTimeout" name="alertingTimeout" placeholder="Alerting Timeout" value="15">
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="form-group row">
                                                                                        <div class="form-group col-md-6">
                                                                                            <label for="slPercentage">Service Level Percentage</label>
                                                                                            <input type="number" class="form-control" id="slPercentage" name="slPercentage" placeholder="SL Timeout" value="80">
                                                                                        </div>
                                                                                        <div class="form-group col-md-4">
                                                                                            <label for="slDuration">Service Level Target</label>
                                                                                            <input type="number" class="form-control" id="slDuration" name="slDuration" placeholder="SL Duration in Seconds" value="20">
                                                                                        </div>
                                                                                    </div>

                                                                                    <div class="form-group row">
                                                                                        <div class="form-group col-md-6">
                                                                                            <label for="callingPartyName">Calling Party Name</label>
                                                                                            <input type="text" class="form-control" id="callingPartyName" name="callingPartyName" placeholder="Calling Party Name"></input>

                                                                                        </div>
                                                                                        <div class="form-group col-md-6">
                                                                                            <label for="callingPartyNumber">Calling Party Number</label>
                                                                                            <input type="text" class="form-control" id="callingPartyNumber" name="callingPartyNumber" placeholder="Calling Party Name"></input>
                                                                                        </div>
                                                                                    </div>

                                                                                    <div class="form-group row">
                                                                                        <div class="form-group col-md-12">
                                                                                            <label for="queueWrapUpCode">WrapUp Code</label>
                                                                                            <select class="selectpicker" id="queueWrapUpCode" name="queueWrapUpCode" class="form-control" multiple data-live-search="true">
                                                                                            </select>

                                                                                        </div>

                                                                                    </div>



                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>



                                                                    <div class="modal-footer">
                                                                        <button id="btnClose" type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                        <button id="submit" type="submit" class="btn btn-primary pull-left"><i class="fa fa-plus"></i> Add</button>
                                                                    </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>



    <noscript>You need to enable JavaScript to run this app.</noscript>

    <!--#region Imports -->

    <!-- Bootstrap core JavaScript-->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <!-- Core plugin JavaScript-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js" integrity="sha256-4iQZ6BVL4qNKlQ27TExEhBN1HFPvAvAMbFavKKosSWQ=" crossorigin="anonymous"></script>
    <!-- Tempus Dominus -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
    <!-- Genesys Cloud -->
    <script src="https://sdk-cdn.mypurecloud.com/javascript/61.0.0/purecloud-platform-client-v2.min.js"></script>
    <!-- JQuery Validate -->
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/additional-methods.min.js"></script>
    <!-- jQuery Toast -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.js"></script>
    <!-- Bootbox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.4.0/bootbox.min.js"></script>
    <!-- jQuery UI -->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <!-- Bootstrap Select -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>
    <!-- Bootstrap Select -->

    <!-- JSGrid -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js"></script>
    <!-- RRule Generator -->
    <script src="./js/rrule.min.js"></script>
    <!-- Our Scripts -->
    <script src="js/gc.js"></script>
    <script src="js/requests.js"></script>
    <script src="js/tools.js"></script>
    <!-- Dictionary -->
    <script src="js/dictionary.js"></script>


    <!--#endregion -->

    <script>
        let gcToken, id = getUrlParameter("id"), request, caItem = {}, searches = {}, searchesSchedules = {};

        init();

        async function init() {
            console.log('function init');
            $('#spinner_message')[0].innerHTML = "login to Genesys Cloud...";

            // Init Date/Time Pickers
            $('.date-only').datetimepicker({
                format: 'L'
            });
            $('.time-only').datetimepicker({
                format: 'LT'
            });

            // Enable tooltips
            $('[data-toggle="tooltip"]').tooltip();

            $.each(countries, (i, country) => {
                $("<option/>", { value: country.name }).text(country.name).appendTo("#country");
            });

            document.getElementById("spinner").style.display = "block";
            try {
                await getMe();
                if (!maintenanceMode) $("#submit").attr('disabled', false);
            } catch (error) {
                console.error(error);
                showMessage(error.hasOwnProperty('message') ? error.message : `Unable to login to Genesys Cloud ${JSON.stringify(error)}`, true);
                return
            } finally {
                document.getElementById("spinner").style.display = "none";
            }

            gcToken = userInfo.token
            localStorage.setItem("gcToken", gcToken);
            localStorage.setItem("userName", userInfo.name);

            if (id) {
                console.log(`found id ${id} in path, check for rapidRequest and draft version...`);
                document.getElementById("spinner").style.display = "block";
                // Try to load #rapidresponse request
                try {
                    $('#spinner_message')[0].innerHTML = "validating Id...";
                    request = await getRequest(id);
                    console.log(request);
                    $('#badgePill')[0].innerHTML = "1";
                    console.log(request);
                    $('#requestDetails')[0].innerHTML = `Related to Partner/Customer Name <B>${request.partnerCustomerName}</B> requested by <em>${request.requesterName}</em>`;
                } catch (error) {
                    console.error(error);
                    if (error.status !== 404) {
                        document.getElementById("spinner").style.display = "none";
                        showMessage(JSON.stringify(error), true);
                        return;
                    }
                }

                // Try to load latest draft
                try {
                    $('#spinner_message')[0].innerHTML = "check for latest draft...";
                    console.log('check for draft questionnaire...');
                    caItem = await ca_getItem(id);
                    console.log(caItem);
                } catch (error) {
                    console.log(error);
                    if (error.status !== 404) {
                        document.getElementById("spinner").style.display = "none";
                        showMessage(JSON.stringify(error), true);
                        return;
                    }
                }
                document.getElementById("spinner").style.display = "none";

                if (!request && !caItem) {
                    showMessage("Provided requestId doesn't exist", true);
                    return;
                }
                if (request || caItem) {
                    loadDraftConfiguration();
                    enableForm(true);
                }

            } else {
                // New not related RequestForm                
                $('#badgePill')[0].innerHTML = "NEW";
                enableForm(true);

                initLocationsGrid();
                initSchedulesGrid();
                initSkillsGrid();
                initWrapUpCodesGrid();
                initQueuesGrid();
            }
        }

        function enableForm(_bool) {
            $("#saveDraft").prop('disabled', !_bool);
            $("#exportCSV").prop('disabled', !_bool);
            $("#mainForm").attr("hidden", !_bool);
            if (request)
                $("#divRequestDetails").attr("hidden", !_bool);
        }

        function loadDraftConfiguration() {
            console.log('function loadDraftConfiguration');
            if (caItem) {
                // organization
                $('#companyName').val(caItem.organizationSetup.companyName);
                $('#genesysCloudRegion').val(caItem.organizationSetup.genesysCloudRegion);
                $('#numberOfUsers').val(caItem.organizationSetup.numberOfUsers);


                initLocationsGrid();
                initSchedulesGrid();
                initSkillsGrid();
                initWrapUpCodesGrid();
                initQueuesGrid();

                refreshWrapUpCodesDropDownForQueues();

            }
        }

        function buildJSON() {
            console.log('function buildJSON');
            let json = {
                organizationSetup: {},
                schedules: [],
                locations: [],
                skills: [],
                wrapUpCodes: [],
                queues: []
            };

            if ($('#companyName').val())
                json.organizationSetup.companyName = $('#companyName').val();
            if ($('#genesysCloudRegion').val())
                json.organizationSetup.genesysCloudRegion = $('#genesysCloudRegion').val();
            if ($('#numberOfUsers').val())
                json.organizationSetup.numberOfUsers = $('#numberOfUsers').val();

            if ($("#jsGridLocations").jsGrid("option", "data").length > 0) {
                $.each($("#jsGridLocations").jsGrid("option", "data"), (key, item) => {
                    json.locations.push({
                        locationName: item.locationName,
                        streetAddress: item.streetAddress,
                        city: item.city,
                        state: item.state,
                        zipCode: item.zipCode,
                        country: item.country,
                        notes: item.notes,
                        emergencyNumber: item.emergencyNumber
                    })
                });
            }
            if ($("#jsGridSchedules").jsGrid("option", "data").length > 0) {
                //TODO: Keep the order !
                json.schedules = $("#jsGridSchedules").jsGrid("option", "data");
            }

            if ($("#jsGridSkills").jsGrid("option", "data").length > 0)
                json.skills = $("#jsGridSkills").jsGrid("option", "data");
            if ($("#jsGridWrapUpCodes").jsGrid("option", "data").length > 0)
                json.wrapUpCodes = $("#jsGridWrapUpCodes").jsGrid("option", "data");
            if ($("#jsGridQueues").jsGrid("option", "data").length > 0) {
                $.each($("#jsGridQueues").jsGrid("option", "data"), (key, item) => {
                    json.queues.push({
                        queueName: item.queueName,
                        enableCallbacks: item.enableCallbacks,
                        enableEmails: item.enableEmails,
                        acw: item.acw,
                        acwTimeout: item.acwTimeout,
                        evaluationMethod: item.evaluationMethod,
                        alertingTimeout: item.alertingTimeout,
                        slPercentage: item.slPercentage,
                        slDuration: item.slDuration,
                        callingPartyName: item.callingPartyName,
                        callingPartyNumber: item.callingPartyNumber,
                        wrapUpCodes: item.wrapUpCodes
                    })
                });
            }

            console.log(json);
            return json;
        }

        async function saveDraft() {
            console.log('saveDraft()');

            // Disable button
            $("#saveDraft").prop('disabled', true);
            $("#saveDraft").html(
                `<span class="spinner-border-sm text-light" role="status" aria-hidden="true"></span> Please wait...`
            )

            try {
                let json = buildJSON();
                if (caItem && caItem.id) {
                    await ca_updateItem(caItem.id, json);
                } else {
                    caItem = await ca_createItem(json);
                    console.log(`responseId created on CA db: ${caItem.id}`);
                    window.history.pushState('', 'CC Rapid Response Request Form', `${window.location.href}?id=${caItem.id}`);
                    $('#badgePill')[0].innerHTML = "";
                }
            } catch (error) {
                console.error(error);
                showMessage("Failed to update draft item", JSON.stringify(error));
                return
            } finally {
                // Enable button
                $("#saveDraft").prop('disabled', false);
                $("#saveDraft").html('Save draft');
            }

            showMessage("Draft updated", false);
        }

        function exportCSV() {
            console.log('function exportCSV()');
            let data = $.extend(true, {}, buildJSON());


            const replacer = (key, value) => (value === null || value === 'n/a') ? '' : value // specify how you want to handle null values here
            let header, csv_locations, csv_skills, csv_wrapUpCodes, csv_queues;

            // Locations
            if (data.locations && data.locations.length > 0) {
                console.log('build locations csv...');
                header = Object.keys(data.locations[0]);
                csv_locations = data.locations.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(';'))
                csv_locations.unshift(header.join(';'))
                csv_locations = csv_locations.join('\r\n')
            } else {
                console.log('locations are empty, skip csv build...');
            }

            //$("#jsGridSkills").jsGrid("option", "fields") -> fields names
            // Skills
            if (data.skills && data.skills.length > 0) {
                console.log('build skills csv...');
                header = Object.keys(data.skills[0]);
                csv_skills = data.skills.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(';'))
                csv_skills.unshift(header.join(';'))
                csv_skills = csv_skills.join('\r\n')
            } else {
                console.log('skills are empty, skip csv build...');
            }

            // WrapUpCodes
            if (data.wrapUpCodes && data.wrapUpCodes.length > 0) {
                console.log('build wrapup-codes csv...');
                header = Object.keys(data.wrapUpCodes[0]);
                csv_wrapUpCodes = data.wrapUpCodes.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(';'))
                csv_wrapUpCodes.unshift(header.join(';'))
                csv_wrapUpCodes = csv_wrapUpCodes.join('\r\n')
            } else {
                console.log('wrapUp Codes are empty, skip csv build...');
            }

            // Queues
            if (data.queues && data.queues.length > 0) {
                console.log('build queues csv...');
                // tune queue columns
                data.queues.forEach(function (item) {
                    console.log(item);
                    delete item.enableCallbacks;
                    delete item.enableEmails;
                    if (item.wrapUpCodes && item.wrapUpCodes.length > 0)
                        item.wrapUpCodes = item.wrapUpCodes.join('|')
                    else
                        item.wrapUpCodes = "";
                });

                header = Object.keys(data.queues[0]);
                csv_queues = data.queues.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(';'))
                csv_queues.unshift(header.join(';'))
                csv_queues = csv_queues.join('\r\n')
            } else {
                console.log('queues are empty, skip csv build...');
            }

            console.log(`CSV: locations\n===================\n ${csv_locations}\n===================\n`);
            console.log(`CSV: skills\n===================\n ${csv_skills}\n===================\n`);
            console.log(`CSV: wrapUpCodes\n===================\n ${csv_wrapUpCodes}\n===================\n`);
            console.log(`CSV: queues\n===================\n ${csv_queues}\n===================\n`);

            //download(csv_locations, 'locations.csv');

        }

        function download(data, filename, type) {
            var file = new Blob([data], { type: type });
            if (window.navigator.msSaveOrOpenBlob) // IE10+
                window.navigator.msSaveOrOpenBlob(file, filename);
            else { // Others
                var a = document.createElement("a"),
                    url = URL.createObjectURL(file);
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                setTimeout(function () {
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                }, 0);
            }
        }

        jsGrid.setDefaults({ tableClass: "jsgrid-table table table-striped table-hover" });

        //#region Locations

        var dbLocations = {
            loadData: function (filter) {
                return $.grep(this.locations, function (location) {
                    return (!filter.locationName || location.locationName.toLowerCase().indexOf(filter.locationName.toLowerCase()) > -1)
                      
                });
            },
            insertItem: function (insertingLocation) {
                this.locations.push(insertingLocation);
            },
            updateItem: function (updatingLocation) { },
            deleteItem: function (deletingLocation) { }
        };

        window.dbLocations = dbLocations;

        var formSubmitHandlerLocations = $.noop;

        let validatorLocations = $("#editModalLocations #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerLocations();
            }
        });

        $("#addLocation").on('click', (e) => {
            e.preventDefault();
            showLocationsModal("Add", {});
        });

        function initLocationsGrid() {
            //console.log('caItem locations:', caItem.locations);
            dbLocations.locations = caItem.hasOwnProperty('locations') ? caItem.locations : [];

            $("#jsGridLocations").jsGrid({
                height: "auto",
                width: "100%",
                editing: true,
                autoload: true,
                sorting: false,
                filtering: false,
                paging: false,
                noDataContent: "No Locations",
                confirmDeleting: false,
                onError: function (args) {
                    console.error('Failed to load grid data:', args);
                    showMessage("An error occurred while loading your data", true);
                },
                rowClick: function (args) {
                    showLocationsModal("Edit", args.item);
                },
                onDataLoaded: function (args) {
                    $("#addLocation").attr('disabled', $("#jsGridLocations").jsGrid("option", "data").length >= 2);
                },
                onItemInserted: function (args) {
                    $("#addLocation").attr('disabled', $("#jsGridLocations").jsGrid("option", "data").length >= 2);
                },
                onItemUpdated: function (args) {
                    $("#addLocation").attr('disabled', $("#jsGridLocations").jsGrid("option", "data").length >= 2);
                },
                onItemDeleting: function (args) {
                    console.log("onItemDeleting");
                    if (!args.item.deleteConfirmed) { // custom property for confirmation
                        args.cancel = true; // cancel deleting
                        bootbox.confirm({
                            message: 'Do you really want to delete this location?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    args.item.deleteConfirmed = true;
                                    $("#jsGridLocations").jsGrid('deleteItem', args.item); // Remove item from grid
                                    removeFromArray(dbLocations.locations, args.item); // Remove item from db
                                    showMessage("Location deleted", false);
                                }
                            }
                        });
                    }
                },
                onItemDeleted: function (args) {
                    $("#addLocation").attr('disabled', $("#jsGridLocations").jsGrid("option", "data").length >= 2);
                },
                controller: dbLocations,
                fields: [
                    {
                        name: "locationName",
                        title: "Name",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searches.locationName = input.val();
                                $("#jsGridLocations").data('JSGrid').search(searches);
                            });
                            return this.filterControl = input;
                        }
                    },                    
                    {
                        name: "city",
                        title: "City",
                        type: "text",
                        align: "center"
                    },
                    {
                        name: "state",
                        title: "State",
                        type: "text",
                        align: "center",
                        itemTemplate: function (value, item) {
                            return value === 'n/a' ? '' : value
                        }
                    },
                    {
                        name: "country",
                        title: "Country",
                        type: "text",
                        align: "center"
                    },
                    {
                        type: "control",
                        modeSwitchButton: false,
                        editButton: false,
                        width: 68,
                        align: "center",
                        headerTemplate: function () {
                            return "Actions";
                        }
                    }
                ]
            });
        }

        var showLocationsModal = function (dialogType, item) {
            console.log('Showing details for:', item);
            $("#editModalLocations #locationName").val(item.locationName);
            $("#editModalLocations #streetAddress").val(item.streetAddress);
            $("#editModalLocations #city").val(item.city);
            $("#editModalLocations #state").val((item.state && item.state !== 'n/a') ? item.state : '');
            $("#editModalLocations #zipCode").val(item.zipCode);
            $("#editModalLocations #country").val(item.country);
            $("#editModalLocations #country").selectpicker('refresh');
            $("#editModalLocations #notes").val((item.notes && item.notes !== 'n/a') ? item.notes : '');
            $("#editModalLocations #emergencyNumber").val(item.emergencyNumber);
            $("#editModalLocations #submit").html("<i class='fa fa-floppy-o'></i> Save");
            formSubmitHandlerLocations = function () {
                saveLocation(item, dialogType === "Add");
            };
            $("#editModalLocations").modal('show');
        };

        var saveLocation = function (item, isNew) {
            console.log('Extending item:', item);
            $.extend(item, {
                locationName: $("#editModalLocations #locationName").val(),
                streetAddress: $("#editModalLocations #streetAddress").val(),
                city: $("#editModalLocations #city").val(),
                state: $("#editModalLocations #state").val() == "" ? 'n/a' : $("#editModalLocations #state").val(),                
                zipCode: $("#editModalLocations #zipCode").val(),
                country: $("#editModalLocations #country").val(),
                notes: $("#editModalLocations #notes").val()  == "" ? 'n/a' : $("#editModalLocations #notes").val(),                
                emergencyNumber: $("#editModalLocations #emergencyNumber").val(),
            });
            console.log('Extended Item:', item);
            console.log('IsNew?', isNew)
            $("#jsGridLocations").jsGrid(isNew ? "insertItem" : "updateItem", item);
            $("#editModalLocations").modal('hide');
        };

        $('#editModalLocations').on('hidden.bs.modal', async () => {
            initLocationsModal();
        });

        function initLocationsModal() {
            $("#editModalLocations #locationName").val("");
            $("#editModalLocations #streetAddress").val("");
            $("#editModalLocations #city").val("");
            $("#editModalLocations #state").val("");
            $("#editModalLocations #zipCode").val("");
            $("#editModalLocations #country").val("");
            $("#editModalLocations #country").selectpicker('refresh');
            $("#editModalLocations #notes").val("");
            $("#editModalLocations #emergencyNumber").val("");
            $("#editModalLocations #submit").html("<i class='fa fa-plus'></i> Add");

            validatorLocations.resetForm(); // Reset validation errors
        }

        //#endregion

        //#region Schedules

        var dbSchedules = {
            loadData: function (filter) {
                return $.grep(this.schedules, function (schedule) {
                    return (!filter.scheduleName || schedule.scheduleName.toLowerCase().indexOf(filter.scheduleName.toLowerCase()) > -1)
                        && (!filter.start || schedule.start.toLowerCase().indexOf(filter.start.toLowerCase()) > -1)
                        && (!filter.end || schedule.end.toLowerCase().indexOf(filter.end.toLowerCase()) > -1)
                        && (!filter.rrule || schedule.rrule.toLowerCase().indexOf(filter.rrule.toLowerCase()) > -1);
                });
            },
            insertItem: function (insertingItem) {
                this.schedules.push(insertingItem);
            },
            updateItem: function (updatingItem) { },
            deleteItem: function (deletingItem) { }
        };

        window.dbSchedules = dbSchedules;

        var formSubmitHandlerSchedules = $.noop;

        let validatorSchedules = $("#editModalSchedules #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerSchedules();
            }
        });

        $("#repeatingEvent").on('change', () => {
            if ($("#repeatingEvent").is(':checked')) {
                $("#repeatingEventDiv").show();
                $("#singleEventDiv").hide();
            } else {
                $("#repeatingEventDiv").hide();
                $("#singleEventDiv").show();
            }
        });

        $("#allDay").on('change', () => {
            if ($("#allDay").is(':checked')) {
                $(".time-row").hide();
            } else {
                $(".time-row").show();
            }
        });

        $("#recurrenceType").on('change', () => {
            let recurrenceType = $("#recurrenceType").val();
            switch (recurrenceType) {
                case "Daily":
                    $("#weeklyControlsDiv").hide();
                    $("#monthlyControlsDiv").hide();
                    $("#yearlyControlsDiv").hide();
                    $("#yearMonth").hide();
                    break;
                case "Weekly":
                    $("#weeklyControlsDiv").show();
                    $("#monthlyControlsDiv").hide();
                    $("#yearlyControlsDiv").hide();
                    $("#yearMonth").hide();
                    break;
                case "Monthly":
                    $("#weeklyControlsDiv").hide();
                    $("#monthlyControlsDiv").show();
                    $("#yearlyControlsDiv").hide();
                    $("#yearMonth").hide();
                    break;
                case "Yearly":
                    $("#weeklyControlsDiv").hide();
                    $("#monthlyControlsDiv").hide();
                    $("#yearlyControlsDiv").show();
                    $("#yearMonth").show();
                    break;

                default:
                    break;
            }
        });

        $("#monthlyRecurrenceType").on('change', () => {
            let monthlyRecurrenceType = $("#monthlyRecurrenceType").val();
            switch (monthlyRecurrenceType) {
                case "On":
                    $("#byMonthDayDiv").show();
                    $("#byDayDiv").hide();
                    break;
                default:
                    $("#byMonthDayDiv").hide();
                    $("#byDayDiv").show();
                    break;
            }
        });

        $("#yearlyRecurrenceType").on('change', () => {
            let yearlyRecurrenceType = $("#yearlyControlsDiv #yearlyRecurrenceType").val();
            switch (yearlyRecurrenceType) {
                case "On":
                    $("#yearlyControlsDiv #byYearDayDiv").show();
                    $("#yearlyControlsDiv #byDayDiv").hide();
                    break;
                default:
                    $("#yearlyControlsDiv #byYearDayDiv").hide();
                    $("#yearlyControlsDiv #byDayDiv").show();
                    break;
            }
        });

        $("#singleEventAllDay").on('change', () => {
            if ($("#singleEventAllDay").is(':checked')) {
                $(".time-row").hide();
            } else {
                $(".time-row").show();
            }
        });

        $("#addSchedule").on('click', (e) => {
            e.preventDefault();
            showSchedulesModal("Add", {});
        });

        function initSchedulesGrid() {
            dbSchedules.schedules = caItem.hasOwnProperty('schedules') ? caItem.schedules : [];

            $("#jsGridSchedules").jsGrid({
                height: "auto",
                width: "100%",
                editing: true,
                autoload: true,
                sorting: true,
                filtering: false,
                paging: false,
                noDataContent: "No Schedules",
                confirmDeleting: false,
                onError: function (args) {
                    console.error('Failed to load grid data:', args);
                    showMessage("An error occurred while loading your data", true);
                },
                rowClick: function (args) {
                    showSchedulesModal("Edit", args.item);
                },
                onDataLoaded: function (args) {
                    $("#addSchedule").attr('disabled', $("#jsGridSchedules").jsGrid("option", "data").length >= 2);
                },
                onItemInserted: function (args) {
                    $("#addSchedule").attr('disabled', $("#jsGridSchedules").jsGrid("option", "data").length >= 2);
                },
                onItemUpdated: function (args) {
                    $("#addSchedule").attr('disabled', $("#jsGridSchedules").jsGrid("option", "data").length >= 2);
                },
                onItemDeleting: function (args) {
                    console.log("onItemDeleting");
                    if (!args.item.deleteConfirmed) { // custom property for confirmation
                        args.cancel = true; // cancel deleting
                        bootbox.confirm({
                            message: 'Do you really want to delete this schedule?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    args.item.deleteConfirmed = true;
                                    $("#jsGridSchedules").jsGrid('deleteItem', args.item); // Remove item from grid
                                    removeFromArray(dbSchedules.schedules, args.item); // Remove item from db
                                    showMessage("Schedule deleted", false);
                                }
                            }
                        });
                    }
                },
                onItemDeleted: function (args) {
                    $("#addSchedule").attr('disabled', $("#jsGridSchedules").jsGrid("option", "data").length >= 2);
                },
                controller: dbSchedules,
                fields: [
                    {
                        name: "scheduleName",
                        title: "Name",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searchesSchedules.scheduleName = input.val();
                                $("#jsGridSchedules").data('JSGrid').search(searchesSchedules);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "start",
                        title: "Start Date/Time",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searchesSchedules.start = input.val();
                                $("#jsGridSchedules").data('JSGrid').search(searchesSchedules);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "end",
                        title: "Until",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searchesSchedules.end = input.val();
                                $("#jsGridSchedules").data('JSGrid').search(searchesSchedules);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "rrule",
                        title: "Recurrence Rule",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searchesSchedules.rrule = input.val();
                                $("#jsGridSchedules").data('JSGrid').search(searchesSchedules);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        type: "control",
                        modeSwitchButton: false,
                        editButton: false,
                        width: 68,
                        align: "center",
                        headerTemplate: function () {
                            return "Actions";
                        }
                    }
                ]
            });
        }

        var showSchedulesModal = function (dialogType, item) {
            console.log('Showing details for:', item);
            $("#editModalSchedules #scheduleName").val(item.scheduleName);
            $("#editModalSchedules #start").val(item.start);
            $("#editModalSchedules #end").val(item.end);
            $("#editModalSchedules #submit").html("<i class='fa fa-floppy-o'></i> Save");
            formSubmitHandlerSchedules = function () {
                saveSchedule(item, dialogType === "Add");
            };
            $("#editModalSchedules").modal('show');
        };

        var saveSchedule = function (item, isNew) {
            try {

                let newRRule = generateRRule();
                let newRRuleString = newRRule.toString();

                console.log('New RRule:', newRRule);
                console.log('New RRule String:', newRRuleString);

                console.log('Extending item:', item);

                $.extend(item, {
                    scheduleName: $("#editModalSchedules #scheduleName").val(),
                    start: newRRule.options.dtstart,
                    end: newRRule.options.until,
                    rrule: newRRuleString
                });
                console.log('Extended Item:', item);
                console.log('IsNew?', isNew)
                $("#jsGridSchedules").jsGrid(isNew ? "insertItem" : "updateItem", item);
                $("#editModalSchedules").modal('hide');
            } catch (error) {
                console.error(error);
                showMessage(error, true);
            }
        };

        $('#editModalSchedules').on('hidden.bs.modal', async () => {
            initSchedulesModal();
        });

        function initSchedulesModal() {
            $("#editModalSchedules #scheduleName").val("");

            // Repeating Event
            $("#editModalSchedules #repeatingEvent").prop('checked', false);
            $("#editModalSchedules #repeatingEvent").change();
            $("#editModalSchedules #interval").val(1);
            $("#editModalSchedules #recurrenceType").val('Daily');
            $("#editModalSchedules #yearMonth").val('');

            // Weekly
            $("#editModalSchedules #weeklyControlsDiv #chkMonday").prop('checked', true);
            $("#editModalSchedules #weeklyControlsDiv #chkTuesday").prop('checked', false);
            $("#editModalSchedules #weeklyControlsDiv #chkWednesday").prop('checked', false);
            $("#editModalSchedules #weeklyControlsDiv #chkThursday").prop('checked', false);
            $("#editModalSchedules #weeklyControlsDiv #chkFriday").prop('checked', false);
            $("#editModalSchedules #weeklyControlsDiv #chkSaturday").prop('checked', false);
            $("#editModalSchedules #weeklyControlsDiv #chkSunday").prop('checked', false);

            // Monthly
            $("#editModalSchedules #monthlyControlsDiv #monthlyRecurrenceType").val('On');
            $("#editModalSchedules #monthlyControlsDiv #byMonthDay").val('');
            $("#editModalSchedules #monthlyControlsDiv #byDayDiv #chkMonday").prop('checked', true);
            $("#editModalSchedules #monthlyControlsDiv #byDayDiv #chkTuesday").prop('checked', false);
            $("#editModalSchedules #monthlyControlsDiv #byDayDiv #chkWednesday").prop('checked', false);
            $("#editModalSchedules #monthlyControlsDiv #byDayDiv #chkThursday").prop('checked', false);
            $("#editModalSchedules #monthlyControlsDiv #byDayDiv #chkFriday").prop('checked', false);
            $("#editModalSchedules #monthlyControlsDiv #byDayDiv #chkSaturday").prop('checked', false);
            $("#editModalSchedules #monthlyControlsDiv #byDayDiv #chkSunday").prop('checked', false);

            // Yearly
            $("#editModalSchedules #yearlyControlsDiv #yearlyRecurrenceType").val('On');
            $("#editModalSchedules #yearlyControlsDiv #byMonthDay").val('');
            $("#editModalSchedules #yearlyControlsDiv #byYearDayDiv #chkMonday").prop('checked', true);
            $("#editModalSchedules #yearlyControlsDiv #byYearDayDiv #chkTuesday").prop('checked', false);
            $("#editModalSchedules #yearlyControlsDiv #byYearDayDiv #chkWednesday").prop('checked', false);
            $("#editModalSchedules #yearlyControlsDiv #byYearDayDiv #chkThursday").prop('checked', false);
            $("#editModalSchedules #yearlyControlsDiv #byYearDayDiv #chkFriday").prop('checked', false);
            $("#editModalSchedules #yearlyControlsDiv #byYearDayDiv #chkSaturday").prop('checked', false);
            $("#editModalSchedules #yearlyControlsDiv #byYearDayDiv #chkSunday").prop('checked', false);

            // All Day
            $("#editModalSchedules #allDay").prop('checked', false);
            $("#editModalSchedules #allDay").change();
            $("#editModalSchedules #startDate").datetimepicker('clear');
            $("#editModalSchedules #startTime").datetimepicker('clear');
            $("#editModalSchedules #endTime").datetimepicker('clear');
            $("#editModalSchedules #endDate").datetimepicker('clear');

            $("#editModalSchedules #submit").html("<i class='fa fa-plus'></i> Add");

            validatorSchedules.resetForm(); // Reset validation errors
        }

        //#region RRule

        function getAllEventsFromRRuleString(rruleString) {
            return new rrule.rrulestr(rruleString).all();
        }

        function generateRRule() {

            let recurrenceType = $("#editModalSchedules #recurrenceType").val();

            //#region Frequency

            let freq;
            if ($("#repeatingEvent").is(':checked')) {
                switch (recurrenceType) {
                    case "Daily":
                        freq = rrule.RRule.DAILY;
                        break;
                    case "Weekly":
                        freq = rrule.RRule.WEEKLY;
                        break;
                    case "Monthly":
                        freq = rrule.RRule.MONTHLY;
                        break;
                    case "Yearly":
                        freq = rrule.RRule.YEARLY;
                        break;
                    default:
                        console.error('Unsupported recurrence:', recurrenceType);
                        showMessage("Unsupported Recurrence: " + recurrenceType, true);
                        break;
                }
            }

            //#endregion

            //#region Interval

            let interval;
            if ($("#repeatingEvent").is(':checked')) {
                interval = $("#editModalSchedules #interval").val();
            }

            //#endregion

            //#region Date/Time Start/End

            let dtStart, until;

            // Is Start Date set?
            if ($('input[data-target="#startDate"]').val().length > 0) {
                dtStart = $("#startDate").datetimepicker('date');
            } else {
                dtStart = new Date(); // Today
            }

            // Is End Date set?
            if ($('input[data-target="#endDate"]').val().length > 0) {
                until = $("#endDate").datetimepicker('date') || null;
            }

            if ($("#allDay").is(':checked')) {
                // Set start time to 00:00:00
                console.log('Set start time to 12:00:00.000 AM');
                dtStart = dtStart.startOf('day');
                // dtStart.setHours(0);
                // dtStart.setMinutes(0);
                // dtStart.setSeconds(0);
                // dtStart.setMilliseconds(0);

                if (until) {
                    // Set until time to 23:59:59
                    console.log('Set end time to 23:59:59.999');
                    until = until.endOf('day');
                    // until.setHours(23);
                    // until.setMinutes(59);
                    // until.setSeconds(59);
                    // until.setMilliseconds(999);
                }
            } else {
                if ($('input[data-target="#startTime"]').val().length > 0) {
                    // Set start time with startTime field value
                    console.log("Set start time with startTime field value");
                    let startTime = $("#startTime").datetimepicker('date').toDate();
                    dtStart.hours(startTime.getHours());
                    dtStart.minutes(startTime.getMinutes());
                    dtStart.seconds(0);
                    dtStart.milliseconds(0);
                }

                if ($('input[data-target="#endTime"]').val().length > 0 && until) {
                    // Set end time with endTime field value
                    console.log("Set end time with endTime field value");
                    let endTime = $("#endTime").datetimepicker('date').toDate();
                    until.hours(endTime.getHours());
                    until.minutes(endTime.getMinutes());
                    until.seconds(0);
                    until.milliseconds(0);
                }
            }

            //#endregion

            //#region Weekly

            let byWeekDay = [];
            if (recurrenceType === "Weekly") {
                console.log('Weekly recurrence');
                if ($("#editModalSchedules #weeklyControlsDiv #chkMonday").is(':checked')) { byWeekDay.push(rrule.RRule.MO); }
                if ($("#editModalSchedules #weeklyControlsDiv #chkTuesday").is(':checked')) { byWeekDay.push(rrule.RRule.TU); }
                if ($("#editModalSchedules #weeklyControlsDiv #chkWednesday").is(':checked')) { byWeekDay.push(rrule.RRule.WE); }
                if ($("#editModalSchedules #weeklyControlsDiv #chkThursday").is(':checked')) { byWeekDay.push(rrule.RRule.TH); }
                if ($("#editModalSchedules #weeklyControlsDiv #chkFriday").is(':checked')) { byWeekDay.push(rrule.RRule.FR); }
                if ($("#editModalSchedules #weeklyControlsDiv #chkSaturday").is(':checked')) { byWeekDay.push(rrule.RRule.SA); }
                if ($("#editModalSchedules #weeklyControlsDiv #chkSunday").is(':checked')) { byWeekDay.push(rrule.RRule.SU); }
            }
            console.log('By Week Day:', byWeekDay);

            //#endregion

            //#region Monthly

            let byMonthDay = [], bySetPos;
            if (recurrenceType === "Monthly") {
                console.log('Monthly recurrence');
                let monthlyRecurrenceType = $("#editModalSchedules #monthlyControlsDiv #monthlyRecurrenceType").val();
                if (monthlyRecurrenceType === "On") {
                    byMonthDay.push($("#byMonthDay").val());
                } else {
                    console.log('Monthly Recurrence Type:', monthlyRecurrenceType);
                    switch (monthlyRecurrenceType) {
                        case "IfDayIs":
                            // Nothing to do here
                            break;
                        case "First":
                            bySetPos = [1]
                            break;
                        case "Second":
                            bySetPos = [2];
                            break;
                        case "Third":
                            bySetPos = [3];
                            break;
                        case "Fourth":
                            bySetPos = [4];
                            break;
                        case "Last":
                            bySetPos = [-1];
                            break;
                        default:
                            console.error("Unsupported monthly recurrence type:", monthlyRecurrenceType);
                            showMessage("Unsupported monthly recurrence type: " + monthlyRecurrenceType, true);
                            break;
                    }
                    if ($("#editModalSchedules #monthlyControlsDiv #chkMonday").is(':checked')) { byWeekDay.push(rrule.RRule.MO); }
                    if ($("#editModalSchedules #monthlyControlsDiv #chkTuesday").is(':checked')) { byWeekDay.push(rrule.RRule.TU); }
                    if ($("#editModalSchedules #monthlyControlsDiv #chkWednesday").is(':checked')) { byWeekDay.push(rrule.RRule.WE); }
                    if ($("#editModalSchedules #monthlyControlsDiv #chkThursday").is(':checked')) { byWeekDay.push(rrule.RRule.TH); }
                    if ($("#editModalSchedules #monthlyControlsDiv #chkFriday").is(':checked')) { byWeekDay.push(rrule.RRule.FR); }
                    if ($("#editModalSchedules #monthlyControlsDiv #chkSaturday").is(':checked')) { byWeekDay.push(rrule.RRule.SA); }
                    if ($("#editModalSchedules #monthlyControlsDiv #chkSunday").is(':checked')) { byWeekDay.push(rrule.RRule.SU); }
                }
            }

            //#endregion

            //#region Yearly

            let byMonth = [];
            if (recurrenceType === "Yearly") {
                console.log('Yearly recurrence');

                // Got a month?
                let yearMonthSelect = $("#editModalSchedules #yearMonthSelect").val();
                if (yearMonthSelect.length > 0) {
                    byMonth.push(parseInt(yearMonthSelect));
                }

                // Recurrence
                let yearlyRecurrenceType = $("#editModalSchedules #yearlyControlsDiv #yearlyRecurrenceType").val();
                if (yearlyRecurrenceType === "On") {
                    byMonthDay.push($("#byYearDay").val());
                } else {
                    console.log('Yearly Recurrence Type:', yearlyRecurrenceType);
                    switch (yearlyRecurrenceType) {
                        case "IfDayIs":
                            // Nothing to do here
                            break;
                        case "First":
                            bySetPos = [1]
                            break;
                        case "Second":
                            bySetPos = [2];
                            break;
                        case "Third":
                            bySetPos = [3];
                            break;
                        case "Fourth":
                            bySetPos = [4];
                            break;
                        case "Last":
                            bySetPos = [-1];
                            break;
                        default:
                            console.error("Unsupported monthly recurrence type:", monthlyRecurrenceType);
                            showMessage("Unsupported monthly recurrence type: " + monthlyRecurrenceType, true);
                            break;
                    }
                    if ($("#editModalSchedules #yearlyControlsDiv #chkMonday").is(':checked')) { byWeekDay.push(rrule.RRule.MO); }
                    if ($("#editModalSchedules #yearlyControlsDiv #chkTuesday").is(':checked')) { byWeekDay.push(rrule.RRule.TU); }
                    if ($("#editModalSchedules #yearlyControlsDiv #chkWednesday").is(':checked')) { byWeekDay.push(rrule.RRule.WE); }
                    if ($("#editModalSchedules #yearlyControlsDiv #chkThursday").is(':checked')) { byWeekDay.push(rrule.RRule.TH); }
                    if ($("#editModalSchedules #yearlyControlsDiv #chkFriday").is(':checked')) { byWeekDay.push(rrule.RRule.FR); }
                    if ($("#editModalSchedules #yearlyControlsDiv #chkSaturday").is(':checked')) { byWeekDay.push(rrule.RRule.SA); }
                    if ($("#editModalSchedules #yearlyControlsDiv #chkSunday").is(':checked')) { byWeekDay.push(rrule.RRule.SU); }
                }
            }

            //#endregion

            let rule = new rrule.RRule({
                freq: freq,
                interval: interval,
                dtstart: dtStart.toDate(),
                until: until.toDate(),
                byweekday: byWeekDay,
                bymonthday: byMonthDay,
                bysetpos: bySetPos,
                bymonth: byMonth
                //wkst: wkst,
                //count: count,
                //tzid: tzId,
                //bynmonthday: byNMonthDay,
                //byyearday: byYearDay,
                //byweekno: byWeekNo,
                //bynweekday: byNWeekDay,
                //byhour: byHour,
                //byminute: byMinute,
                //bysecond: bySecond,
                //byeaster: byEaster
            });
            console.log('Generated RRule:', rule);

            return rule;
        }

        $("#generateRRule").on('click', (e) => {
            e.preventDefault();
            let generatedRRuleCode = generateRRule().toString();
            console.log('Display RRule:', generatedRRuleCode);
            $("#generatedRRuleCode").text(generatedRRuleCode.toString());
        });

        //#endregion

        //#endregion

        //#region ACD Skills

        var dbSkills = {
            loadData: function (filter) {
                return $.grep(this.skills, function (skill) {
                    return (!filter.skillName || skill.skillName.toLowerCase().indexOf(filter.skillName.toLowerCase()) > -1);
                });
            },
            insertItem: function (insertingSkill) {
                this.skills.push(insertingSkill);
            },
            updateItem: function (updatingSkill) { },
            deleteItem: function (deletingSkill) { }
        };

        window.dbSkills = dbSkills;

        var formSubmitHandlerSkills = $.noop;

        let validatorSkills = $("#editModalSkills #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerSkills();
            }
        });

        $("#addSkill").on('click', (e) => {
            e.preventDefault();
            showSkillsModal("Add", {});
        });

        function initSkillsGrid() {
            const maxSkills = 10;

            dbSkills.skills = caItem.hasOwnProperty('skills') ? caItem.skills : [];

            $("#jsGridSkills").jsGrid({
                height: "auto",
                width: "100%",
                editing: true,
                autoload: true,
                sorting: false,
                filtering: false,
                paging: false,
                noDataContent: "No Skills",
                confirmDeleting: false,
                onError: function (args) {
                    console.error('Failed to load grid data:', args);
                    showMessage("An error occurred while loading your data", true);
                },
                rowClick: function (args) {
                    showSkillsModal("Edit", args.item);
                },
                onDataLoaded: function (args) {
                    $("#addSkill").attr('disabled', $("#jsGridSkills").jsGrid("option", "data").length >= maxSkills);
                },
                onItemInserted: function (args) {
                    $("#addSkill").attr('disabled', $("#jsGridSkills").jsGrid("option", "data").length >= maxSkills);
                },
                onItemUpdated: function (args) {
                    $("#addSkill").attr('disabled', $("#jsGridSkills").jsGrid("option", "data").length >= maxSkills);
                },
                onItemDeleting: function (args) {
                    console.log("onItemDeleting");
                    if (!args.item.deleteConfirmed) { // custom property for confirmation
                        args.cancel = true; // cancel deleting
                        bootbox.confirm({
                            message: 'Do you really want to delete this Skill?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    args.item.deleteConfirmed = true;
                                    $("#jsGridSkills").jsGrid('deleteItem', args.item); // Remove item from grid
                                    removeFromArray(dbSkills.skills, args.item); // Remove item from db
                                    showMessage("Skill deleted", false);
                                }
                            }
                        });
                    }
                },
                onItemDeleted: function (args) {
                    $("#addSkill").attr('disabled', $("#jsGridSkills").jsGrid("option", "data").length >= maxSkills);
                },
                controller: dbSkills,
                fields: [
                    {
                        name: "skillName",
                        title: "Name",
                        type: "text",
                        align: "center"
                    },
                    {
                        type: "control",
                        modeSwitchButton: false,
                        editButton: false,
                        width: 68,
                        align: "center",
                        headerTemplate: function () {
                            return "Actions";
                        }
                    }
                ]
            });
        }

        var showSkillsModal = function (dialogType, item) {
            console.log('Showing details for:', item);
            $("#editModalSkills #skillName").val(item.skillName);
            $("#editModalSkills #submit").html("<i class='fa fa-floppy-o'></i> Save");
            formSubmitHandlerSkills = function () {
                saveSkill(item, dialogType === "Add");
            };
            $("#editModalSkills").modal('show');

        };

        var saveSkill = function (item, isNew) {
            console.log('Extending item:', item);
            $.extend(item, {
                skillName: $("#editModalSkills #skillName").val()
            });
            console.log('Extended Item:', item);
            console.log('IsNew?', isNew)
            $("#jsGridSkills").jsGrid(isNew ? "insertItem" : "updateItem", item);
            $("#editModalSkills").modal('hide');
        };

        $("#editModalSkills").on('shown.bs.modal', function () {
            $("#skillName").focus();
        });

        $('#editModalSkills').on('hidden.bs.modal', async () => {
            initSkillsModal();
        });

        function initSkillsModal() {
            $("#editModalSkills #skillName").val("");
            $("#editModalSkills #submit").html("<i class='fa fa-plus'></i> Add");

            validatorSkills.resetForm(); // Reset validation errors
        }

        //#endregion

        //#region WrapUp Codes

        var dbWrapUpCodes = {
            loadData: function (filter) {
                return $.grep(this.wrapUpCodes, function (code) {
                    return (!filter.wrapUpCode || code.wrapUpCode.toLowerCase().indexOf(filter.wrapUpCode.toLowerCase()) > -1);
                });
            },
            insertItem: function (insertingWrapUpCode) {
                this.wrapUpCodes.push(insertingWrapUpCode);
            },
            updateItem: function (updatingWrapUpCode) { },
            deleteItem: function (deletingWrapUpCode) { }
        };

        window.dbWrapUpCodes = dbWrapUpCodes;

        var formSubmitHandlerWrapUpCodes = $.noop;

        let validatorWrapUpCodes = $("#editModalWrapUpCodes #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerWrapUpCodes();
            }
        });

        $("#addWrapUpCode").on('click', (e) => {
            e.preventDefault();
            showWrapUpCodesModal("Add", {});
        });

        function initWrapUpCodesGrid() {
            const maxItems = 10;

            dbWrapUpCodes.wrapUpCodes = caItem.hasOwnProperty('wrapUpCodes') ? caItem.wrapUpCodes : [];

            $("#jsGridWrapUpCodes").jsGrid({
                height: "auto",
                width: "100%",
                editing: true,
                autoload: true,
                sorting: false,
                filtering: false,
                paging: false,
                noDataContent: "No WrapUp Codes",
                confirmDeleting: false,
                onError: function (args) {
                    console.error('Failed to load grid data:', args);
                    showMessage("An error occurred while loading your data", true);
                },
                rowClick: function (args) {
                    showWrapUpCodesModal("Edit", args.item);
                },
                onDataLoaded: function (args) {
                    $("#addWrapUpCode").attr('disabled', $("#jsGridWrapUpCodes").jsGrid("option", "data").length >= maxItems);
                },
                onItemInserted: function (args) {
                    $("#addWrapUpCode").attr('disabled', $("#jsGridWrapUpCodes").jsGrid("option", "data").length >= maxItems);
                    refreshWrapUpCodesDropDownForQueues();
                },
                onItemUpdated: function (args) {
                    $("#addWrapUpCode").attr('disabled', $("#jsGridWrapUpCodes").jsGrid("option", "data").length >= maxItems);
                    refreshWrapUpCodesDropDownForQueues();
                },
                onItemDeleting: function (args) {
                    console.log("onItemDeleting");
                    if (!args.item.deleteConfirmed) { // custom property for confirmation
                        args.cancel = true; // cancel deleting
                        bootbox.confirm({
                            message: 'Do you really want to delete this WrapUp Code?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    args.item.deleteConfirmed = true;
                                    $("#jsGridWrapUpCodes").jsGrid('deleteItem', args.item); // Remove item from grid
                                    removeFromArray(dbWrapUpCodes.wrapUpCodes, args.item); // Remove item from db
                                    refreshWrapUpCodesDropDownForQueues();
                                    showMessage("WrapUp Code deleted", false);
                                }
                            }
                        });
                    }
                },
                onItemDeleted: function (args) {
                    $("#addWrapUpCode").attr('disabled', $("#jsGridWrapUpCodes").jsGrid("option", "data").length >= maxItems);
                },
                controller: dbWrapUpCodes,
                fields: [
                    {
                        name: "wrapUpCode",
                        title: "Name",
                        type: "text",
                        align: "center"
                    },
                    {
                        type: "control",
                        modeSwitchButton: false,
                        editButton: false,
                        width: 68,
                        align: "center",
                        headerTemplate: function () {
                            return "Actions";
                        }
                    }
                ]
            });
        }

        var showWrapUpCodesModal = function (dialogType, item) {
            console.log('Showing details for:', item);
            $("#editModalWrapUpCodes #wrapUpCode").val(item.wrapUpCode);
            $("#editModalWrapUpCodes #submit").html("<i class='fa fa-floppy-o'></i> Save");
            formSubmitHandlerWrapUpCodes = function () {
                saveWrapUpCode(item, dialogType === "Add");
            };
            $("#editModalWrapUpCodes").modal('show');

        };

        var saveWrapUpCode = function (item, isNew) {
            console.log('Extending item:', item);
            $.extend(item, {
                wrapUpCode: $("#editModalWrapUpCodes #wrapUpCode").val()
            });
            console.log('Extended Item:', item);
            console.log('IsNew?', isNew);

            $("#jsGridWrapUpCodes").jsGrid(isNew ? "insertItem" : "updateItem", item);
            $("#editModalWrapUpCodes").modal('hide');
        };

        $("#editModalWrapUpCodes").on('shown.bs.modal', function () {
            $("#wrapUpCode").focus();
        });

        $('#editModalWrapUpCodes').on('hidden.bs.modal', async () => {
            initWrapUpCodesModal();
        });

        function initWrapUpCodesModal() {
            $("#editModalWrapUpCodes #wrapUpCode").val("");
            $("#editModalWrapUpCodes #submit").html("<i class='fa fa-plus'></i> Add");

            validatorWrapUpCodes.resetForm(); // Reset validation errors
        }

        function refreshWrapUpCodesDropDownForQueues() {
            console.log('refreshWrapUpCodesDropDownForQueues()');
            $("#editModalQueues #queueWrapUpCode option").remove();

            if (dbWrapUpCodes.wrapUpCodes && dbWrapUpCodes.wrapUpCodes.length > 0) {
                $.each(dbWrapUpCodes.wrapUpCodes, (i, aItem) => {
                    console.log('wrapUpCodeName: ', aItem.wrapUpCode);
                    $("<option/>", { value: aItem.wrapUpCode }).text(aItem.wrapUpCode).appendTo("#editModalQueues #queueWrapUpCode");
                });
                $("#editModalQueues #queueWrapUpCode").selectpicker('refresh');
            } else {
                console.log('No WrapUp codes found...');
            }
        }

        //#endregion


        //#region Queues

        $("#queueWrapUpCode").selectpicker({
            width: '100%',
            selectedTextFormat: 'count > 3',
            title: "Select one or more WrapUp Codes"
        });


        var dbQueues = {
            loadData: function (filter) {
                return $.grep(this.queues, function (queue) {
                    return (!filter.queues || queue.queueName.toLowerCase().indexOf(filter.queueName.toLowerCase()) > -1);
                });
            },
            insertItem: function (insertingQueue) {
                this.queues.push(insertingQueue);
            },
            updateItem: function (updatingQueue) { },
            deleteItem: function (deletingQueue) { }
        };

        window.dbQueues = dbQueues;

        var formSubmitHandlerQueues = $.noop;

        let validatorQueues = $("#editModalQueues #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerQueues();
            }
        });


        $("#addQueue").on('click', (e) => {
            e.preventDefault();
            showQueuesModal("Add", {});
        });


        $("#editModalQueues #acw").on('change', (e) => {
            e.preventDefault();
            if ($("#editModalQueues #acw").val() !== "MANDATORY, OPTIONAL")
                $("#editModalQueues #acwTimeout").attr('disabled', false)
            else {
                $("#editModalQueues #acwTimeout").attr('disabled', true);
                $("#editModalQueues #acwTimeout").val('');
            }
        });

        function initQueuesGrid() {
            const maxItems = 3;

            dbQueues.queues = caItem.hasOwnProperty('queues') ? caItem.queues : [];

            $("#jsGridQueues").jsGrid({
                height: "auto",
                width: "100%",
                editing: true,
                autoload: true,
                sorting: true,
                filtering: false,
                paging: false,
                noDataContent: "No Queues",
                confirmDeleting: false,
                onError: function (args) {
                    console.error('Failed to load grid data:', args);
                    showMessage("An error occurred while loading your data", true);
                },
                rowClick: function (args) {

                    showQueuesModal("Edit", args.item);
                },
                onDataLoaded: function (args) {
                    $("#addQueue").attr('disabled', $("#jsGridQueues").jsGrid("option", "data").length >= maxItems);
                },
                onItemInserted: function (args) {
                    $("#addQueue").attr('disabled', $("#jsGridQueues").jsGrid("option", "data").length >= maxItems);
                },
                onItemUpdated: function (args) {
                    $("#addQueue").attr('disabled', $("#jsGridQueues").jsGrid("option", "data").length >= maxItems);
                },
                onItemDeleting: function (args) {
                    console.log("onItemDeleting");
                    if (!args.item.deleteConfirmed) { // custom property for confirmation
                        args.cancel = true; // cancel deleting
                        bootbox.confirm({
                            message: 'Do you really want to delete this Queue?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    args.item.deleteConfirmed = true;
                                    $("#jsGridQueues").jsGrid('deleteItem', args.item); // Remove item from grid
                                    removeFromArray(dbQueues.queues, args.item); // Remove item from db
                                    showMessage("Queue deleted", false);
                                }
                            }
                        });
                    }
                },
                onItemDeleted: function (args) {
                    $("#addQueue").attr('disabled', $("#jsGridQueues").jsGrid("option", "data").length >= maxItems);
                },

                controller: dbQueues,
                fields: [
                    {
                        name: "queueName",
                        title: "Queue Name",
                        type: "text",
                        align: "center"
                    },
                    {
                        name: "enableCallbacks",
                        title: "Supports Callbacks",
                        type: "text",
                        align: "center",
                        itemTemplate: function (value, item) {
                            return value ? '<span class="fa fa-check text-success"></span>' : ''
                        }
                    },
                    {
                        name: "enableEmails",
                        title: "Supports Emails",
                        type: "text",
                        align: "center",
                        itemTemplate: function (value, item) {
                            return value ? '<span class="fa fa-check text-success"></span>' : ''
                        }
                    },
                    {
                        type: "control",
                        modeSwitchButton: false,
                        editButton: false,
                        width: 68,
                        align: "center",
                        headerTemplate: function () {
                            return "Actions";
                        }
                    }
                ]
            });
        }

        var showQueuesModal = function (dialogType, item) {
            console.log('Showing details for:', item);
            $('#queueAdvancedSettings').collapse('hide');
            $("#editModalQueues #queueWrapUpCode").selectpicker('refresh');

            $("#editModalQueues #queueName").val(item.queueName);
            $("#editModalQueues #enableCallbacks").prop('checked', item.enableCallbacks);
            $("#editModalQueues #enableEmails").prop('checked', item.enableEmails);
            $("#editModalQueues #acw").val(item.acw ? item.acw : 'MANDATORY, OPTIONAL');
            $("#editModalQueues #acwTimeout").val((item.acwTimeout && item.acwTimeout !== 'n/a') ? item.acwTimeout : '');
            if ($("#editModalQueues #acw").val() !== "MANDATORY, OPTIONAL")
                $("#editModalQueues #acwTimeout").attr('disabled', false);
            else
                $("#editModalQueues #acwTimeout").attr('disabled', true);

            $("#editModalQueues #evaluationMethod").val(item.evaluationMethod ? item.evaluationMethod : 'NONE');
            $("#editModalQueues #alertingTimeout").val((item.alertingTimeout && item.alertingTimeout !== 'n/a') ? item.alertingTimeout : '15');
            $("#editModalQueues #slPercentage").val((item.slPercentage && item.slPercentage !== 'n/a') ? item.slPercentage : '80');
            $("#editModalQueues #slDuration").val(item.slDuration ? item.slDuration : '20');
            $("#editModalQueues #callingPartyName").val((item.callingPartyName && item.callingPartyName !== 'n/a') ? item.callingPartyName : undefined);
            $("#editModalQueues #callingPartyNumber").val((item.callingPartyNumber && item.callingPartyNumber !== 'n/a') ? item.callingPartyNumber : undefined);
            $("#editModalQueues #queueWrapUpCode").val(item.wrapUpCodes ? item.wrapUpCodes : undefined);
            $("#editModalQueues #queueWrapUpCode").selectpicker('refresh');

            $("#editModalQueues #submit").html("<i class='fa fa-floppy-o'></i> Save");
            formSubmitHandlerQueues = function () {
                saveQueue(item, dialogType === "Add");
            };
            $("#editModalQueues").modal('show');

        };

        var saveQueue = function (item, isNew) {
            console.log('Extending item:', item);
            $.extend(item, {
                queueName: $("#editModalQueues #queueName").val(),
                enableCallbacks: $("#editModalQueues #enableCallbacks").is(":checked"),
                enableEmails: $("#editModalQueues #enableEmails").is(":checked"),
                acw: $("#editModalQueues #acw").val(),
                acwTimeout: $("#editModalQueues #acwTimeout").val() == "" ? 'n/a' : $("#editModalQueues #acwTimeout").val(),
                evaluationMethod: $("#editModalQueues #evaluationMethod").val(),
                alertingTimeout: $("#editModalQueues #alertingTimeout").val() == "" ? '15' : $("#editModalQueues #alertingTimeout").val(),
                slPercentage: $("#editModalQueues #slPercentage").val() == "" ? '80' : $("#editModalQueues #slPercentage").val(),
                slDuration: $("#editModalQueues #slDuration").val() == "" ? '20' : $("#editModalQueues #slDuration").val(),
                callingPartyName: $("#editModalQueues #callingPartyName").val() == "" ? 'n/a' : $("#editModalQueues #callingPartyName").val(),
                callingPartyNumber: $("#editModalQueues #callingPartyNumber").val() == "" ? 'n/a' : $("#editModalQueues #callingPartyNumber").val(),
                wrapUpCodes: $("#editModalQueues #queueWrapUpCode").val()
            });
            console.log('Extended Item:', item);
            console.log('IsNew?', isNew)
            $("#jsGridQueues").jsGrid(isNew ? "insertItem" : "updateItem", item);
            $("#editModalQueues").modal('hide');
        };

        $("#editModalQueues").on('shown.bs.modal', function () {
            $("#queueName").focus();
        });

        $('#editModalQueues').on('hidden.bs.modal', async () => {
            initQueuesModal();
        });

        function initQueuesModal() {
            $("#editModalQueues #queueName").val("");
            $("#editModalQueues #enableCallbacks").prop('checked', false);
            $("#editModalQueues #enableEmails").prop('checked', false);
            $("#editModalQueues #submit").html("<i class='fa fa-plus'></i> Add");

            validatorQueues.resetForm(); // Reset validation errors
        }

        //#endregion

        //#region Other Useful Functions

        function removeFromArray(array, value) {
            let idx = array.indexOf(value);
            if (idx !== -1) {
                array.splice(idx, 1);
            }
            return array;
        }

        function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
        };

        //#endregion

    </script>

    <!--Coollabs -->
    <script async defer src="https://cdn.coollabs.io/save.js"></script>

</body>

</html>