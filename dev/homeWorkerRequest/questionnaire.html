<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <title>CC PS Questionnaire</title>
    <link rel="shortcut icon" href="/favicon.ico">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Tempus Dominus -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/css/tempusdominus-bootstrap-4.min.css" />
    <!-- jQuery Toast -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.css" rel="stylesheet">
    <!-- Bootstrap Select -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
    <!-- jQuery UI Theme -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/flick/jquery-ui.css">
    <!-- JSGrid -->
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.css" />
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.min.css" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="./css/ps_questionnaire.css">

</head>

<body>
    <img class="overlay" src="./images/devmode.png" id="devModeImage" hidden alt="devMode" />
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand" href="#">
            <img src="images/genesys.png" width="30" height="30" class="d-inline-block align-top" alt="">
            <span class="badge badge-info mr-2">#ps</span>Rapid Response Questionnaire <small><span id="badgePill" class="badge badge-pill badge-warning"></span></small>
        </a>
        <ul class="mb-0">

            <ul class="nav navbar-nav" style="float: right;">
                <li><button id="exportCSV" onclick="exportCSV();" href="#" class="btn btn-dark btn-sm ml-2" disabled>Generate CSV</button></li>
            </ul>

            <ul class="nav navbar-nav" style="float: right;">
                <li><button id="saveDraft" href="#" onclick="saveDraft();" class="btn btn-primary btn-sm ml-2" disabled>Save draft</button></li>
            </ul>


        </ul>

    </nav>

    <div class="alert alert-danger fade show" role="alert" id="alert" hidden>
        <strong>Maintenance Alert</strong> This site is being updated. Please wait.
        <a class="btn btn-light" href="#" onclick="location.reload();"><i class="fa fa-refresh"></i> Refresh</a>
    </div>

    <div class="container-fluid mt-4">
        <div class="form-row">
            <div class="form-group col-md-12">
                <div id="status">

                </div>
                <center>
                    <div id="spinner" class="justify-content-center">
                        <div class="spinner-grow text-secondary" role="status">
                        </div>
                        <br>
                        <p id="spinner_message" class="text-secondary">loading...</p>
                    </div>

                    <div id="accordion">
                        <div class="card" id="divRequestDetails" hidden>
                            <div class="card-header card-header-top" id="headingOne">
                                <h5 class="mb-0">
                                    <button class="btn btn-outline-success collapsed" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                        Request details
                                    </button>
                                </h5>
                            </div>

                            <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                                <div class="card-body">
                                    <label id="requestDetails"></label>


                                </div>
                            </div>
                        </div>

                    </div>
                </center>

                <section id="mainForm" hidden>
                    <div class="row">
                        <div class="col-md-8 offset-md-2">
                            <div class="bd-example" data-example-id="">
                                <div id="accordion" role="tablist" aria-multiselectable="true">

                                    <!-- Organization Setup -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingOrgSetup">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOrg" aria-expanded="false" aria-controls="collapseOrg" class="collapsed">
                                                    <i class="fa fa-sitemap" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>Organization Setup</h3>
                                                    <p>First things first, let's define some basic information about the customer</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseOrg" class="collapse" role="tabpanel" aria-labelledby="headingOrgSetup" aria-expanded="false">
                                            <div class="card-block">
                                                <div class="form-group row">
                                                    <label for="companyName" class="col-sm-2 col-form-label">Company Name</label>
                                                    <div class="col-sm-10">
                                                        <input type="text" class="form-control" id="companyName" name="companyName" placeholder="Enter the name of the company">
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="genesysCloudRegion" class="col-sm-2 col-form-label">Genesys Cloud Region</label>
                                                    <div class="col-sm-10">
                                                        <select class="custom-select" id="genesysCloudRegion" name="genesysCloudRegion">
                                                            <option selected disabled>Select a Genesys Cloud Region</option>
                                                            <optgroup label="North America">
                                                                <option value="cac1.pure.cloud" disabled>cac1.pure.cloud - Canada</option>
                                                                <option value="mypurecloud.com">mypurecloud.com - East</option>
                                                                <option value="usw2.pure.cloud">usw2.pure.cloud - West</option>
                                                            </optgroup>
                                                            <optgroup label="EMEA">
                                                                <option value="euw2.pure.cloud" disabled>euw2.pure.cloud - UK</option>
                                                                <option value="mypurecloud.de">mypurecloud.de - Frankfurt</option>
                                                                <option value="mypurecloud.ie">mypurecloud.ie - Ireland</option>
                                                            </optgroup>
                                                            <optgroup label="APAC">
                                                                <option value="apne2.pure.cloud" disabled>apne2.pure.cloud - Seoul </option>
                                                                <option value="mypurecloud.com.au">mypurecloud.com.au - Australia/New Zealand </option>
                                                                <option value="mypurecloud.jp">mypurecloud.jp - Japan </option>
                                                            </optgroup>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="numberOfUsers" class="col-sm-2 col-form-label">Number of Users</label>
                                                    <div class="col-sm-10">
                                                        <input type="number" class="form-control" id="numberOfUsers" name="numberOfUsers" placeholder="Enter the number of users">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Locations -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingLocations">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseLocations" aria-expanded="false" aria-controls="collapseLocations" class="collapsed">
                                                    <i class="fa fa-globe" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>Locations</h3>
                                                    <p>Information about each location</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseLocations" class="collapse" role="tabpanel" aria-labelledby="headingLocations" aria-expanded="false">
                                            <div class="card-block">
                                                <button id="addLocation" class="btn btn-primary mb-2" type="button"><i class="fa fa-plus"></i> Add</button>
                                                <div id="jsGridLocations"></div>

                                                <div class="modal fade" id="editModalLocations" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title">Location</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">

                                                                    <div class="form-group row">
                                                                        <label for="locationName" class="col-sm-3 col-form-label">Location Name</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="locationName" name="locationName" placeholder="Enter the name of this location" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="streetAddress" class="col-sm-3 col-form-label">Street Address</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="streetAddress" name="streetAddress" placeholder="Enter the street address" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="city" class="col-sm-3 col-form-label">City</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="city" name="city" placeholder="Enter the name of the city for this location" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="state" class="col-sm-3 col-form-label">State</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="state" name="state" placeholder="(optional) Enter the name of the state for this location">
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="zipCode" class="col-sm-3 col-form-label">Zip Code</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="zipCode" name="zipCode" placeholder="Enter the zip code for this location" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="country" class="col-sm-3 col-form-label">Country</label>
                                                                        <div class="col-sm-9">
                                                                            <select class="selectpicker" id="country" name="country" class="form-control" required data-live-search="true">
                                                                            </select>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="notes" class="col-sm-3 col-form-label">Notes</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="notes" name="notes" placeholder="(optional) Describe the location (e.g. Main HQ)">
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="emergencyNumber" class="col-sm-3 col-form-label">Emergency Number</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="emergencyNumber" name="emergencyNumber" placeholder="Enter the emergency phone number for this location" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="modal-footer">
                                                                        <button id="btnClose" type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                        <button id="submit" type="submit" class="btn btn-primary pull-left"><i class="fa fa-plus"></i> Add</button>
                                                                    </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Schedules -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingSchedules">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseSchedules" aria-expanded="false" aria-controls="collapseSchedules" class="collapsed">
                                                    <i class="fa fa-calendar" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>Schedules</h3>
                                                    <p>Set up schedules</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseSchedules" class="collapse" role="tabpanel" aria-labelledby="headingSchedules" aria-expanded="false">
                                            <div class="card-block">
                                                <button id="addSchedule" class="btn btn-primary mb-2" type="button"><i class="fa fa-plus"></i> Add</button>
                                                <div id="jsGridSchedules"></div>

                                                <div class="modal fade" id="editModalSchedules" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title">Schedule</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">

                                                                    <div class="form-group row">
                                                                        <label for="scheduleName" class="col-sm-3 col-form-label">Schedule Name</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="scheduleName" name="scheduleName" placeholder="Enter the name of this schedule (e.g. Open Hours Weekday)" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-check row">
                                                                        <div class="form-group col-md-12">
                                                                            <input class="form-check-input" type="checkbox" value="" id="repeatingEvent">
                                                                            <label class="form-check-label" for="repeatingEvent">
                                                                                Repeating event
                                                                            </label>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Repeating Event -->
                                                                    <div id="repeatingEventDiv" style="display: none;">
                                                                        <div class="form-group row">
                                                                            <label for="interval" class="col-sm-3 col-form-label">Repeats every</label>
                                                                            <div class="col-sm-9 row">
                                                                                <input type="number" class="form-control col-md-3" id="interval" name="interval" value="1" min="1" required>
                                                                                <select id="recurrenceType" name="recurrenceType" class="form-control col-md-3 ml-1" required>
                                                                                    <option value="" disabled>Frequency</option>
                                                                                    <option value="Daily">Day</option>
                                                                                    <option value="Weekly">Week</option>
                                                                                    <option value="Monthly">Month</option>
                                                                                    <option value="Yearly">Year</option>
                                                                                </select>
                                                                            </div>
                                                                        </div>

                                                                        <!-- Weekly -->
                                                                        <div class="btn-group" data-toggle="buttons" id="weeklyControlsDiv" style="display: none;">
                                                                            <label class="btn btn-primary active"><input type="checkbox" id="chkMonday" checked> Mo</label>
                                                                            <label class="btn btn-primary"><input type="checkbox" id="chkTuesday"> Tu</label>
                                                                            <label class="btn btn-primary"><input type="checkbox" id="chkWednesday"> We</label>
                                                                            <label class="btn btn-primary"><input type="checkbox" id="chkThursday"> Th</label>
                                                                            <label class="btn btn-primary"><input type="checkbox" id="chkFriday"> Fr</label>
                                                                            <label class="btn btn-primary"><input type="checkbox" id="chkSaturday"> Sa</label>
                                                                            <label class="btn btn-primary"><input type="checkbox" id="chkSunday"> Su</label>
                                                                        </div>

                                                                        <!-- Monthly -->
                                                                        <div class="form-group row" id="monthlyControlsDiv" style="display: none;">
                                                                            <div class="col-md-3"></div>
                                                                            <select name="monthlyRecurrenceType" id="monthlyRecurrenceType" class="form-control col-md-2 mr-1" required>
                                                                                <optgroup label="Date">
                                                                                    <option value="On" selected>On</option>
                                                                                </optgroup>
                                                                                <optgroup label="Day of the Week">
                                                                                    <option value="IfDayIs">If Day is</option>
                                                                                    <option value="First">First</option>
                                                                                    <option value="Second">Second</option>
                                                                                    <option value="Third">Third</option>
                                                                                    <option value="Fourth">Fourth</option>
                                                                                    <option value="Last">Last</option>
                                                                                </optgroup>
                                                                            </select>

                                                                            <div class="col-md-6 row" id="byMonthDayDiv">
                                                                                <input type="text" class="form-control col-md-3" id="byMonthDay" name="byMonthDay" value="30" required data-toggle="tooltip" data-placement="top" title="Add a single day (e.g. 24) or mutliple days (e.g. 24,25,26)">
                                                                            </div>
                                                                            <div class="col-md-6 row" id="byDayDiv" style="display: none;">
                                                                                <div class="btn-group" data-toggle="buttons" id="byDay">
                                                                                    <label class="btn btn-primary active"><input type="checkbox" id="chkMonday" checked> Mo</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkTuesday"> Tu</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkWednesday"> We</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkThursday"> Th</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkFriday"> Fr</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkSaturday"> Sa</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkSunday"> Su</label>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <!-- All Day -->
                                                                        <div class="form-check row">
                                                                            <div class="form-group col-md-12">
                                                                                <input class="form-check-input" type="checkbox" value="" id="repeatingEventAllDay">
                                                                                <label class="form-check-label" for="repeatingEventAllDay">
                                                                                    All Day
                                                                                </label>
                                                                            </div>
                                                                        </div>

                                                                        <!-- Start Time -->
                                                                        <div class="form-group row time-row">
                                                                            <label class="col-sm-3 col-form-label">Start Time</label>
                                                                            <div class="input-group date col-md-3 time-only" id="repeatingEventStartTime" data-target-input="nearest">
                                                                                <input type="text" class="form-control datetimepicker-input" data-target="#repeatingEventStartTime" />
                                                                                <div class="input-group-append" data-target="#repeatingEventStartTime" data-toggle="datetimepicker">
                                                                                    <div class="input-group-text"><i class="fa fa-clock-o"></i></div>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <!-- End Time -->
                                                                        <div class="form-group row time-row">
                                                                            <label class="col-sm-3 col-form-label">End Time</label>
                                                                            <div class="input-group date col-md-3 time-only" id="repeatingEventEndTime" data-target-input="nearest">
                                                                                <input type="text" class="form-control datetimepicker-input" data-target="#repeatingEventEndTime" />
                                                                                <div class="input-group-append" data-target="#repeatingEventEndTime" data-toggle="datetimepicker">
                                                                                    <div class="input-group-text"><i class="fa fa-clock-o"></i></div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Single Event -->
                                                                    <div id="singleEventDiv">
                                                                        <div class="form-check row">
                                                                            <div class="form-group col-md-12">
                                                                                <input class="form-check-input" type="checkbox" value="" id="singleEventAllDay">
                                                                                <label class="form-check-label" for="singleEventAllDay">
                                                                                    All Day
                                                                                </label>
                                                                            </div>
                                                                        </div>

                                                                        <div class="form-group row">
                                                                            <label class="col-sm-3 col-form-label">Start Date</label>
                                                                            <div class="input-group date col-md-3 date-only" id="singleEventDayStart" data-target-input="nearest">
                                                                                <input type="text" class="form-control datetimepicker-input" data-target="#singleEventDayStart" />
                                                                                <div class="input-group-append" data-target="#singleEventDayStart" data-toggle="datetimepicker">
                                                                                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group row time-row">
                                                                            <label class="col-sm-3 col-form-label">Start Time</label>
                                                                            <div class="input-group date col-md-3 time-only" id="singleEventStartTime" data-target-input="nearest">
                                                                                <input type="text" class="form-control datetimepicker-input" data-target="#singleEventStartTime" />
                                                                                <div class="input-group-append" data-target="#singleEventStartTime" data-toggle="datetimepicker">
                                                                                    <div class="input-group-text"><i class="fa fa-clock-o"></i></div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group row time-row">
                                                                            <label class="col-sm-3 col-form-label">End Time</label>
                                                                            <div class="input-group date col-md-3 time-only" id="singleEventEndTime" data-target-input="nearest">
                                                                                <input type="text" class="form-control datetimepicker-input" data-target="#singleEventEndTime" />
                                                                                <div class="input-group-append" data-target="#singleEventEndTime" data-toggle="datetimepicker">
                                                                                    <div class="input-group-text"><i class="fa fa-clock-o"></i></div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group row">
                                                                            <label class="col-sm-3 col-form-label">End Date</label>
                                                                            <div class="input-group date col-md-3 date-only" id="singleEventDayEnd" data-target-input="nearest">
                                                                                <input type="text" class="form-control datetimepicker-input" data-target="#singleEventDayEnd" />
                                                                                <div class="input-group-append" data-target="#singleEventDayEnd" data-toggle="datetimepicker">
                                                                                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Footer -->
                                                                    <div class="modal-footer">
                                                                        <button id="btnClose" type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                        <button id="submit" type="submit" class="btn btn-primary pull-left"><i class="fa fa-plus"></i> Add</button>
                                                                    </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>



    <noscript>You need to enable JavaScript to run this app.</noscript>
    <!--#region Imports -->
    <!-- Bootstrap core JavaScript-->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <!-- Core plugin JavaScript-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js" integrity="sha256-4iQZ6BVL4qNKlQ27TExEhBN1HFPvAvAMbFavKKosSWQ=" crossorigin="anonymous"></script>
    <!-- Tempus Dominus -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
    <!-- Genesys Cloud -->
    <script src="https://sdk-cdn.mypurecloud.com/javascript/61.0.0/purecloud-platform-client-v2.min.js"></script>
    <!-- JQuery Validate -->
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/additional-methods.min.js"></script>
    <!-- jQuery Toast -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.js"></script>
    <!-- Bootbox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.4.0/bootbox.min.js"></script>
    <!-- jQuery UI -->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <!-- Bootstrap Select -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>
    <!-- JSGrid -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js"></script>
    <!-- RRule Generator -->
    <script src="./js/rrule.min.js"></script>
    <!-- Our Scripts -->
    <script src="js/gc.js"></script>
    <script src="js/requests.js"></script>
    <script src="js/tools.js"></script>
    <!-- Dictionary -->
    <script src="js/dictionary.js"></script>

    <!--#endregion -->

    <script>
        let gcToken, id = getUrlParameter("id"), request, caItem = {}, searches = {}, searchesSchedules = {};

        init();

        async function init() {
            console.log('function init');
            $('#spinner_message')[0].innerHTML = "login to Genesys Cloud...";

            // Init Date/Time Pickers
            $('.date-only').datetimepicker({
                format: 'L'
            });
            $('.time-only').datetimepicker({
                format: 'LT'
            });

            // Enable tooltips
            $('[data-toggle="tooltip"]').tooltip();

            $.each(countries, (i, country) => {
                $("<option/>", { value: country.name }).text(country.name).appendTo("#country");
            });

            document.getElementById("spinner").style.display = "block";
            try {
                await getMe();
                if (!maintenanceMode) $("#submit").attr('disabled', false);
            } catch (error) {
                console.error(error);
                showMessage(error.hasOwnProperty('message') ? error.message : `Unable to login to Genesys Cloud ${JSON.stringify(error)}`, true);
                return
            } finally {
                document.getElementById("spinner").style.display = "none";
            }

            gcToken = userInfo.token
            localStorage.setItem("gcToken", gcToken);
            localStorage.setItem("userName", userInfo.name);

            if (id) {
                console.log(`found id ${id} in path, check for rapidRequest and draft version...`);
                document.getElementById("spinner").style.display = "block";
                // Try to load #rapidresponse request
                try {
                    $('#spinner_message')[0].innerHTML = "Validating Id...";
                    request = await getRequest(id);
                    console.log(request);
                    $('#badgePill')[0].innerHTML = "1"
                    console.log(request);
                    $('#requestDetails')[0].innerHTML = `Related to Partner/Customer Name <B>${request.partnerCustomerName}</B> requested by <em>${request.requesterName}</em>`;
                } catch (error) {
                    console.error(error);
                    if (error.status !== 404) {
                        document.getElementById("spinner").style.display = "none";
                        showMessage(JSON.stringify(error), true);
                        return;
                    }
                }

                // Try to load latest draft
                try {
                    $('#spinner_message')[0].innerHTML = "check for latest draft...";
                    console.log('check for draft questionnaire...');
                    caItem = await ca_getItem(id);
                    console.log(caItem);
                } catch (error) {
                    console.log(error);
                    if (error.status !== 404) {
                        document.getElementById("spinner").style.display = "none";
                        showMessage(JSON.stringify(error), true);
                        return;
                    }
                }
                document.getElementById("spinner").style.display = "none";

                if (!request && !caItem) {
                    showMessage("Provided requestId doesn't exist", true);
                    return;
                }
                if (request || caItem) {
                    loadDraftConfiguration();
                    enableForm(true);
                }

            } else {
                // New not related RequestForm                
                $('#badgePill')[0].innerHTML = "NEW";
                enableForm(true);
                initLocationsGrid();
                initSchedulesGrid();
            }
        }

        function enableForm(_bool) {
            $("#saveDraft").prop('disabled', !_bool);
            $("#exportCSV").prop('disabled', !_bool);
            $("#mainForm").attr("hidden", !_bool);
            if (request)
                $("#divRequestDetails").attr("hidden", !_bool);
        }

        function loadDraftConfiguration() {
            console.log('function loadDraftConfiguration');
            if (caItem) {
                // organization
                $('#companyName').val(caItem.organizationSetup.companyName);
                $('#genesysCloudRegion').val(caItem.organizationSetup.genesysCloudRegion);
                $('#numberOfUsers').val(caItem.organizationSetup.numberOfUsers);

                initLocationsGrid();
                initSchedulesGrid();
            }
        }

        function buildJSON() {
            console.log('function buildJSON');
            let json = {
                organization: {},
                locations: []
            };

            if ($('#companyName').val())
                json.organization.companyName = $('#companyName').val();
            if ($('#genesysCloudRegion').val())
                json.organization.genesysCloudRegion = $('#genesysCloudRegion').val();
            if ($('#numberOfUsers').val())
                json.organization.numberOfUsers = $('#numberOfUsers').val();
            console.log(json);

            // Test Obj
            json = {
                organizationSetup: {
                    companyName: "Test Company",
                    genesysCloudRegion: "mypurecloud.ie",
                    numberOfUsers: 500
                },
                locations: $("#jsGridLocations").jsGrid("option", "data")
            }
            console.log(json);
            return json;
        }

        async function saveDraft() {
            console.log('saveDraft()');

            try {
                let json = buildJSON();
                if (caItem) {
                    await ca_updateItem(caItem.id, json);
                } else {
                    caItem = await ca_createItem(json);
                    console.log(`responseId created on CA db: ${caItem.id}`);
                    window.history.pushState('', 'CC Rapid Response Request Form', `${window.location.href}?id=${caItem.id}`);

                }
            } catch (error) {
                console.error(error);
                showMessage("Failed to update draft item", JSON.stringify(error));
                return
            }

            showMessage("Draft updated", false);
        }

        function exportCSV() {
            console.log('function exportCSV()');
            let data = buildJSON();
            const replacer = (key, value) => value === null ? '' : value // specify how you want to handle null values here
            let header, csv_locations;

            // Locations
            if (data.locations && data.locations.length > 0) {
                console.log('build locations csv...');
                header = Object.keys(data.locations[0]);
                csv_locations = data.locations.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(';'))
                csv_locations.unshift(header.join(';'))
                csv_locations = csv_locations.join('\r\n')
            } else {
                console.log('locations are empty, skip csv build...');
            }


            console.log(csv_locations)

            //download(csv, 'export.csv');


        }

        //#region JSGrid

        jsGrid.setDefaults({ tableClass: "jsgrid-table table table-striped table-hover" });

        //#region Locations

        var dbLocations = {
            loadData: function (filter) {
                return $.grep(this.locations, function (location) {
                    return (!filter.locationName || location.locationName.toLowerCase().indexOf(filter.locationName.toLowerCase()) > -1)
                        && (!filter.streetAddress || location.streetAddress.toLowerCase().indexOf(filter.streetAddress.toLowerCase()) > -1)
                        && (!filter.city || location.city.toLowerCase().indexOf(filter.city.toLowerCase()) > -1)
                        && (!filter.state || location.state.toLowerCase().indexOf(filter.state.toLowerCase()) > -1)
                        && (!filter.zipCode || location.zipCode.toLowerCase().indexOf(filter.zipCode.toLowerCase()) > -1)
                        && (!filter.country || location.country.toLowerCase().indexOf(filter.country.toLowerCase()) > -1)
                        && (!filter.notes || location.notes.toLowerCase().indexOf(filter.notes.toLowerCase()) > -1)
                        && (!filter.emergencyNumber || location.emergencyNumber.toLowerCase().indexOf(filter.emergencyNumber.toLowerCase()) > -1);
                });
            },
            insertItem: function (insertingLocation) {
                this.locations.push(insertingLocation);
            },
            updateItem: function (updatingLocation) { },
            deleteItem: function (deletingLocation) { }
        };

        window.dbLocations = dbLocations;

        var formSubmitHandlerLocations = $.noop;

        let validatorLocations = $("#editModalLocations #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerLocations();
            }
        });

        $("#addLocation").on('click', (e) => {
            e.preventDefault();
            showLocationsModal("Add", {});
        });

        function initLocationsGrid() {
            //console.log('caItem locations:', caItem.locations);
            dbLocations.locations = caItem.hasOwnProperty('locations') ? caItem.locations : [];

            $("#jsGridLocations").jsGrid({
                height: "auto",
                width: "100%",
                editing: true,
                autoload: true,
                sorting: true,
                filtering: true,
                paging: false,
                noDataContent: "No Locations",
                confirmDeleting: false,
                onError: function (args) {
                    console.error('Failed to load grid data:', args);
                    showMessage("An error occurred while loading your data", true);
                },
                rowClick: function (args) {
                    showLocationsModal("Edit", args.item);
                },
                onDataLoaded: function (args) {
                    $("#addLocation").attr('disabled', $("#jsGridLocations").jsGrid("option", "data").length >= 2);
                },
                onItemInserted: function (args) {
                    $("#addLocation").attr('disabled', $("#jsGridLocations").jsGrid("option", "data").length >= 2);
                },
                onItemUpdated: function (args) {
                    $("#addLocation").attr('disabled', $("#jsGridLocations").jsGrid("option", "data").length >= 2);
                },
                onItemDeleting: function (args) {
                    console.log("onItemDeleting");
                    if (!args.item.deleteConfirmed) { // custom property for confirmation
                        args.cancel = true; // cancel deleting
                        bootbox.confirm({
                            message: 'Do you really want to delete this location?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    args.item.deleteConfirmed = true;
                                    $("#jsGridLocations").jsGrid('deleteItem', args.item); // Remove item from grid
                                    removeFromArray(dbLocations.locations, args.item); // Remove item from db
                                    showMessage("Location deleted", false);
                                }
                            }
                        });
                    }
                },
                onItemDeleted: function (args) {
                    $("#addLocation").attr('disabled', $("#jsGridLocations").jsGrid("option", "data").length >= 2);
                },
                controller: dbLocations,
                fields: [
                    {
                        name: "locationName",
                        title: "Name",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searches.locationName = input.val();
                                $("#jsGridLocations").data('JSGrid').search(searches);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "streetAddress",
                        title: "Address",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searches.streetAddress = input.val();
                                $("#jsGridLocations").data('JSGrid').search(searches);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "city",
                        title: "City",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searches.city = input.val();
                                $("#jsGridLocations").data('JSGrid').search(searches);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "state",
                        title: "State",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searches.state = input.val();
                                $("#jsGridLocations").data('JSGrid').search(searches);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "zipCode",
                        title: "Zip Code",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searches.zipCode = input.val();
                                $("#jsGridLocations").data('JSGrid').search(searches);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "country",
                        title: "Country",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searches.country = input.val();
                                $("#jsGridLocations").data('JSGrid').search(searches);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "notes",
                        title: "Notes",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searches.notes = input.val();
                                $("#jsGridLocations").data('JSGrid').search(searches);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "emergencyNumber",
                        title: "Emergency #",
                        type: "text",
                        width: 120,
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searches.emergencyNumber = input.val();
                                $("#jsGridLocations").data('JSGrid').search(searches);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        type: "control",
                        modeSwitchButton: false,
                        editButton: false,
                        width: 68,
                        align: "center",
                        headerTemplate: function () {
                            return "Actions";
                        }
                    }
                ]
            });
        }

        var showLocationsModal = function (dialogType, item) {
            console.log('Showing details for:', item);
            $("#editModalLocations #locationName").val(item.locationName);
            $("#editModalLocations #streetAddress").val(item.streetAddress);
            $("#editModalLocations #city").val(item.city);
            $("#editModalLocations #state").val(item.state);
            $("#editModalLocations #zipCode").val(item.zipCode);
            $("#editModalLocations #country").val(item.country);
            $("#editModalLocations #country").selectpicker('refresh');
            $("#editModalLocations #notes").val(item.notes);
            $("#editModalLocations #emergencyNumber").val(item.emergencyNumber);
            $("#editModalLocations #submit").html("<i class='fa fa-floppy-o'></i> Save");
            formSubmitHandlerLocations = function () {
                saveLocation(item, dialogType === "Add");
            };
            $("#editModalLocations").modal('show');
        };

        var saveLocation = function (item, isNew) {
            console.log('Extending item:', item);
            $.extend(item, {
                locationName: $("#editModalLocations #locationName").val(),
                streetAddress: $("#editModalLocations #streetAddress").val(),
                city: $("#editModalLocations #city").val(),
                state: $("#editModalLocations #state").val(),
                zipCode: $("#editModalLocations #zipCode").val(),
                country: $("#editModalLocations #country").val(),
                notes: $("#editModalLocations #notes").val(),
                emergencyNumber: $("#editModalLocations #emergencyNumber").val(),
            });
            console.log('Extended Item:', item);
            console.log('IsNew?', isNew)
            $("#jsGridLocations").jsGrid(isNew ? "insertItem" : "updateItem", item);
            $("#editModalLocations").modal('hide');
        };

        $('#editModalLocations').on('hidden.bs.modal', async () => {
            initLocationsModal();
        });

        function initLocationsModal() {
            $("#editModalLocations #locationName").val("");
            $("#editModalLocations #streetAddress").val("");
            $("#editModalLocations #city").val("");
            $("#editModalLocations #state").val("");
            $("#editModalLocations #zipCode").val("");
            $("#editModalLocations #country").val("");
            $("#editModalLocations #country").selectpicker('refresh');
            $("#editModalLocations #notes").val("");
            $("#editModalLocations #emergencyNumber").val("");
            $("#editModalLocations #submit").html("<i class='fa fa-plus'></i> Add");

            validatorLocations.resetForm(); // Reset validation errors
        }

        //#endregion

        //#region Schedules

        var dbSchedules = {
            loadData: function (filter) {
                return $.grep(this.schedules, function (schedule) {
                    return (!filter.scheduleName || schedule.scheduleName.toLowerCase().indexOf(filter.scheduleName.toLowerCase()) > -1)
                        && (!filter.start || schedule.start.toLowerCase().indexOf(filter.start.toLowerCase()) > -1)
                        && (!filter.end || schedule.end.toLowerCase().indexOf(filter.end.toLowerCase()) > -1)
                        && (!filter.rrule || schedule.rrule.toLowerCase().indexOf(filter.rrule.toLowerCase()) > -1);
                });
            },
            insertItem: function (insertingItem) {
                this.schedules.push(insertingItem);
            },
            updateItem: function (updatingItem) { },
            deleteItem: function (deletingItem) { }
        };

        window.dbSchedules = dbSchedules;

        var formSubmitHandlerSchedules = $.noop;

        let validatorSchedules = $("#editModalSchedules #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerSchedules();
            }
        });

        $("#repeatingEvent").on('change', () => {
            if ($("#repeatingEvent").is(':checked')) {
                $("#repeatingEventDiv").show();
                $("#singleEventDiv").hide();
            } else {
                $("#repeatingEventDiv").hide();
                $("#singleEventDiv").show();
            }
        });

        $("#repeatingEventAllDay").on('change', () => {
            if ($("#repeatingEventAllDay").is(':checked')) {
                $(".time-row").hide();
            } else {
                $(".time-row").show();
            }
        });

        $("#recurrenceType").on('change', () => {
            let recurrenceType = $("#recurrenceType").val();
            switch (recurrenceType) {
                case "Daily":
                    $("#weeklyControlsDiv").hide();
                    $("#monthlyControlsDiv").hide();
                    $("#yearlyControlsDiv").hide();
                    break;
                case "Weekly":
                    $("#weeklyControlsDiv").show();
                    $("#monthlyControlsDiv").hide();
                    $("#yearlyControlsDiv").hide();
                    break;
                case "Monthly":
                    $("#weeklyControlsDiv").hide();
                    $("#monthlyControlsDiv").show();
                    $("#yearlyControlsDiv").hide();
                    break;
                case "Yearly":
                    $("#weeklyControlsDiv").hide();
                    $("#monthlyControlsDiv").hide();
                    $("#yearlyControlsDiv").show();
                    break;

                default:
                    break;
            }
        });

        $("#monthlyRecurrenceType").on('change', () => {
            let monthlyRecurrenceType = $("#monthlyRecurrenceType").val();
            switch (monthlyRecurrenceType) {
                case "On":
                    $("#byMonthDayDiv").show();
                    $("#byDayDiv").hide();
                    break;
                default:
                    $("#byMonthDayDiv").hide();
                    $("#byDayDiv").show();
                    break;
            }
        });

        $("#singleEventAllDay").on('change', () => {
            if ($("#singleEventAllDay").is(':checked')) {
                $(".time-row").hide();
            } else {
                $(".time-row").show();
            }
        });

        $("#addSchedule").on('click', (e) => {
            e.preventDefault();
            showSchedulesModal("Add", {});
        });

        function initSchedulesGrid() {
            dbSchedules.schedules = caItem.hasOwnProperty('schedules') ? caItem.schedules : [];

            $("#jsGridSchedules").jsGrid({
                height: "auto",
                width: "100%",
                editing: true,
                autoload: true,
                sorting: true,
                filtering: false,
                paging: false,
                noDataContent: "No Schedules",
                confirmDeleting: false,
                onError: function (args) {
                    console.error('Failed to load grid data:', args);
                    showMessage("An error occurred while loading your data", true);
                },
                rowClick: function (args) {
                    showSchedulesModal("Edit", args.item);
                },
                onDataLoaded: function (args) {
                    $("#addSchedule").attr('disabled', $("#jsGridSchedules").jsGrid("option", "data").length >= 2);
                },
                onItemInserted: function (args) {
                    $("#addSchedule").attr('disabled', $("#jsGridSchedules").jsGrid("option", "data").length >= 2);
                },
                onItemUpdated: function (args) {
                    $("#addSchedule").attr('disabled', $("#jsGridSchedules").jsGrid("option", "data").length >= 2);
                },
                onItemDeleting: function (args) {
                    console.log("onItemDeleting");
                    if (!args.item.deleteConfirmed) { // custom property for confirmation
                        args.cancel = true; // cancel deleting
                        bootbox.confirm({
                            message: 'Do you really want to delete this schedule?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    args.item.deleteConfirmed = true;
                                    $("#jsGridSchedules").jsGrid('deleteItem', args.item); // Remove item from grid
                                    removeFromArray(dbSchedules.schedules, args.item); // Remove item from db
                                    showMessage("Schedule deleted", false);
                                }
                            }
                        });
                    }
                },
                onItemDeleted: function (args) {
                    $("#addSchedule").attr('disabled', $("#jsGridSchedules").jsGrid("option", "data").length >= 2);
                },
                controller: dbSchedules,
                fields: [
                    {
                        name: "scheduleName",
                        title: "Name",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searchesSchedules.scheduleName = input.val();
                                $("#jsGridSchedules").data('JSGrid').search(searchesSchedules);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "start",
                        title: "Start Date/Time",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searchesSchedules.start = input.val();
                                $("#jsGridSchedules").data('JSGrid').search(searchesSchedules);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "end",
                        title: "Until",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searchesSchedules.end = input.val();
                                $("#jsGridSchedules").data('JSGrid').search(searchesSchedules);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "rrule",
                        title: "Recurrence Rule",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searchesSchedules.rrule = input.val();
                                $("#jsGridSchedules").data('JSGrid').search(searchesSchedules);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        type: "control",
                        modeSwitchButton: false,
                        editButton: false,
                        width: 68,
                        align: "center",
                        headerTemplate: function () {
                            return "Actions";
                        }
                    }
                ]
            });
        }

        var showSchedulesModal = function (dialogType, item) {
            console.log('Showing details for:', item);
            $("#editModalSchedules #scheduleName").val(item.scheduleName);
            $("#editModalSchedules #start").val(item.start);
            $("#editModalSchedules #end").val(item.end);
            //TODO Use rrule to populate fields and checkboxes
            $("#editModalSchedules #submit").html("<i class='fa fa-floppy-o'></i> Save");
            formSubmitHandlerSchedules = function () {
                saveSchedule(item, dialogType === "Add");
            };
            $("#editModalSchedules").modal('show');
        };

        var saveSchedule = function (item, isNew) {
            console.log('Extending item:', item);

            // Set default values
            let freq, byWeekDay = [], bySetPos, byMonth, byMonthDay, tzId, byNMonthDay, wkst;
            let dtStart = new Date(), until = new Date();
            until.setFullYear(until.getFullYear() + 1); // 1 year from now to until date TODO Is this correct?
            let count = 3; // We don't really care about this. It's only to generate dates for the next events in the schedule.
            let interval = $("#editModalSchedules #interval").val();
            let recurrenceType = $("#editModalSchedules #recurrenceType").val();

            // Is this a repeating schedule?
            if ($("#repeatingEvent").is(':checked')) {
                switch (recurrenceType) {
                    case "Daily":
                        freq = rrule.RRULE.DAILY;
                        bWeekDay = [];
                        byMonthDay = undefined;
                        break;
                    case "Weekly":
                        freq = rrule.RRULE.WEEKLY;
                        //TODO Find a better way to do this
                        if ($("#weeklyControlsDiv #chkMonday").is(':checked')) { bWeekDay.push(rrule.RRule.MO); }
                        if ($("#weeklyControlsDiv #chkTuesday").is(':checked')) { bWeekDay.push(rrule.RRule.TU); }
                        if ($("#weeklyControlsDiv #chkWednesday").is(':checked')) { bWeekDay.push(rrule.RRule.WE); }
                        if ($("#weeklyControlsDiv #chkThursday").is(':checked')) { bWeekDay.push(rrule.RRule.TH); }
                        if ($("#weeklyControlsDiv #chkFriday").is(':checked')) { bWeekDay.push(rrule.RRule.FR); }
                        if ($("#weeklyControlsDiv #chkSaturday").is(':checked')) { bWeekDay.push(rrule.RRule.SA); }
                        if ($("#weeklyControlsDiv #chkSunday").is(':checked')) { bWeekDay.push(rrule.RRule.SU); }
                        byMonthDay = undefined;
                        break;
                    case "Monthly":
                        freq = rrule.RRULE.MONTHLY;
                        if ($("#monthlyControlsDiv").is(':visible')) {
                            if ($("#monthlyRecurrenceType").val() === "On") {
                                byMonthDay = $("#byMonthDay").val();
                            } else {
                                //TODO Find a better way to do this
                                if ($("#byDayDiv #chkMonday").is(':checked')) { bWeekDay.push(rrule.RRule.TU); }
                                if ($("#byDayDiv #chkTuesday").is(':checked')) { bWeekDay.push(rrule.RRule.TU); }
                                if ($("#byDayDiv #chkWednesday").is(':checked')) { bWeekDay.push(rrule.RRule.WE); }
                                if ($("#byDayDiv #chkThursday").is(':checked')) { bWeekDay.push(rrule.RRule.TH); }
                                if ($("#byDayDiv #chkFriday").is(':checked')) { bWeekDay.push(rrule.RRule.FR); }
                                if ($("#byDayDiv #chkSaturday").is(':checked')) { bWeekDay.push(rrule.RRule.SA); }
                                if ($("#byDayDiv #chkSunday").is(':checked')) { bWeekDay.push(rrule.RRule.SU); }
                            }
                        }
                        break;
                    case "Yearly":
                        freq = rrule.RRULE.YEARLY;

                        bWeekDay = [];
                        byMonthDay = undefined;
                        break;
                    default:
                        console.error('Unsupported recurrence:', recurrenceType)
                        break;
                }

                // Build RRule
                let currentRRule = buildRRule(freq, interval, byWeeDay, dtstart, until, wkst, count, tzId, bySetPos, byMonth, byMonthDay, byNMonthDay, byYearDay);
            }
            $.extend(item, {
                scheduleName: $("#editModalSchedules #scheduleName").val(),
                start: "" || new Date(),
                end: "",
                rrule: ""
            });
            console.log('Extended Item:', item);
            console.log('IsNew?', isNew)
            $("#jsGridSchedules").jsGrid(isNew ? "insertItem" : "updateItem", item);
            $("#editModalSchedules").modal('hide');
        };

        $('#editModalSchedules').on('hidden.bs.modal', async () => {
            initSchedulesModal();
        });

        //#region RRule

        function getAllEventsFromRRuleString(rruleString) {
            return new rrule.rrulestr(rruleString).all();
        }

        function buildRRule(freq, interval, byWeekDay, dtStart, until, wkst, count, tzId, bySetPos, byMonth, byMonthDay, byNMonthDay, byYearDay, byWeekNo, byNWeekDay, byHour, byMinute, bySecond, byEaster) {
            return new rrule.RRule({
                freq: freq,
                interval: interval,
                byweekday: byWeekDay,
                dtstart: dtStart,
                until: until,
                wkst: wkst,
                count: count,
                tzid: tzId,
                bysetpos: bySetPos,
                bymonth: byMonth,
                bymonthday: byMonthDay,
                bynmonthday: byNMonthDay,
                byyearday: byYearDay,
                byweekno: byWeekNo,
                bynweekday: byNWeekDay,
                byhour: byHour,
                byminute: byMinute,
                bysecond: bySecond,
                byeaster: byEaster
            });
        }

        //#endregion

        function initSchedulesModal() {
            $("#editModalSchedules #scheduleName").val("");

            // Repeating Event
            $("#editModalSchedules #repeatingEvent").prop('checked', false);
            $("#editModalSchedules #repeatingEvent").change();
            $("#editModalSchedules #interval").val(1);
            $("#editModalSchedules #recurrenceType").val('Day');
            $("#editModalSchedules #repeatingEventAllDay").prop('checked', false);
            $("#editModalSchedules #repeatingEventAllDay").change();
            $("#editModalSchedules #repeatingEventStartTime").datetimepicker('clear');
            $("#editModalSchedules #repeatingEventEndTime").datetimepicker('clear');

            $("#weeklyControlsDiv #chkMonday").prop(':checked', true);
            $("#weeklyControlsDiv #chkTuesday").prop(':checked', false);
            $("#weeklyControlsDiv #chkWednesday").prop(':checked', false);
            $("#weeklyControlsDiv #chkThursday").prop(':checked', false);
            $("#weeklyControlsDiv #chkFriday").prop(':checked', false);
            $("#weeklyControlsDiv #chkSaturday").prop(':checked', false);
            $("#weeklyControlsDiv #chkSunday").prop(':checked', false);

            $("#byDayDiv #chkMonday").prop(':checked', true);
            $("#byDayDiv #chkTuesday").prop(':checked', false);
            $("#byDayDiv #chkWednesday").prop(':checked', false);
            $("#byDayDiv #chkThursday").prop(':checked', false);
            $("#byDayDiv #chkFriday").prop(':checked', false);
            $("#byDayDiv #chkSaturday").prop(':checked', false);
            $("#byDayDiv #chkSunday").prop(':checked', false);

            // Single Event
            $("#editModalSchedules #singleEventAllDay").prop('checked', false);
            $("#editModalSchedules #singleEventAllDay").change();
            $("#editModalSchedules #singleEventDayStart").datetimepicker('clear');
            $("#editModalSchedules #singleEventStartTime").datetimepicker('clear');
            $("#editModalSchedules #singleEventEndTime").datetimepicker('clear');
            $("#editModalSchedules #singleEventDayEnd").datetimepicker('clear');

            $("#editModalSchedules #submit").html("<i class='fa fa-plus'></i> Add");

            validatorSchedules.resetForm(); // Reset validation errors
        }

        //#endregion

        //#endregion

        function removeFromArray(array, value) {
            let idx = array.indexOf(value);
            if (idx !== -1) {
                array.splice(idx, 1);
            }
            return array;
        }

        function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
        };

    </script>

    <!--Coollabs -->
    <script async defer src="https://cdn.coollabs.io/save.js"></script>

</body>

</html>