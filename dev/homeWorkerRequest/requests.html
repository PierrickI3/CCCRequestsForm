<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <title>CCC Request Form</title>
    <link rel="shortcut icon" href="/favicon.ico">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!-- Bootstrap DatePicker -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker3.min.css" integrity="sha256-FAOaXTpl90/K8cXmSdsskbQN3nKYulhCpPbcFzGTWKI=" crossorigin="anonymous" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Editable CSS -->
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.css" />
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.min.css" />
    <!-- jQuery Toast -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.css" rel="stylesheet">
    <!-- Bootstrap Select -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="./css/custom.css">
</head>

<body>
    <img class="overlay" src="./images/devmode.png" id="devModeImage" hidden />
    <nav class="navbar navbar-dark bg-dark navbar-fixed-top">
        <a class="navbar-brand" href="#">
            <img src="images/genesys.png" width="30" height="30" class="d-inline-block align-top" alt="">
            <span class="badge badge-warning">#homeworker</span> Request Form <small><span class="badge badge-pill badge-warning" id="region"></span></small>
        </a>

        <ul class="mb-0">
            <ul class="nav navbar-nav mr-2" style="float: left;">
                <li>
                    <button class="btn btn-secondary btn-sm" id="btnAssignedToMe"> My Requests </button>
                </li>
            </ul>
            <ul class="nav navbar-nav mr-2" style="float: left;">
                <li>
                    <button class="btn btn-secondary btn-sm" id="btnOnlyClosed"> Closed </button>
                </li>
            </ul>
            <ul class="nav navbar-nav mr-4" style="float: left;">
                <li>
                    <button class="btn btn-secondary btn-sm" id="btnOnlyDeleted"> Deleted </button>
                </li>
            </ul>
            <ul class="nav navbar-nav" style="float: right;">
                <li><a href="./index.html" class="admin btn btn-primary btn-sm ml-2">Submit a new Request</a></li>
            </ul>
            <ul class="nav navbar-nav" style="float: right;">
                <li><a href="./dashboard.html" id="dashboardLink" class="admin btn btn-info btn-sm ml-2">Dashboard</a></li>
            </ul>

            <ul class="nav navbar-nav" style="float: right;">
                <li><button id="refresh" class="admin btn btn-secondary btn-sm"><em class="fa fa-refresh"></em></button></li>

            </ul>
        </ul>
    </nav>

    <div class="alert alert-danger fade show" role="alert" id="alert" hidden>
        <strong>Maintenance Alert</strong> This site is being updated. Please wait.
        <a class="btn btn-light" href="#" onclick="location.reload();"><i class="fa fa-refresh"></i> Refresh</a>
    </div>

    <div class="col-12 admin">
        <div id="basicgrid"></div>
    </div>

    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header" id="modal-header">
                    <h5 id="title" class="modal-title">Request</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form class="modal-body form-horizontal" id="modal-form">
                    <div class="form-group">

                        <form id="modal-form">

                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label>Created Date</label>
                                    <input disabled type="text" class="form-control" id="createdDate" name="createdDate" />
                                </div>
                                <div class="form-group col-md-6">
                                    <label>Last Updated</label>
                                    <input disabled type="text" class="form-control" id="updatedDate" name="updatedDate" />
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="countriesAgents">Countries where agents are located</label>
                                    <select class="selectpicker" id="countriesAgents" name="countriesAgents" class="form-control" required multiple data-live-search="true">
                                    </select>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="countriesOperation">Countries where the prospect operates</label>
                                    <select class="selectpicker" id="countriesOperation" name="countriesOperation" class="form-control" required multiple data-live-search="true">
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="telephonyModel">Telephony Model</label>
                                    <select id="telephonyModel" name="subRegion" class="form-control" required>
                                        <option value="" disabled selected>Select a Telephony Model</option>
                                    </select>
                                </div>
                            </div>


                            <!-- GCV -->
                            <div id="GCVQuestions" style="display:none;">

                                <!-- Phone Numbers Deployment -->
                                <div class="form-row mr-4">
                                    <div class="form-group col-md-12">
                                        <label for="phoneNumbersDeployment">Phone Numbers Deployment</label>
                                        <textarea class="form-control" id="phoneNumbersDeployment" name="phoneNumbersDeployment" placeholder="Will the prospect deploy new customer facing numbers from GCV, re-route non-geographic numbers to GCV or forward calls to GCV numbers?"></textarea>
                                    </div>
                                </div>

                                <!-- New Numbers -->
                                <div class="form-row mr-4">
                                    <div class="form-group col-md-12">
                                        <label for="newNumbers">New Numbers</label>
                                        <textarea class="form-control" id="newNumbers" name="newNumbers" placeholder="If using new numbers, how many of each number type and which area codes are required?"></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- BYOC Cloud Carriers -->
                            <div class="border border-black mr-3 col-md-12" id="byocCloudCarriersDiv" style="display: none;">
                                <div class="form-row mt-1 mr-4">
                                    <div class="form-group col-md-6 text-center">Country</div>
                                    <div class="form-group col-md-6 text-center">Select one or more Carriers</div>
                                </div>
                                <div class="form-row mt-2 mr-4" id="byocCloudCarriers"></div>
                                <div class="form-check mr-4">
                                    <div class="form-group col-md-12">
                                        <input class="form-check-input" type="checkbox" value="" id="relationshipWithCarrier">
                                        <label class="form-check-label" for="relationshipWithCarrier">
                                            Does the prospect already have a relationship with the carrier and access to technical resources?
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- BYOC Premise Questions -->
                            <div id="BYOCPremiseQuestions" class="mt-2" style="display:none;">

                                <!-- Phone Numbers Deployment -->
                                <div class="form-check mr-4">
                                    <div class="form-group col-md-12">
                                        <input class="form-check-input" type="checkbox" value="" id="hyperVEnvironment">
                                        <label class="form-check-label" for="hyperVEnvironment">
                                            Does the prospect have a Hyper-V environment available?
                                        </label>
                                        <br>
                                    </div>
                                </div>

                            </div>

                            <!-- Commmitted Customer Resource -->
                            <div class="form-check mr-4">
                                <div class="form-group col-md-12">
                                    <input class="form-check-input" type="checkbox" value="" id="customerResourceCommitted">
                                    <label class="form-check-label" for="customerResourceCommitted">
                                        Has customer resource been committed?
                                    </label>
                                </div>
                            </div>

                            <!-- Project Sponsor -->
                            <div class="form-check mr-4">
                                <div class="form-group col-md-12">
                                    <input class="form-check-input" type="checkbox" value="" id="projectSponsorAssigned">
                                    <label class="form-check-label" for="projectSponsorAssigned">
                                        Has a project sponsor been assigned?
                                    </label>
                                </div>
                            </div>

                            <!-- Change Management Process -->
                            <div class="form-row mr-4">
                                <div class="form-group col-md-12">
                                    <label for="changeManagementProcess">Change Management Process</label>
                                    <textarea class="form-control" id="changeManagementProcess" name="changeManagementProcess" placeholder="Is there a change management process that needs to be followed?"></textarea>
                                </div>
                            </div>

                            <!-- Regulatory Considerations -->
                            <div class="form-row mr-4">
                                <div class="form-group col-md-12">
                                    <label for="regulatoryConsiderations">Key Regulatory Considerations</label>
                                    <textarea class="form-control" id="regulatoryConsiderations" name="regulatoryConsiderations" placeholder="Are there any key regulatory to consider, for example: Call Recording? Do country specific regulations prevent telephony being delivered from another country?" required></textarea>
                                </div>
                            </div>

                            <!-- Call Flows -->
                            <div class="form-check mr-4">
                                <div class="form-group col-md-12">
                                    <input class="form-check-input" type="checkbox" value="" id="callFlowsDocumented">
                                    <label class="form-check-label" for="callFlowsDocumented">
                                        Are the required call flows documented?
                                    </label>
                                </div>
                            </div>

                            <!-- Prompts -->
                            <div class="form-check mr-4">
                                <div class="form-group col-md-12">
                                    <input class="form-check-input" type="checkbox" value="" id="promptsAvailable">
                                    <label class="form-check-label" for="promptsAvailable">
                                        Are the required announcements (prompts) available as audio files?
                                    </label>
                                </div>
                            </div>

                            <!-- Identification and Verification -->
                            <div class="form-row mr-4">
                                <div class="form-group col-md-12">
                                    <label for="identificationAndVerificationProcesses">Identity and Verification Processes</label>
                                    <textarea class="form-control" id="identificationAndVerificationProcesses" name="identificationAndVerificationProcesses" placeholder="Are there any mandatory Identification and Verification processes?"></textarea>
                                </div>
                            </div>

                            <!-- IT Infrastructure -->
                            <div class="form-row mr-4">
                                <div class="form-group col-md-12">
                                    <label for="itInfrastructure">IT Infrastructure</label>
                                    <textarea class="form-control" id="itInfrastructure" name="itInfrastructure" placeholder="Is the IT infrastructure supported in-house or via a third-party, including internet connections, user/company provided laptops and headsets?" required></textarea>
                                </div>
                            </div>

                            <!-- Internet Bandwidth -->
                            <div class="form-check mr-4">
                                <div class="form-group col-md-12">
                                    <input class="form-check-input" type="checkbox" value="" id="usersInternetBandwidth">
                                    <label class="form-check-label" for="usersInternetBandwidth">
                                        Do users have sufficient internet bandwidth for the intended use, noting high bandwidth demand from other family members etc.?
                                    </label>
                                </div>
                            </div>

                            <!-- End devices require VPN? -->
                            <div class="form-check mr-4">
                                <div class="form-group col-md-12">
                                    <input class="form-check-input" type="checkbox" value="" id="endUserDevicesRequireVPN">
                                    <label class="form-check-label" for="endUserDevicesRequireVPN">
                                        Are user end-devices required to connect via VPN?
                                    </label>
                                </div>
                            </div>

                            <!-- Virtual Solution -->
                            <div class="form-row mr-4">
                                <div class="form-group col-md-12">
                                    <label for="virtualDesktopSolution">Virtual Desktop Solution</label>
                                    <textarea class="form-control" id="virtualDesktopSolution" name="virtualDesktopSolution" placeholder="Does the prospect use a Virtual Desktop solution, e.g. Citrix, thin-clients, etc.?" required></textarea>
                                </div>
                            </div>

                            <!-- Email Infrastructure -->
                            <div class="form-row mr-4">
                                <div class="form-group col-md-12">
                                    <label for="emailInfrastructure">Email Infrastructure</label>
                                    <textarea class="form-control" id="emailInfrastructure" name="emailInfrastructure" placeholder="What is the existing email infrastructure and can it be modified to use a company domain email address?" required></textarea>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="region">Region</label>
                                    <select id="region" name="region" class="form-control" required>
                                        <option value="" disabled selected>Select a Region</option>
                                        <option value="APAC">APAC</option>
                                        <option value="EMEA">EMEA</option>
                                        <option value="LATAM">LATAM</option>
                                        <option value="NA">North America</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="subRegion">Territory</label>
                                    <select id="subRegion" name="subRegion" class="form-control" required>
                                        <option value="" disabled selected>Select a Territory</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-5">
                                    <label for="requesterName">Requester Name</label>
                                    <input type="text" class="form-control" id="requesterName" name="requesterName" placeholder="Your Name" required>
                                </div>
                                <div class="form-group col-md-5">
                                    <label for="requesterEmail">Requester Email</label>
                                    <input type="text" class="form-control" id="requesterEmail" name="requesterEmail" placeholder="Your Email Address" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-5">
                                    <label for="requesterPhoneNumber">Requester Phone #</label>
                                    <input type="text" class="form-control" id="requesterPhoneNumber" name="requesterPhoneNumber" placeholder="Your Phone Number" required>
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="datepicker">Need Completed By</label>
                                    <div class="input-group date">
                                        <input type="text" id="datepicker" class="form-control" required />
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-10">
                                    <label for="notes">Notes</label>
                                    <textarea class="form-control" id="notes" name="notes" placeholder="Describe your request" required></textarea>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-10">
                                    <label for="partnerCustomerName">Partner and/or Customer Name</label>
                                    <input type="text" class="form-control" id="partnerCustomerName" name="partnerCustomerName" placeholder="Partner and/or Customer Name">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-9">
                                    <label for="salesforceAccountOpportunity">Salesforce Account / Opportunity
                                        URL</label>
                                    <input type="text" class="form-control" id="salesforceAccountOpportunity" name="salesforceAccountOpportunity" placeholder="Link to Salesforce opportunity or account">

                                </div>
                                <div class="form-group col-md-2">
                                    <label for="salesforceAccountOpportunity" style="color: white;">Open in new tab</label>
                                    <button id="btnCopySFLink" type="button" class="btn btn-primary pull-left" onclick="navigateToSFLink();">Copy</button>
                                </div>

                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-3">
                                    <label for="priority">Priority</label>
                                    <select id="priority" name="priority" class="form-control">
                                        <option value="" disabled selected>Select a Priority</option>
                                        <option value="Low">Low</option>
                                        <option value="Medium">Medium</option>
                                        <option value="High">High</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="status">Status</label>
                                    <select id="status" name="status" class="form-control" required>
                                        <option value="" disabled selected>Select a Status</option>
                                        <option value="Open">Open</option>
                                        <option value="On Hold">On Hold</option>
                                        <option value="Waiting On Additional Information">Waiting On Additional
                                            Information</option>
                                        <option value="Closed">Closed</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="programManager">Program Manager</label>
                                    <input type="text" class="form-control" id="programManager" name="programManager" placeholder="Program Manager" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <label id="bAcceptedRequest" hidden></label>
                                <div class="form-group col-md-10">
                                    <label for="time">Additional Team Member(s) Assigned</label>
                                    <input type="text" class="form-control" id="teamMembers" name="teamMembers" placeholder="Additional Team Member(s)">

                                </div>
                            </div>

                            <div class="form-row">
                                <label id="bAcceptedRequest" hidden></label>
                                <div class="form-group col-md-10">
                                    <label id="lblAcceptedRejectedNotes" for="txtAcceptedRejectedNotes">Accepted / Rejected
                                        Notes</label>
                                    <textarea class="form-control" id="txtAcceptedRejectedNotes" name="txtAcceptedRejectedNotes" placeholder="Notes"> </textarea>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <footer id="id" name="id" class="blockquote-footer"></footer>
                                </div>
                            </div>

                        </form>

                        <div class="modal-footer">
                            <button type="button" id="btnRestore" class="btn btn-warning pull-left">Restore</button>
                            <button type="button" id="btnRejectRequest" class="btn btn-danger pull-left">Save and
                                Reject</button>
                            <button type="button" id="btnAcceptRequest" class="btn btn-success pull-left">Save and
                                Accept</button>
                            <button id="submit" type="submit" class="btn btn-primary pull-left">Save</button>
                            <button id="btnClose" type="button" class="btn btn-secondary pull-right" data-dismiss="modal">Close</button>

                        </div>
                </form>
            </div>
        </div>
    </div>


    <noscript>You need to enable JavaScript to run this app.</noscript>
    <!-- Bootstrap core JavaScript-->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <!-- Core plugin JavaScript-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js" integrity="sha256-4iQZ6BVL4qNKlQ27TExEhBN1HFPvAvAMbFavKKosSWQ=" crossorigin="anonymous"></script>
    <!-- Bootstrap DatePicker -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js" integrity="sha256-bqVeqGdJ7h/lYPq6xrPv/YGzMEb6dNxlfiTUHSgRCp8=" crossorigin="anonymous"></script>
    <!-- Genesys Cloud -->
    <script src="https://sdk-cdn.mypurecloud.com/javascript/61.0.0/purecloud-platform-client-v2.min.js"></script>
    <!-- Editable -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js"></script>
    <!-- JQuery Validate -->
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/additional-methods.min.js"></script>
    <!-- jQuery Toast -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.js"></script>
    <!-- Bootbox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.4.0/bootbox.min.js"></script>
    <!-- Bootstrap Select -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>
    <!-- Our Scripts -->
    <script src="js/requests.js"></script>
    <script src="js/tools.js"></script>
    <!-- Dictionary -->
    <script src="js/dictionary.js"></script>

    <script>

        let countriesAndCarriers = [], countryCarrierId = 0, selectedCountries = [];

        if (window.location.href.includes('dev'))
            $("#devModeImage").removeAttr('hidden');

        let gcToken = localStorage.getItem("gcToken");
        let userName = localStorage.getItem("userName");

        if (!gcToken)
            window.open('./index.html', "_self");
        console.log(`continue with gcToken: ${gcToken}`);

        let tasksControls = [], taskId = 10000;

        let region = getUrlParameter("region");
        $("#region").text(region);

        // SetLink for Dashboard
        document.getElementById("dashboardLink").setAttribute("href", `./dashboard.html?region=${$("#region").text()}`);

        // Populate telephonyModel selects from dictionary
        $.each(telephonyModel, (key, value) => {
            $("<option/>", { value: key }).text(value).appendTo("#telephonyModel");
        });

        // Populate countries selects
        $.each(countries, (i, country) => {
            $("<option/>", { value: country.name, ["data-gcv"]: country.gcv }).text(country.name).appendTo("#countriesAgents, #countriesOperation");
        });

        $("#countriesAgents").selectpicker({
            width: '100%',
            selectedTextFormat: 'count > 3',
            title: "Select one or more countries"
        });

        $("#countriesOperation").selectpicker({
            width: '100%',
            selectedTextFormat: 'count > 3',
            title: "Select one or more countries"
        });

        var requests = {
            updateItem: function (updatingRequest) { },
            deleteItem: function (deletingRequest) {
                var requestIndex = $.inArray(deletingRequest, this.requests);
                this.requests.splice(requestIndex, 1);
            }
        }

        if (maintenanceMode) {
            $("#alert").attr("hidden", false);
            $("#basicgrid").attr("disabled", true);
        } else {
            showRequests();
        }

        $(function () {
            $("#datepicker").datepicker({
                daysOfWeekDisabled: "0,6",
                todayHighlight: true,
                autoclose: true,
                startDate: new Date()
            });
        });

        function initModal() {
            $("#editModal #id").text("");
            $("#editModal #createdDate").val("");
            $("#editModal #updatedDate").val("");

            // Telephony
            $("#editModal #telephonyModel").val("");
            $("#editModal #telephonyModel").change();
            $("#editModal #countriesAgents").val("");
            $("#editModal #countriesAgents").selectpicker('refresh');
            $("#editModal #countriesOperation").val("");
            $("#editModal #countriesOperation").selectpicker('refresh');

            // GCV
            $("#editModal #phoneNumbersDeployment").val("");
            $("#editModal #newNumbers").val("");

            // BYOC Cloud
            $("#editModal #relationshipWithCarrier").attr('checked', false)

            // BYOC Premise
            $("#editModal #hyperVEnvironment").val("");

            // Common Questions
            $("#editModal #customerResourceCommitted").attr('checked', false);
            $("#editModal #projectSponsorAssigned").attr('checked', false);
            $("#editModal #changeManagementProcess").val("");
            $("#editModal #regulatoryConsiderations").val("");
            $("#editModal #callFlowsDocumented").attr('checked', false);
            $("#editModal #promptsAvailable").attr('checked', false);
            $("#editModal #identificationAndVerificationProcesses").val("");
            $("#editModal #itInfrastructure").val("");
            $("#editModal #usersInternetBandwidth").attr('checked', false);
            $("#editModal #endUserDevicesRequireVPN").attr('checked', false);
            $("#editModal #virtualDesktopSolution").val("");
            $("#editModal #emailInfrastructure").val("");

            // Requester Info
            $("#editModal #region").val("");
            $("#editModal #region").change();
            $("#editModal #subRegion").val("");
            $("#editModal #requesterName").val("");
            $("#editModal #requesterEmail").val("");
            $("#editModal #requesterPhoneNumber").val("");
            $("#editModal #datepicker").datepicker('update', '');
            $("#editModal #notes").val("");
            $("#editModal #partnerCustomerName").val("");
            $("#editModal #salesforceAccountOpportunity").val("");

            // CC Fields
            $("#editModal #priority").val("");
            $("#editModal #bAcceptedRequest").val("");
            $("#editModal #status").val("");
            $("#editModal #programManager").val("");
            $("#editModal #txtAcceptedRejectedNotes").val("");
            $("#editModal #teamMembers").val("");

            validator.resetForm(); // Reset validation errors
        }

        function refreshGrid() {
            $("#basicgrid").jsGrid("loadData");
        }

        $("#refresh").on("click", (e) => {
            e.preventDefault();
            refreshGrid();
        });

        function navigateToSFLink() {

            var copyText = document.getElementById("salesforceAccountOpportunity");
            copyText.select();
            document.execCommand("copy");
            // Clear selection
            window.getSelection().removeAllRanges();
            document.getElementById("btnCopySFLink").textContent = "copied! "
            setTimeout(function () {
                document.getElementById("btnCopySFLink").textContent = "copy"
            }, 1000);
        }

        var searches = {};

        function showRequests() {
            console.log('Showing requests...');

            try {

                jsGrid.setDefaults({ tableClass: "jsgrid-table table table-striped table-hover" });
                jsGrid.setDefaults("control", {
                    _createGridButton: function (cls, tooltip, clickHandler) {
                        var grid = this._grid;
                        return $("<button>").addClass(this.buttonClass).addClass(cls).attr({
                            type: "button",
                            title: tooltip
                        }).on("click", function (e) {
                            clickHandler(grid, e)
                        })
                    }
                });

                $("#basicgrid").jsGrid({
                    height: "100vh",
                    width: "100%",
                    filtering: true,
                    editing: false,
                    sorting: true,
                    paging: true,
                    autoload: true,
                    pageSize: 25,
                    pageButtonCount: 5,
                    loadIndication: true,
                    loadIndicationDelay: 500,
                    loadMessage: "Loading...",
                    loadShading: true,
                    autoload: true,
                    rowClick: function (args) {
                        showModal(args.item);
                    },
                    rowClass: function (item, itemIndex) {

                        // Hide by default Test objects on PRD url
                        if (!window.location.href.includes('localhost') && item.hasOwnProperty('isTest')) {
                            return "task-hidden"
                        }
                        if (item.acceptedRejected == "Accepted") {
                            return "task-accepted"
                        } else if (item.acceptedRejected == "Rejected")
                            return "task-rejected"
                        else
                            return
                    },
                    deleteItem: async function (deletingRequest) {
                        bootbox.confirm({
                            message: 'Do you really want to delete this request?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    console.log('Deleting:', deletingRequest);
                                    try {
                                        await deleteRequest(deletingRequest.id);
                                        refreshGrid();
                                        showMessage("Request deleted", false);
                                    } catch (error) {
                                        console.error(error);
                                        if (error.status == 401) {
                                            window.open('./index.html', "_self");
                                        } else
                                            showMessage(error.hasOwnProperty('responseJSON') ? error.responseJSON.message : error, true);
                                    }

                                }
                            }
                        });
                    },
                    controller: {
                        loadData: async function (filter) {
                            let hasFilter = false;

                            // Check if Assigned to Me is filled in!
                            if ($("#basicgrid").data('JSGrid').fields[6].filterControl.val() == userName) {
                                filter['teamMembers'] = userName
                            }

                            for (var field in filter) {
                                if (filter[field]) {
                                    hasFilter = true;
                                }
                            }

                            if (filter['teamMembers'] !== userName)
                                $('#btnAssignedToMe')[0].classList.remove('btn-success');
                            else
                                $('#btnAssignedToMe')[0].classList.add('btn-success');

                            try {
                                requests.requests = await getRequests(region, gcToken);

                                // set default values for undefined/optional item. Without it filtering fails
                                requests.requests.forEach(function (aItem) {
                                    if (!aItem.teamMembers)
                                        aItem.teamMembers = 'n/a';
                                    if (!aItem.partnerCustomerName)
                                        aItem.partnerCustomerName = 'n/a';
                                });

                                console.log(`filter: ${JSON.stringify(filter)}`);
                                if (hasFilter) {
                                    return $.grep(requests.requests, function (request) {
                                        return (!filter.id || request.id.toLowerCase().indexOf(filter.id.toLowerCase()) > -1)
                                            && (!filter.region || request.region.toLowerCase().indexOf(filter.region.toLowerCase()) > -1)
                                            && (!filter.subRegion || request.subRegion.toLowerCase().indexOf(filter.subRegion.toLowerCase()) > -1)
                                            && (!filter.requesterName || request.requesterName.toLowerCase().indexOf(filter.requesterName.toLowerCase()) > -1)
                                            && (!filter.partnerCustomerName || request.partnerCustomerName.toLowerCase().indexOf(filter.partnerCustomerName.toLowerCase()) > -1)
                                            && (!filter.teamMembers || request.teamMembers.toLowerCase().indexOf(filter.teamMembers.toLowerCase()) > -1)
                                            && (!filter.telephonyModel || request.telephonyModel.toLowerCase().indexOf(filter.telephonyModel.toLowerCase()) > -1)
                                            && (!$('#btnOnlyClosed')[0].classList.contains('btn-success') || request.status === "Closed")
                                            && (!$('#btnOnlyDeleted')[0].classList.contains('btn-success') || request.isDeleted)
                                    });
                                } else {
                                    return requests.requests;
                                }
                            } catch (error) {
                                if (error.status == 401) {
                                    window.open('./index.html', "_self");
                                }
                            }
                        }
                    },
                    noDataContent: "No Requests",
                    fields: [
                        {
                            name: "id",
                            title: "Id",
                            type: "text",
                            width: "auto",
                            itemTemplate: function (value, item) {
                                return `<small>${value}</small>`;
                            },
                            visible: false
                        }, {
                            name: "region",
                            title: "Region",
                            type: "select",
                            filterTemplate: function () {
                                let select = $("<select/>", { id: "selectRegion" });
                                $("<option/>", { value: "" }).text("(All)").appendTo(select);
                                for (const region of Object.keys(regions)) {
                                    let option = $("<option/>", { value: region }).text(region).appendTo(select);
                                }
                                select.on('change', (e) => {
                                    let selectedRegion = select.children("option:selected").val();
                                    searches.region = selectedRegion;
                                    $("#selectSubRegion").empty();
                                    $("<option/>", { value: "" }).text("(All)").appendTo("#selectSubRegion");
                                    if (selectedRegion && selectedRegion != "(All)") {
                                        for (const subRegion of regions[selectedRegion]) {
                                            let option = $("<option/>", { value: subRegion }).text(subRegion).appendTo("#selectSubRegion");
                                        }
                                    } else {
                                        searches.subRegion = "";
                                    }
                                    $("#selectSubRegion").on('change', (e) => {
                                        let selectedSubRegion = $("#selectSubRegion").children("option:selected").val();
                                        searches.subRegion = selectedSubRegion;
                                        $("#basicgrid").data('JSGrid').search(searches);
                                    });
                                    $("#basicgrid").data('JSGrid').search(searches);
                                });
                                return this.filterControl = select;
                            },
                            items: Object.keys(regions),
                            itemTemplate: function (value, item) {
                                return value;
                            },
                            width: "auto",
                            visible: region == 'super-user' ? true : false,
                        }, {
                            name: "subRegion",
                            title: "Territory",
                            type: "select",
                            width: "auto",
                            align: "center",
                            filterTemplate: function () {
                                let select = $("<select/>", { id: "selectSubRegion" });
                                $("<option/>", { value: "" }).text("(All)").appendTo(select);
                                let selectedRegion = $("#selectRegion").children("option:selected").val();
                                if (selectedRegion && selectedRegion != "(All)") {
                                    for (const subRegion of regions[selectedRegion]) {
                                        let option = $("<option/>", { value: subRegion }).text(subRegion).appendTo(select);
                                    }
                                }
                                select.on('change', (e) => {
                                    let selectedSubRegion = select.children("option:selected").val();
                                    searches.subRegion = selectedSubRegion;
                                    $("#basicgrid").data('JSGrid').search(searches);
                                });
                                return this.filterControl = select;
                            },
                            items: $("#selectRegion").children("option:selected").val() == "(All)" ? Object.keys(regions) : regions[$("#selectRegion").children("option:selected").val()],
                            itemTemplate: function (value, item) {
                                return value;
                            }
                        }, {
                            name: "partnerCustomerName",
                            title: "Partner/Customer",
                            type: "text",
                            width: "160",
                            align: "center",
                            filterTemplate: function () {
                                let input = $("<input/>", { type: "text" });
                                input.on('keyup', () => {
                                    searches.partnerCustomerName = input.val();
                                    $("#basicgrid").data('JSGrid').search(searches);
                                });
                                return this.filterControl = input;
                            },
                        },
                        {
                            name: "telephonyModel",
                            title: "Telephony Model",
                            type: "text",
                            width: "auto",
                            align: "center",
                            filterTemplate: function () {
                                let select = $("<select/>", { id: "telephonyModel" });
                                $("<option/>", { value: "" }).text("(All)").appendTo(select);

                                $.each(telephonyModel, (key, value) => {
                                    $("<option/>", { value: key }).text(value).appendTo(select);
                                }),

                                    select.on('change', (e) => {
                                        let selectedTelephonyModel = select.children("option:selected").val();
                                        searches.telephonyModel = selectedTelephonyModel;
                                        $("#basicgrid").data('JSGrid').search(searches);
                                    });
                                return this.filterControl = select;
                            },
                            items: $("#selectRegion").children("option:selected").val() == "(All)" ? Object.keys(regions) : regions[$("#selectRegion").children("option:selected").val()],
                            itemTemplate: function (value, item) {

                                return telephonyModel[value];
                            }
                        }, {
                            name: "requesterName",
                            title: "Requester Name",
                            type: "text",
                            width: "auto",
                            align: "center",
                            filterTemplate: function () {
                                let input = $("<input/>", { type: "text" });
                                input.on('keyup', () => {
                                    searches.requesterName = input.val();
                                    $("#basicgrid").data('JSGrid').search(searches);
                                });
                                return this.filterControl = input;
                            },
                        },
                        {
                            name: "teamMembers", // index=6
                            title: "Team Members",
                            type: "text",
                            width: "auto",
                            visible: true,
                            align: "center",
                            filterTemplate: function () {
                                let input = $("<input/>", { type: "text" });
                                input.on('keyup', () => {
                                    searches.teamMembers = input.val();
                                    $("#basicgrid").data('JSGrid').search(searches);
                                });
                                return this.filterControl = input;
                            },
                        }, {
                            name: "needCompletedBy",
                            title: "Need Completed",
                            type: "text",
                            itemTemplate: function (value, item) {
                                if (value != "Invalid dateZ") {
                                    return `${moment.utc(value).fromNow()}`;
                                } else {
                                    return '';
                                }
                            },
                            width: "auto",
                            filtering: false,
                            align: "center",
                        },
                        {
                            name: "createdAt",
                            title: "Created",
                            type: "text",
                            itemTemplate: function (value, item) {
                                return `${moment(value).fromNow()}`;
                            },
                            width: "auto",
                            filtering: false,
                            align: "center"
                        }, {
                            type: "control",
                            itemTemplate: function (value, item) {
                                var $result = $([]);

                                if (item.isDeleted == false) {
                                    $result = $result.add(this._createDeleteButton(item));
                                }
                                return $result;
                            }
                        }],
                });
            } catch (error) {
                console.error(error);
            }
        }

        function showModal(request) {
            console.log("Showing modal for:", request);

            if (request.acceptedRejected)
                $("#editModal #title").text(`Request (${request.acceptedRejected})`)
            else
                $("#editModal #title").text(`Request (not handled)`);

            $("#editModal #id").text(request.id);
            $("#editModal #createdDate").val(moment(request.createdAt).format('LLLL'));
            $("#editModal #updatedDate").val(moment(request.updatedAt).fromNow());

            // Telephony
            countriesAndCarriers = request.byocCloudCarriers;
            $("#editModal #telephonyModel").val(request.telephonyModel);
            $("#editModal #telephonyModel").change();
            $("#editModal #countriesAgents").val(request.countriesAgents);
            $("#editModal #countriesAgents").selectpicker('refresh');
            $("#editModal #countriesOperation").val(request.countriesOperation);
            $("#editModal #countriesOperation").selectpicker('refresh');

            // GCV
            $("#editModal #phoneNumbersDeployment").val(request.phoneNumbersDeployment);
            $("#editModal #newNumbers").val(request.newNumbers);

            // BYOC Cloud
            $("#editModal #relationshipWithCarrier").attr('checked', request.relationshipWithCarrier)

            // BYOC Premise
            $("#editModal #hyperVEnvironment").val(request.hyperVEnvironment);

            // Common Questions
            $("#editModal #customerResourceCommitted").attr('checked', request.customerResourceCommitted);
            $("#editModal #projectSponsorAssigned").attr('checked', request.projectSponsorAssigned);
            $("#editModal #changeManagementProcess").val(request.changeManagementProcess);
            $("#editModal #regulatoryConsiderations").val(request.regulatoryConsiderations);
            $("#editModal #callFlowsDocumented").attr('checked', request.callFlowsDocumented);
            $("#editModal #promptsAvailable").attr('checked', request.promptsAvailable);
            $("#editModal #identificationAndVerificationProcesses").val(request.identificationAndVerificationProcesses);
            $("#editModal #itInfrastructure").val(request.itInfrastructure);
            $("#editModal #usersInternetBandwidth").attr('checked', request.usersInternetBandwidth);
            $("#editModal #endUserDevicesRequireVPN").attr('checked', request.endUserDevicesRequireVPN);
            $("#editModal #virtualDesktopSolution").val(request.virtualDesktopSolution);
            $("#editModal #emailInfrastructure").val(request.emailInfrastructure);

            // Requester Info
            $("#editModal #region").val(request.region);
            $("#editModal #region").change();
            $("#editModal #subRegion").val(request.subRegion);
            $("#editModal #requesterName").val(request.requesterName);
            $("#editModal #requesterEmail").val(request.requesterEmail);
            $("#editModal #requesterPhoneNumber").val(request.requesterPhoneNumber);
            $("#editModal #datepicker").datepicker('update', new Date(request.needCompletedBy));
            $("#editModal #notes").val(request.notes);
            $("#editModal #partnerCustomerName").val(request.partnerCustomerName);
            $("#editModal #salesforceAccountOpportunity").val(request.salesforceAccountOpportunity);

            // CC Fields
            $("#editModal #priority").val(request.priority);
            $("#editModal #bAcceptedRequest").val(request.acceptedRejected);
            $("#editModal #status").val(request.status);
            $("#editModal #programManager").val(request.programManager);
            $("#editModal #txtAcceptedRejectedNotes").val(request.acceptedRejectedNotes);
            $("#editModal #teamMembers").val(request.teamMembers);
            $("#editModal").modal("show");

            if (request.isDeleted) {
                $("#modal-form :input").attr("disabled", true);
                $("#btnClose").prop('disabled', false);
                $("#btnRejectRequest").attr("hidden", true);
                $("#submit").attr("hidden", true);
                $("#btnAcceptRequest").attr("hidden", true);
                $("#btnRestore").attr("disabled", false);
                $("#btnRestore").attr("hidden", false);
            } else {
                $("#modal-form :input").attr("disabled", false);
                $("#btnRejectRequest").attr("hidden", false);
                $("#submit").attr("hidden", false);
                $("#btnAcceptRequest").attr("hidden", false);
                $("#btnRestore").attr("hidden", true);
                $("#createdDate").attr("disabled", true);
                $("#updatedDate").attr("disabled", true);
            }

            if (request.acceptedRejected == "Accepted") {
                $("#modal-header").css('background', 'lightgreen');
                if (!request.isDeleted) {
                    console.log('Not deleted!')
                    $("#editModal #btnAcceptRequest").prop('disabled', true);
                    $("#editModal #btnRejectRequest").prop('disabled', false);
                }
            }
            else if (request.acceptedRejected == "Rejected") {
                $("#modal-header").css('background', 'lightcoral');
                if (!request.isDeleted) {
                    $("#btnAcceptRequest").prop('disabled', false);
                    $("#btnRejectRequest").prop('disabled', true);
                }
            } else {
                $("#modal-header").css('background', 'white');
                if (!request.isDeleted) {
                    $("#btnAcceptRequest").prop('disabled', false);
                    $("#btnRejectRequest").prop('disabled', false);
                }
            }
        }

        $("#editModal #telephonyModel").on('change', (e) => {
            console.log('Telephony Model:', $("#editModal #telephonyModel").val());
            switch ($("#editModal #telephonyModel").val()) {
                case 'GCV':
                    $("#editModal #byocCloudCarriersDiv").hide();
                    $("#editModal #byocPremiseDiv").hide();
                    $("#editModal #BYOCCloudQuestions").hide();
                    $("#editModal #BYOCPremiseQuestions").hide();

                    $("#editModal #GCVQuestions").show();
                    break;
                case 'BYOCCloud':
                    $("#editModal #byocPremiseDiv").hide();
                    $("#editModal #GCVQuestions").hide();
                    $("#editModal #BYOCPremiseQuestions").hide();

                    refreshBYOCCloudCountryCarriers();
                    $("#editModal #byocCloudCarriersDiv").show();
                    $("#editModal #BYOCCloudQuestions").show();
                    break;
                case 'BYOCPremiseWithVirtualEdges':
                    $("#editModal #byocCloudCarriersDiv").hide();
                    $("#editModal #GCVQuestions").hide();
                    $("#editModal #phoneNumbersDeployment").val('');
                    $("#editModal #BYOCCloudQuestions").hide();

                    $("#editModal #BYOCPremiseQuestions").show();
                    $("#editModal #byocPremiseDiv").show();
                    break;
                default:
                    // Hide everything
                    $("#editModal #byocCloudCarriersDiv").hide();
                    $("#editModal #byocPremiseDiv").hide();
                    $("#editModal #GCVQuestions").hide();
                    $("#editModal #phoneNumbersDeployment").val('');
                    $("#editModal #BYOCCloudQuestions").hide();
                    $("#editModal #BYOCPremiseQuestions").hide();
                    break;
            }
        });

        function refreshBYOCCloudCountryCarriers() {
            let currentCountryCarrierId = countryCarrierId++;

            $("#byocCloudCarriers").empty();

            // If no countries and carriers are present, this means the program manager has changed the telephony model
            if (countriesAndCarriers.length == 0) {
                $.each($("#countriesOperation").val(), (i, country) => {

                    // Country
                    let countryDiv = $("<div/>", { class: "form-group col-md-5" }).appendTo("#byocCloudCarriers");
                    $("<label/>", { id: "country_" + country }).text(country).appendTo(countryDiv);

                    // Carriers
                    let carriersDiv = $("<div/>", { class: "form-group col-md-5" }).appendTo("#byocCloudCarriers");
                    let carriersSelect = $("<select/>", { class: "selectpicker form-control", id: "carriers_" + country, name: "carriers_" + country, ["data-live-search"]: true, required: true, multiple: true }).appendTo(carriersDiv);
                    //$("<option/>", { value: "", disabled: true }).text("Select a Carrier").appendTo(carriersSelect);
                    $.each(supportedBYOCCloudCarriers, (region, regionalSupportedBYOCCloudCarriers) => {
                        let optGroup = $("<optgroup/>", { label: region }).appendTo(carriersSelect);
                        $.each(regionalSupportedBYOCCloudCarriers, (i, regionalSupportedBYOCCloudCarrier) => {
                            $("<option/>", { value: regionalSupportedBYOCCloudCarrier.name }).text(regionalSupportedBYOCCloudCarrier.name).appendTo(optGroup);
                        });
                    });
                    $("<option/>", { value: "Other" }).text("Other").appendTo(carriersSelect);
                    carriersSelect.selectpicker({
                        title: "Select one or more carriers"
                    });
                    carriersSelect.on('change', (e) => {
                        if (carriersSelect.val().includes("Other")) {
                            $("otherNote").show();
                        } else {
                            $("otherNote").hide();
                        }

                        let bFound = false;
                        for (var i in countriesAndCarriers) {
                            if (countriesAndCarriers[i].hasOwnProperty(country)) {
                                countriesAndCarriers[i] = {
                                    [country]: carriersSelect.val().join(',')
                                }
                                bFound = true;
                                break;
                            }
                        }
                        if (!bFound) {
                            // Add to array
                            countriesAndCarriers.push({
                                [country]: carriersSelect.val().join(',')
                            });
                        }

                    });
                });
            }
            else {
                $.each(countriesAndCarriers, (i, byocCloudCarrier) => {
                    console.log(i, byocCloudCarrier);
                    let country = Object.keys(byocCloudCarrier)[0];
                    let carriers = Object.values(byocCloudCarrier)[0].split(',');

                    // Country
                    let countryDiv = $("<div/>", { class: "form-group col-md-6" }).appendTo("#byocCloudCarriers");
                    $("<label/>", { id: "country_" + country }).text(country).appendTo(countryDiv);

                    // Carriers
                    let carriersDiv = $("<div/>", { class: "form-group col-md-6" }).appendTo("#byocCloudCarriers");
                    let carriersSelect = $("<select/>", { class: "selectpicker form-control", id: "carriers_" + country, name: "carriers_" + country, ["data-live-search"]: true, required: true, multiple: true }).appendTo(carriersDiv);
                    //$("<option/>", { value: "", disabled: true }).text("Select a Carrier").appendTo(carriersSelect);
                    $.each(supportedBYOCCloudCarriers, (region, regionalSupportedBYOCCloudCarriers) => {
                        let optGroup = $("<optgroup/>", { label: region }).appendTo(carriersSelect);
                        $.each(regionalSupportedBYOCCloudCarriers, (i, regionalSupportedBYOCCloudCarrier) => {
                            $("<option/>", { value: regionalSupportedBYOCCloudCarrier.name, selected: carriers.includes(regionalSupportedBYOCCloudCarrier.name) }).text(regionalSupportedBYOCCloudCarrier.name).appendTo(optGroup);
                        });
                    });
                    $("<option/>", { value: "Other", selected: carriers.includes('Other') }).text("Other").appendTo(carriersSelect);
                    carriersSelect.selectpicker({
                        title: "Select one or more carriers"
                    });
                    carriersSelect.on('change', (e) => {
                        let bFound = false;
                        for (var i in countriesAndCarriers) {
                            if (countriesAndCarriers[i].hasOwnProperty(country)) {
                                countriesAndCarriers[i] = {
                                    [country]: carriersSelect.val().join(',')
                                }
                                bFound = true;
                                break;
                            }
                        }
                        if (!bFound) {
                            // Add to array
                            countriesAndCarriers.push({
                                [country]: carriersSelect.val().join(',')
                            });
                        }

                    });
                });
            }
        }

        $("#editModal #region").on("change", () => {
            $("#editModal #subRegion").empty();
            if (!$("#editModal #region").val()) return;
            for (let subregion of regions[$("#editModal #region").val()]) {
                $("<option/>", { value: subregion }).text(subregion).appendTo("#editModal #subRegion");
            }
        });

        $('#editModal').on('hidden.bs.modal', async () => {
            refreshGrid();
            initModal();
        });

        let validator = $("#editModal #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success"
        });

        $("#btnAssignedToMe").on("click", async (e) => {
            if ($('#btnAssignedToMe')[0].classList.contains('btn-success')) {
                $('#btnAssignedToMe')[0].classList.remove('btn-success');
                $("#basicgrid").data('JSGrid').fields[6].filterControl[0].value = "";
                searches.teamMembers = "";
                $("#basicgrid").data('JSGrid').search(searches);
            }
            else {
                $('#btnAssignedToMe')[0].classList.add('btn-success');
                $("#basicgrid").data('JSGrid').fields[6].filterControl[0].value = userName;
                searches.teamMembers = userName;
                $("#basicgrid").data('JSGrid').search(searches);
            }

        });

        $("#btnOnlyClosed").on("click", async (e) => {
            if ($('#btnOnlyClosed')[0].classList.contains('btn-success'))
                $('#btnOnlyClosed')[0].classList.remove('btn-success');
            else
                $('#btnOnlyClosed')[0].classList.add('btn-success');

            refreshGrid();
        });

        $("#btnOnlyDeleted").on("click", async (e) => {
            if ($('#btnOnlyDeleted')[0].classList.contains('btn-success'))
                $('#btnOnlyDeleted')[0].classList.remove('btn-success');
            else
                $('#btnOnlyDeleted')[0].classList.add('btn-success');

            refreshGrid();
        });

        $("#btnAcceptRequest").on("click", async (e) => {
            $("#editModal #bAcceptedRequest").val("Accepted");
            $("#editModal #submit").click();
        });

        $("#btnRejectRequest").on("click", async (e) => {
            $("#editModal #bAcceptedRequest").val("Rejected");
            $("#editModal #submit").click();
        });

        $("#btnRestore").on("click", async (e) => {
            e.preventDefault();
            $("#editModal #submit").click();
        });

        $("#editModal #submit").on("click", async (e) => {
            e.preventDefault();
            if (!$("#modal-form").valid()) {
                showMessage("Missing or invalid fields", true);
                return;
            }

            try {
                // Disable button and add animation
                $("#editModal #submit").prop('disabled', true);
                $("#editModal #submit").html(
                    `<span class="spinner-border-sm text-light" role="status" aria-hidden="true"></span> Please Wait...`
                )
                $("#editModal #btnAcceptRequest").prop('disabled', true);
                $("#editModal #btnAcceptRequest").html(
                    `<span class="spinner-border-sm text-light" role="status" aria-hidden="true"></span> Please Wait...`
                )
                $("#editModal #btnRejectRequest").prop('disabled', true);
                $("#editModal #btnRejectRequest").html(
                    `<span class="spinner-border-sm text-light" role="status" aria-hidden="true"></span> Please Wait...`
                )

                console.log('Updating request...');
                await putRequest();
                console.log('Success!');
                showMessage("Request updated. Thanks!");

                $("#editModal").modal("hide");
            } catch (error) {
                console.error(error);
                if (error.status == 401) {
                    window.open('./index.html', "_self");
                } else
                    showMessage(error.hasOwnProperty('responseJSON') ? error.responseJSON.message : error, true);
            } finally {
                // Enable buttons
                $("#editModal #submit").prop('disabled', false);
                $("#editModal #submit").html('Save');
                $("#editModal #btnAcceptRequest").prop('disabled', false);
                $("#editModal #btnAcceptRequest").html('Save and Accept');
                $("#editModal #btnRejectRequest").prop('disabled', false);
                $("#editModal #btnRejectRequest").html('Save and Reject');
            }
        });

        function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
        };

    </script>

    <!--Coollabs -->
    <script async defer src="https://cdn.coollabs.io/save.js"></script>

</body>

</html>