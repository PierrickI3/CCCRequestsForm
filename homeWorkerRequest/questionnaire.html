<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <title>CC PS Questionnaire</title>
    <link rel="shortcut icon" href="/favicon.ico">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Tempus Dominus -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/css/tempusdominus-bootstrap-4.min.css" />
    <!-- jQuery Toast -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.css" rel="stylesheet">
    <!-- Bootstrap Select -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
    <!-- jQuery UI Theme -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/flick/jquery-ui.css">
    <!-- JSGrid -->
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.css" />
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.min.css" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="./css/ps_questionnaire.css">
    <link href="https://fonts.googleapis.com/css?family=Exo" rel="stylesheet">
</head>

<body>
    <img class="overlay" src="./images/devmode.png" id="devModeImage" hidden alt="devMode" />
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand" href="#">
            <img src="images/genesys.png" width="30" height="30" class="d-inline-block align-top" alt="">
            <span class="badge badge-info mr-2">#ps</span>Rapid Response Questionnaire <small><span id="badgePill" class="badge badge-pill badge-warning"></span></small>
        </a>
        <ul class="mb-0">

            <ul class="nav navbar-nav" style="float: right;">
                <li><button id="exportCSV" onclick="exportCSV();" href="#" class="btn btn-dark btn-sm ml-2" disabled>Generate CSV</button></li>
            </ul>

            <ul class="nav navbar-nav" style="float: right;">
                <li><button id="saveDraft" href="#" onclick="saveDraft(true);" class="btn btn-primary btn-sm ml-2" disabled>Save draft</button></li>
            </ul>
        </ul>
    </nav>

    <div class="alert alert-danger fade show" role="alert" id="alert" hidden>
        <strong>Maintenance Alert</strong> This site is being updated. Please wait.
        <a class="btn btn-light" href="#" onclick="location.reload();"><i class="fa fa-refresh"></i> Refresh</a>
    </div>

    <div class="container-fluid mt-4">
        <div class="text-center" style="display: none;" id="saveUrl">
        </div>
        <div class="form-row">
            <div class="form-group col-md-12">
                <div id="status">

                </div>
                <center>
                    <div id="spinner" class="justify-content-center">
                        <div class="spinner-grow text-secondary" role="status">
                        </div>
                        <br>
                        <p id="spinner_message" class="text-secondary">loading...</p>
                    </div>

                    <div id="accordion">
                        <div class="card" id="divRequestDetails" hidden>
                            <div class="card-header card-header-top" id="headingOne">
                                <h5 class="mb-0">
                                    <button class="btn btn-outline-success collapsed" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                        Linked request
                                    </button>
                                </h5>
                            </div>

                            <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                                <div class="card-body">
                                    <label id="requestDetails"></label>


                                </div>
                            </div>
                        </div>

                    </div>
                </center>

                <section id="mainForm" hidden>
                    <div class="row">
                        <div class="col-md-8 offset-md-2">
                            <div class="bd-example" data-example-id="">
                                <div id="accordion" role="tablist" aria-multiselectable="true">

                                    <!-- Organization Setup -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingOrgSetup">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOrg" aria-expanded="false" aria-controls="collapseOrg" class="collapsed">
                                                    <i class="fa fa-sitemap" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>Organization Setup</h3>
                                                    <p>First things first, let's define some basic information about the customer</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseOrg" class="collapse" role="tabpanel" aria-labelledby="headingOrgSetup" aria-expanded="false">
                                            <div class="card-block">
                                                <div class="form-group row">
                                                    <label for="companyName" class="col-sm-2 col-form-label">Company Name</label>
                                                    <div class="col-sm-10">
                                                        <input type="text" class="form-control" id="companyName" name="companyName" placeholder="Enter the name of the company">
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="genesysCloudRegion" class="col-sm-2 col-form-label">Genesys Cloud Region</label>
                                                    <div class="col-sm-10">
                                                        <select class="custom-select" id="genesysCloudRegion" name="genesysCloudRegion">
                                                            <option selected disabled>Select a Genesys Cloud Region</option>
                                                            <optgroup label="North America">
                                                                <option value="cac1.pure.cloud" disabled>cac1.pure.cloud - Canada</option>
                                                                <option value="mypurecloud.com">mypurecloud.com - East</option>
                                                                <option value="usw2.pure.cloud">usw2.pure.cloud - West</option>
                                                            </optgroup>
                                                            <optgroup label="EMEA">
                                                                <option value="euw2.pure.cloud" disabled>euw2.pure.cloud - UK</option>
                                                                <option value="mypurecloud.de">mypurecloud.de - Frankfurt</option>
                                                                <option value="mypurecloud.ie">mypurecloud.ie - Ireland</option>
                                                            </optgroup>
                                                            <optgroup label="APAC">
                                                                <option value="apne2.pure.cloud" disabled>apne2.pure.cloud - Seoul </option>
                                                                <option value="mypurecloud.com.au">mypurecloud.com.au - Australia/New Zealand </option>
                                                                <option value="mypurecloud.jp">mypurecloud.jp - Japan </option>
                                                            </optgroup>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="numberOfUsers" class="col-sm-2 col-form-label">Number of Users</label>
                                                    <div class="col-sm-10">
                                                        <input type="number" class="form-control" id="numberOfUsers" name="numberOfUsers" placeholder="Enter the number of users">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Locations -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingLocations">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseLocations" aria-expanded="false" aria-controls="collapseLocations" class="collapsed">
                                                    <i class="fa fa-globe" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>Locations</h3>
                                                    <p>Information about each location</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseLocations" class="collapse" role="tabpanel" aria-labelledby="headingLocations" aria-expanded="false">
                                            <div class="card-block">
                                                <button id="addLocation" class="btn btn-primary mb-2" type="button"><i class="fa fa-plus"></i> Add</button>
                                                <div id="jsGridLocations"></div>

                                                <div class="modal fade" id="editModalLocations" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title">Location</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">

                                                                    <div class="form-group row">
                                                                        <label for="locationName" class="col-sm-3 col-form-label">Location Name <span class="text-danger font-weight-bold">*</span></label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="locationName" name="locationName" placeholder="Enter the name of this location" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="streetAddress" class="col-sm-3 col-form-label">Street Address <span class="text-danger font-weight-bold">*</span></label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="streetAddress" name="streetAddress" placeholder="Enter the street address" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="city" class="col-sm-3 col-form-label">City <span class="text-danger font-weight-bold">*</span></label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="city" name="city" placeholder="Enter the name of the city for this location" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="state" class="col-sm-3 col-form-label">State</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="state" name="state" placeholder="(optional) Enter the name of the state for this location">
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="zipCode" class="col-sm-3 col-form-label">Zip Code <span class="text-danger font-weight-bold">*</span></label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="zipCode" name="zipCode" placeholder="Enter the zip code for this location" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="country" class="col-sm-3 col-form-label">Country <span class="text-danger font-weight-bold">*</span></label>
                                                                        <div class="col-sm-9">
                                                                            <select class="selectpicker" id="country" name="country" class="form-control" required data-live-search="true">
                                                                            </select>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="notes" class="col-sm-3 col-form-label">Notes</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="notes" name="notes" placeholder="(optional) Describe the location (e.g. Main HQ)">
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="emergencyNumber" class="col-sm-3 col-form-label">Emergency Number <span class="text-danger font-weight-bold">*</span></label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="emergencyNumber" name="emergencyNumber" placeholder="Enter the emergency phone number for this location" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-primary pull-left"><i class="fa fa-plus"></i> Add</button>
                                                                    </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Schedules -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingSchedules">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseSchedules" aria-expanded="false" aria-controls="collapseSchedules" class="collapsed">
                                                    <i class="fa fa-calendar-o" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>Schedules</h3>
                                                    <p>Set up schedules</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseSchedules" class="collapse" role="tabpanel" aria-labelledby="headingSchedules" aria-expanded="false">
                                            <div class="card-block">
                                                <button id="addSchedule" class="btn btn-primary mb-2" type="button"><i class="fa fa-plus"></i> Add</button>
                                                <div id="jsGridSchedules"></div>

                                                <div class="modal fade" id="editModalSchedules" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title">Schedule</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">

                                                                    <div class="form-group row">
                                                                        <label for="scheduleName" class="col-sm-3 col-form-label">Schedule Name</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="scheduleName" name="scheduleName" placeholder="Enter the name of this schedule (e.g. Open Hours Weekday)" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-check row">
                                                                        <div class="form-group col-md-12">
                                                                            <input class="form-check-input" type="checkbox" value="" id="repeatingEvent">
                                                                            <label class="form-check-label" for="repeatingEvent">
                                                                                Repeating event
                                                                            </label>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Repeating Event -->
                                                                    <div id="repeatingEventDiv" style="display: none;">
                                                                        <div class="form-group row">
                                                                            <label for="interval" class="col-sm-3 col-form-label">Repeats every</label>
                                                                            <div class="col-sm-9 row">
                                                                                <input type="number" class="form-control col-md-3" id="interval" name="interval" value="1" min="1" required>
                                                                                <select id="recurrenceType" name="recurrenceType" class="form-control col-md-3 ml-1" required>
                                                                                    <option value="" disabled>Frequency</option>
                                                                                    <option value="Daily">Day</option>
                                                                                    <option value="Weekly">Week</option>
                                                                                    <option value="Monthly">Month</option>
                                                                                    <option value="Yearly">Year</option>
                                                                                </select>
                                                                                <div id="yearMonth" class="col-md-3" style="display: none;">
                                                                                    <select name="yearMonthSelect" id="yearMonthSelect" class="form-control" required>
                                                                                        <option value="" selected>Month</option>
                                                                                        <option value="1">January</option>
                                                                                        <option value="2">February</option>
                                                                                        <option value="3">March</option>
                                                                                        <option value="4">April</option>
                                                                                        <option value="5">May</option>
                                                                                        <option value="6">June</option>
                                                                                        <option value="7">July</option>
                                                                                        <option value="8">August</option>
                                                                                        <option value="9">September</option>
                                                                                        <option value="10">October</option>
                                                                                        <option value="11">November</option>
                                                                                        <option value="12">December</option>
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <!-- Weekly -->
                                                                        <div class="form-group row" id="weeklyControlsDiv" style="display: none;">
                                                                            <label for="weeklyDays" class="col-sm-2 offset-sm-3 col-form-label">Every</label>
                                                                            <div class="btn-group" data-toggle="buttons" id="weeklyDays">
                                                                                <label class="btn btn-primary active"><input type="checkbox" id="chkMonday" checked> Mo</label>
                                                                                <label class="btn btn-primary"><input type="checkbox" id="chkTuesday"> Tu</label>
                                                                                <label class="btn btn-primary"><input type="checkbox" id="chkWednesday"> We</label>
                                                                                <label class="btn btn-primary"><input type="checkbox" id="chkThursday"> Th</label>
                                                                                <label class="btn btn-primary"><input type="checkbox" id="chkFriday"> Fr</label>
                                                                                <label class="btn btn-primary"><input type="checkbox" id="chkSaturday"> Sa</label>
                                                                                <label class="btn btn-primary"><input type="checkbox" id="chkSunday"> Su</label>
                                                                            </div>
                                                                        </div>

                                                                        <!-- Monthly -->
                                                                        <div class="form-group row" id="monthlyControlsDiv" style="display: none;">
                                                                            <div class="col-md-3"></div>
                                                                            <select name="monthlyRecurrenceType" id="monthlyRecurrenceType" class="form-control col-md-2 mr-1" required>
                                                                                <optgroup label="Date">
                                                                                    <option value="On" selected>On</option>
                                                                                </optgroup>
                                                                                <optgroup label="Day of the Week">
                                                                                    <option value="IfDayIs">If Day is</option>
                                                                                    <option value="First">First</option>
                                                                                    <option value="Second">Second</option>
                                                                                    <option value="Third">Third</option>
                                                                                    <option value="Fourth">Fourth</option>
                                                                                    <option value="Last">Last</option>
                                                                                </optgroup>
                                                                            </select>

                                                                            <div class="col-md-6 row" id="byMonthDayDiv">
                                                                                <input type="text" class="form-control col-md-3" id="byMonthDay" name="byMonthDay" value="30" required data-toggle="tooltip" data-placement="top" title="Add a single day (e.g. 24) or mutliple days (e.g. 24,25,26)">
                                                                            </div>
                                                                            <div class="col-md-6 row" id="byDayDiv" style="display: none;">
                                                                                <div class="btn-group" data-toggle="buttons" id="byDay">
                                                                                    <label class="btn btn-primary active"><input type="checkbox" id="chkMonday" checked> Mo</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkTuesday"> Tu</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkWednesday"> We</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkThursday"> Th</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkFriday"> Fr</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkSaturday"> Sa</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkSunday"> Su</label>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <!-- Yearly -->
                                                                        <div class="form-group row" id="yearlyControlsDiv" style="display: none;">
                                                                            <div class="col-md-3"></div>
                                                                            <select name="yearlyRecurrenceType" id="yearlyRecurrenceType" class="form-control col-md-2 mr-1" required>
                                                                                <optgroup label="Date">
                                                                                    <option value="On" selected>On</option>
                                                                                </optgroup>
                                                                                <optgroup label="Day of the Week">
                                                                                    <option value="IfDayIs">If Day is</option>
                                                                                    <option value="First">First</option>
                                                                                    <option value="Second">Second</option>
                                                                                    <option value="Third">Third</option>
                                                                                    <option value="Fourth">Fourth</option>
                                                                                    <option value="Last">Last</option>
                                                                                </optgroup>
                                                                            </select>

                                                                            <div class="col-md-6 row" id="byYearDayDiv">
                                                                                <input type="text" class="form-control col-md-3" id="byYearDay" name="byYearDay" value="30" required data-toggle="tooltip" data-placement="top" title="Add a single day (e.g. 24) or mutliple days (e.g. 24,25,26)">
                                                                            </div>
                                                                            <div class="col-md-6 row" id="byDayDiv" style="display: none;">
                                                                                <div class="btn-group" data-toggle="buttons" id="byYearDay">
                                                                                    <label class="btn btn-primary active"><input type="checkbox" id="chkMonday" checked> Mo</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkTuesday"> Tu</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkWednesday"> We</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkThursday"> Th</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkFriday"> Fr</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkSaturday"> Sa</label>
                                                                                    <label class="btn btn-primary"><input type="checkbox" id="chkSunday"> Su</label>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                    </div>

                                                                    <!-- Single Event -->
                                                                    <div id="singleEventDiv">
                                                                    </div>

                                                                    <!-- All Day -->
                                                                    <div class="form-check row">
                                                                        <div class="form-group col-md-12">
                                                                            <input class="form-check-input" type="checkbox" value="" id="allDay">
                                                                            <label class="form-check-label" for="allDay">
                                                                                All Day
                                                                            </label>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Start Date -->
                                                                    <div class="form-group row date-row">
                                                                        <label class="col-sm-3 col-form-label">Start Date</label>
                                                                        <div class="input-group date col-md-3 date-only" id="startDate" data-target-input="nearest">
                                                                            <input type="text" class="form-control datetimepicker-input" data-target="#startDate" required />
                                                                            <div class="input-group-append" data-target="#startDate" data-toggle="datetimepicker">
                                                                                <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Start Time -->
                                                                    <div class="form-group row time-row">
                                                                        <label class="col-sm-3 col-form-label">Start Time</label>
                                                                        <div class="input-group date col-md-3 time-only" id="startTime" data-target-input="nearest">
                                                                            <input type="text" class="form-control datetimepicker-input" data-target="#startTime" />
                                                                            <div class="input-group-append" data-target="#startTime" data-toggle="datetimepicker">
                                                                                <div class="input-group-text"><i class="fa fa-clock-o"></i></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <!-- End Time -->
                                                                    <div class="form-group row time-row">
                                                                        <label class="col-sm-3 col-form-label">End Time</label>
                                                                        <div class="input-group date col-md-3 time-only" id="endTime" data-target-input="nearest">
                                                                            <input type="text" class="form-control datetimepicker-input" data-target="#endTime" />
                                                                            <div class="input-group-append" data-target="#endTime" data-toggle="datetimepicker">
                                                                                <div class="input-group-text"><i class="fa fa-clock-o"></i></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <!-- End Date -->
                                                                    <div class="form-group row date-row">
                                                                        <label class="col-sm-3 col-form-label">End Date</label>
                                                                        <div class="input-group date col-md-3 date-only" id="endDate" data-target-input="nearest">
                                                                            <input type="text" class="form-control datetimepicker-input" data-target="#endDate" />
                                                                            <div class="input-group-append" data-target="#endDate" data-toggle="datetimepicker">
                                                                                <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <!-- Footer -->
                                                                <div class="modal-footer">
                                                                    <code id="generatedRRuleCode"></code>
                                                                    <button id="generateRRule" type="button" class="btn btn-dark">Generate Rule</button>
                                                                    <button type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                    <button type="submit" class="btn btn-primary pull-left"><i class="fa fa-plus"></i> Add</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Holidays -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingHolidays">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseHolidays" aria-expanded="false" aria-controls="collapseHolidays" class="collapsed">
                                                    <i class="fa fa-sun-o" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>Holidays</h3>
                                                    <p>List of Holidays</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseHolidays" class="collapse" role="tabpanel" aria-labelledby="headingHolidays" aria-expanded="false">
                                            <div class="card-block">
                                                <button id="addHoliday" class="btn btn-primary mb-2" type="button"><i class="fa fa-plus"></i> Add</button>
                                                <div id="jsGridHolidays"></div>

                                                <div class="modal fade" id="editModalHolidays" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title">Holiday</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">

                                                                    <div class="form-group row">
                                                                        <label for="holidayName" class="col-sm-3 col-form-label">Holiday Name</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="holidayName" tabindex="-1" name="holidayName" placeholder="Enter the name of the Holiday" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row date-row">
                                                                        <label class="col-sm-3 col-form-label">Date</label>
                                                                        <div class="input-group date col-md-3 date-only" id="holidayDate" data-target-input="nearest">
                                                                            <input type="text" class="form-control datetimepicker-input" data-target="#holidayDate" required />
                                                                            <div class="input-group-append" data-target="#holidayDate" data-toggle="datetimepicker">
                                                                                <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                    <button type="submit" class="btn btn-primary pull-left"><i class="fa fa-plus"></i> Add</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ACD Skills -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingSkills">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseSkills" aria-expanded="false" aria-controls="collapseSkills" class="collapsed">
                                                    <i class="fa fa-vcard-o" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>ACD Skills</h3>
                                                    <p>Information about ACD Skills</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseSkills" class="collapse" role="tabpanel" aria-labelledby="headingSkills" aria-expanded="false">
                                            <div class="card-block">
                                                <button id="addSkill" class="btn btn-primary mb-2" type="button"><i class="fa fa-plus"></i> Add</button>
                                                <div id="jsGridSkills"></div>

                                                <div class="modal fade" id="editModalSkills" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title">ACD Skill</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">

                                                                    <div class="form-group row">
                                                                        <label for="skillName" class="col-sm-3 col-form-label">Skill Name</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="skillName" tabindex="-1" name="skillName" placeholder="Enter the name of the Skill" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-primary pull-left"><i class="fa fa-plus"></i> Add</button>
                                                                    </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- WrapUp Codes -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingWrapUpCodes">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseWrapUpCodes" aria-expanded="false" aria-controls="collapseWrapUpCodes" class="collapsed">
                                                    <i class="fa fa-sticky-note-o" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>WrapUp Codes</h3>
                                                    <p>Information about WrapUp Codes</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseWrapUpCodes" class="collapse" role="tabpanel" aria-labelledby="headingWrapUpCodes" aria-expanded="false">
                                            <div class="card-block">
                                                <button id="addWrapUpCode" class="btn btn-primary mb-2" type="button"><i class="fa fa-plus"></i> Add</button>
                                                <div id="jsGridWrapUpCodes"></div>

                                                <div class="modal fade" id="editModalWrapUpCodes" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title">WrapUp Code Name</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">

                                                                    <div class="form-group row">
                                                                        <label for="wrapUpCode" class="col-sm-3 col-form-label">WrapUp Code Name</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="wrapUpCode" tabindex="-1" name="wrapUpCode" placeholder="Enter the name of the WrapUp Code" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-primary pull-left"><i class="fa fa-plus"></i> Add</button>
                                                                    </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Queues -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingSkils">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseQueues" aria-expanded="false" aria-controls="collapseQueues" class="collapsed">
                                                    <i class="fa fa-group" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>Queues</h3>
                                                    <p>Information about Queues</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseQueues" class="collapse" role="tabpanel" aria-labelledby="headingQueues" aria-expanded="false">
                                            <div class="card-block">
                                                <button id="addQueue" class="btn btn-primary mb-2" type="button"><i class="fa fa-plus"></i> Add</button>
                                                <div id="jsGridQueues"></div>

                                                <div class="modal fade" id="editModalQueues" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title">Queue setup</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">
                                                                    <!-- QueueName -->
                                                                    <div class="form-group row">
                                                                        <div class="form-group col-md-12">
                                                                            <label for="itInfrastructure">Queue Name <span class="text-danger font-weight-bold">*</span></label>
                                                                            <input type="text" class="form-control" id="queueName" name="queueName" placeholder="Enter the name of the Queue" required></input>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Support MediaTypes -->
                                                                    <div class="form-group row">
                                                                        <div class="form-group col-md-6">
                                                                            <input class="col-form-input" type="checkbox" value="" id="enableCallbacks">
                                                                            <label class="form-check-label" for="enableCallbacks">
                                                                                Supports Callbacks?
                                                                            </label>
                                                                        </div>
                                                                        <div class="form-group col-md-6">
                                                                            <input class="col-form-input" type="checkbox" value="" id="enableEmails">
                                                                            <label class="form-check-label" for="enableEmails">
                                                                                Supports Emails?
                                                                            </label>
                                                                        </div>
                                                                    </div>

                                                                    <p>
                                                                        <center>
                                                                            <a class="btn btn-dark" data-toggle="collapse" href="#queueAdvancedSettings" role="button" aria-expanded="false" aria-controls="queueAdvancedSettings">Advanced Settings</a>
                                                                        </center>
                                                                    </p>
                                                                    <div class="row">
                                                                        <div class="col">
                                                                            <div class="collapse collapse" id="queueAdvancedSettings">
                                                                                <div class="card card-body">

                                                                                    <!-- Pre-filled values -->
                                                                                    <div class="form-group row">
                                                                                        <div class="form-group col-md-6">
                                                                                            <label for="acw">ACW Type</label>
                                                                                            <select id="acw" name="acw" class="form-control" required>
                                                                                                <option value="MANDATORY, OPTIONAL" selected>MANDATORY, OPTIONAL</option>
                                                                                                <option value="MANDATORY_TIMEOUT">MANDATORY_TIMEOUT</option>
                                                                                                <option value="MANDATORY_FORCED_TIMEOUT">MANDATORY_FORCED_TIMEOUT</option>
                                                                                            </select>
                                                                                        </div>
                                                                                        <div class="form-group col-md-4">
                                                                                            <label for="acwTimeout">ACW Timeout</label>
                                                                                            <input type="number" class="form-control" id="acwTimeout" name="acwTimeout" placeholder="ACW Timeout" disabled>
                                                                                        </div>
                                                                                    </div>

                                                                                    <div class="form-group row">
                                                                                        <div class="form-group col-md-6">
                                                                                            <label for="evaluationMethod">Evaluation Method</label>
                                                                                            <select id="evaluationMethod" name="evaluationMethod" class="form-control" required>
                                                                                                <option value="NONE" selected>NONE</option>
                                                                                                <option value="BEST">BEST</option>
                                                                                                <option value="ALL">ALL</option>
                                                                                            </select>
                                                                                        </div>
                                                                                        <div class="form-group col-md-4">
                                                                                            <label for="alertingTimeout">Alerting Timeout</label>
                                                                                            <input type="number" class="form-control" id="alertingTimeout" name="alertingTimeout" placeholder="Alerting Timeout" value="15">
                                                                                        </div>
                                                                                    </div>

                                                                                    <div class="form-group row">
                                                                                        <div class="form-group col-md-6">
                                                                                            <label for="slPercentage">Service Level Percentage</label>
                                                                                            <input type="number" class="form-control" id="slPercentage" name="slPercentage" placeholder="SL Timeout" value="80">
                                                                                        </div>
                                                                                        <div class="form-group col-md-4">
                                                                                            <label for="slDuration">Service Level Target</label>
                                                                                            <input type="number" class="form-control" id="slDuration" name="slDuration" placeholder="SL Duration in Seconds" value="20">
                                                                                        </div>
                                                                                    </div>

                                                                                    <div class="form-group row">
                                                                                        <div class="form-group col-md-6">
                                                                                            <label for="callingPartyName">Calling Party Name</label>
                                                                                            <input type="text" class="form-control" id="callingPartyName" name="callingPartyName" placeholder="Calling Party Name"></input>

                                                                                        </div>
                                                                                        <div class="form-group col-md-6">
                                                                                            <label for="callingPartyNumber">Calling Party Number</label>
                                                                                            <input type="text" class="form-control" id="callingPartyNumber" name="callingPartyNumber" placeholder="Calling Party Name"></input>
                                                                                        </div>
                                                                                    </div>

                                                                                    <div class="form-group row">
                                                                                        <div class="form-group col-md-12">
                                                                                            <label for="queueWrapUpCode">WrapUp Code</label>
                                                                                            <select class="selectpicker" id="queueWrapUpCode" name="queueWrapUpCode" class="form-control" multiple data-live-search="true">
                                                                                            </select>

                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-primary pull-left"><i class="fa fa-plus"></i> Add</button>
                                                                    </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Prompts -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingPrompts">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapsePrompts" aria-expanded="false" aria-controls="collapsePrompts" class="collapsed">
                                                    <i class="fa fa-file-audio-o" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>Prompts</h3>
                                                    <p>Upload your prompts (or use TTS) here</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapsePrompts" class="collapse" role="tabpanel" aria-labelledby="headingPrompts" aria-expanded="false">
                                            <div class="card-block">
                                                <div id="jsGridPrompts"></div>

                                                <div class="modal fade" id="editModalPrompts" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title">Prompt</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">

                                                                    <div class="form-group row">
                                                                        <label for="messageName" class="col-sm-3 col-form-label">Message Name</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="messageName" tabindex="-1" name="messageName" readonly>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="useTTS" class="col-sm-3 col-form-label">Use TTS?</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="checkbox" class="" id="useTTS" tabindex="-1" name="useTTS">
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row" id="promptTextDiv" style="display: none;">
                                                                        <label for="promptText" class="col-sm-3 col-form-label">Prompt Text</label>
                                                                        <div class="col-sm-9">
                                                                            <textarea class="form-control" id="promptText" tabindex="-1" name="promptText" required></textarea>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row" id="promptUploadDiv">
                                                                        <label for="promptFile" class="col-sm-3 col-form-label">Prompt File</label>
                                                                        <div class="col-sm-9">
                                                                            <div class="fileuploader" id="promptUpload">
                                                                                <div class="fileuploader-input" id="promptUploadInput">
                                                                                    <div class="fileuploader-input-inner">
                                                                                        <div class="fileuploader-icon-main">
                                                                                            <i class="fa fa-cloud-upload"></i>
                                                                                        </div>
                                                                                        <div>
                                                                                            <h3>Drag and drop file here</h3>
                                                                                            <p>or</p>
                                                                                            <input type="file" id="promptUploadFile" name="promptUploadFile" class="btn btn-primary"></button>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div id="promptList">
                                                                                <h6>Uploaded File: <a href="" id="uploadedFile"></a></h6>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-primary pull-left"><i class="fa fa-floppy-o"></i> Save</button>
                                                                    </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Call Flow Experience -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingCallFlowExperience">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseCallFlowExperience" aria-expanded="false" aria-controls="collapseCallFlowExperience" class="collapsed">
                                                    <i class="fa fa-phone" aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>Call Flow</h3>
                                                    <p>Design your Call Flow Experience</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseCallFlowExperience" class="collapse" role="tabpanel" aria-labelledby="headingCallFlowExperience" aria-expanded="false">
                                            <div class="card-block">
                                                <!-- <button id="addCallFlowExperience" class="btn btn-primary mb-2" type="button"><i class="fa fa-plus"></i> Add</button> -->
                                                <!-- <div id="jsGridCallFlowExperience"></div> -->
                                                <div class="ml-4 text-muted">
                                                    <p>Click on a digit to set the corresponding action. <span class="text-primary">*</span> will repeat the current menu. <span class="text-primary">#</span> will go back to the previous menu.</p>
                                                </div>

                                                <div class="container phone-body">
                                                    <div class="row">
                                                        <div class="col-md-4 col-md-offset-4 phone">
                                                            <div class="row1">
                                                                <div class="col-md-12">
                                                                    <div class="num-pad">
                                                                        <div class="span4">
                                                                            <div class="num">
                                                                                <div class="txt digit" data-digit="1">
                                                                                    1
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="span4">
                                                                            <div class="num">
                                                                                <div class="txt digit" data-digit="2">
                                                                                    2 <span class="phone-small">
                                                                                        <p class="phone-p">
                                                                                            ABC</p>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="span4">
                                                                            <div class="num">
                                                                                <div class="txt digit" data-digit="3">
                                                                                    3 <span class="phone-small">
                                                                                        <p class="phone-p">
                                                                                            DEF</p>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="span4">
                                                                            <div class="num">
                                                                                <div class="txt digit" data-digit="4">
                                                                                    4 <span class="phone-small">
                                                                                        <p class="phone-p">
                                                                                            GHI</p>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="span4">
                                                                            <div class="num">
                                                                                <div class="txt digit" data-digit="5">
                                                                                    5 <span class="phone-small">
                                                                                        <p class="phone-p">
                                                                                            JKL</p>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="span4">
                                                                            <div class="num">
                                                                                <div class="txt digit" data-digit="6">
                                                                                    6 <span class="phone-small">
                                                                                        <p class="phone-p">
                                                                                            MNO</p>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="span4">
                                                                            <div class="num">
                                                                                <div class="txt digit" data-digit="7">
                                                                                    7 <span class="phone-small">
                                                                                        <p class="phone-p">
                                                                                            PQRS</p>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="span4">
                                                                            <div class="num">
                                                                                <div class="txt digit" data-digit="8">
                                                                                    8 <span class="phone-small">
                                                                                        <p class="phone-p">
                                                                                            TUV</p>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="span4">
                                                                            <div class="num">
                                                                                <div class="txt digit" data-digit="8">
                                                                                    9 <span class="phone-small">
                                                                                        <p class="phone-p">
                                                                                            WXYZ</p>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="span4">
                                                                            <div class="">
                                                                                <div class="txt text-muted digit" data-digit="*">
                                                                                    *
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="span4">
                                                                            <div class="num">
                                                                                <div class="txt digit" data-digit="#">
                                                                                    0 <span class="phone-small">
                                                                                        <p class="phone-p">
                                                                                            +</p>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="span4">
                                                                            <div class="">
                                                                                <div class="txt text-muted">
                                                                                    #
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="clearfix">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="clearfix">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="modal fade" id="editModalCallFlowExperience" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title"></h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">

                                                                    <div class="form-group row">
                                                                        <label for="default" class="col-sm-3 col-form-label">Default Option?</label>
                                                                        <div class="col-sm-9 col-form-label">
                                                                            <input class="" type="checkbox" value="" id="default">
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="behavior" class="col-sm-3 col-form-label">Behavior</label>
                                                                        <div class="col-sm-9">
                                                                            <select id="behavior" name="behavior" class="form-control" required>
                                                                                <option value="" disabled selected>Select a Behavior</option>
                                                                                <option value="transferToQueue">Transfer to Queue</option>
                                                                                <option value="playMessageAndDisconnect">Play a Message and Disconnect</option>
                                                                                <option value="repeatMenu">Repeat Menu</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row" id="queuesDiv" style="display: none;">
                                                                        <label for="queues" class="col-sm-3 col-form-label">Queue</label>
                                                                        <div class="col-sm-9">
                                                                            <select id="queues" name="queues" class="form-control" required>
                                                                            </select>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row" id="skillsDiv" style="display: none;">
                                                                        <label for="skills" class="col-sm-3 col-form-label">Skill</label>
                                                                        <div class="col-sm-9">
                                                                            <select id="skills" name="skills" class="form-control">
                                                                            </select>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row" id="promptsDiv" style="display: none;">
                                                                        <label for="prompts" class="col-sm-3 col-form-label">Prompt</label>
                                                                        <div class="col-sm-9">
                                                                            <select id="prompts" name="prompts" class="form-control" required>
                                                                            </select>
                                                                        </div>
                                                                    </div>

                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-primary pull-left"><i class="fa fa-floppy-o"></i> Save</button>
                                                                    </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- DIDs -->
                                    <div class="card">
                                        <div class="card-header shadow-lg" role="tab" id="headingDIDs">
                                            <div class="mb-0">
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseDIDs" aria-expanded="false" aria-controls="collapseDIDs" class="collapsed">
                                                    <i class="fa fa-th-list " aria-hidden="true" style="color: #FF4F1F;"></i>
                                                    <h3>DIDs</h3>
                                                    <p>Number Ranges/DIDs</p>
                                                </a>
                                                <i class="fa fa-angle-right" aria-hidden="true" style="color: #FF4F1F;"></i>
                                            </div>
                                        </div>

                                        <div id="collapseDIDs" class="collapse" role="tabpanel" aria-labelledby="headingDIDs" aria-expanded="false">
                                            <div class="card-block">
                                                <div class="form-group row">
                                                    <label for="mainInboundNumber" class="col-sm-3 col-form-label">Main Inbound Number</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="mainInboundNumber" name="mainInboundNumber" placeholder="Enter the Main Inbound Number">
                                                    </div>
                                                </div>
                                                <button id="addDID" class="btn btn-primary mb-2" type="button"><i class="fa fa-plus"></i> Add</button>



                                                <div id="jsGridDIDs"></div>

                                                <div class="modal fade" id="editModalDIDs" tabindex="-1" role="dialog" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header" id="modal-header">
                                                                <h5 id="title" class="modal-title">DID Number Configuration</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <form class="modal-body form-horizontal" id="modal-form">
                                                                <div class="form-group">

                                                                    <div class="form-group row">
                                                                        <label for="didStart" class="col-sm-3 col-form-label">DID Start <span class="text-danger font-weight-bold">*</span></label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="didStart" tabindex="-1" name="didStart" placeholder="Enter the DID start range" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="didEnd" class="col-sm-3 col-form-label">DID End <span class="text-danger font-weight-bold">*</span></label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="didEnd" name="didEnd" placeholder="Enter the DID end range" required>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <label for="didComment" class="col-sm-3 col-form-label">Comments</label>
                                                                        <div class="col-sm-9">
                                                                            <input type="text" class="form-control" id="didComment" name="didComment" placeholder="Enter your comment">
                                                                        </div>
                                                                    </div>


                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-primary pull-left"><i class="fa fa-plus"></i> Add</button>
                                                                    </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <noscript>You need to enable JavaScript to run this app.</noscript>

    <!--#region Imports -->

    <!-- Bootstrap core JavaScript-->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <!-- Core plugin JavaScript-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js" integrity="sha256-4iQZ6BVL4qNKlQ27TExEhBN1HFPvAvAMbFavKKosSWQ=" crossorigin="anonymous"></script>
    <!-- Tempus Dominus -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
    <!-- Genesys Cloud -->
    <script src="https://sdk-cdn.mypurecloud.com/javascript/61.0.0/purecloud-platform-client-v2.min.js"></script>
    <!-- JQuery Validate -->
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/additional-methods.min.js"></script>
    <!-- jQuery Toast -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.js"></script>
    <!-- Bootbox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.4.0/bootbox.min.js"></script>
    <!-- jQuery UI -->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <!-- Bootstrap Select -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>
    <!-- Bootstrap Select -->

    <!-- JSGrid -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js"></script>
    <!-- RRule Generator -->
    <script src="./js/rrule.min.js"></script>
    <!-- Our Scripts -->
    <script src="js/gc.js"></script>
    <script src="js/requests.js"></script>
    <script src="js/tools.js"></script>
    <!-- Dictionary -->
    <script src="js/dictionary.js"></script>

    <!-- JSZip -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.2.2/jszip.min.js"></script>


    <!--#endregion -->

    <script>
        let gcToken, id = getUrlParameter("id"), request, caItem = {}, searches = {}, searchesSchedules = {};

        var zip = new JSZip();

        init();

        async function init() {
            console.log('function init');
            $('#spinner_message')[0].innerHTML = "login to Genesys Cloud...";

            // Set jsGrid defaults
            jsGrid.setDefaults({ tableClass: "jsgrid-table table table-striped table-hover" });

            // Init Date/Time Pickers
            $('.date-only').datetimepicker({
                format: 'L'
            });
            $('.time-only').datetimepicker({
                format: 'LT'
            });

            // Enable tooltips
            $('[data-toggle="tooltip"]').tooltip();

            $.each(countries, (i, country) => {
                $("<option/>", { value: country.name }).text(country.name).appendTo("#country");
            });

            document.getElementById("spinner").style.display = "block";
            try {
                await getMe();
                if (!maintenanceMode) $("#submit").attr('disabled', false);
            } catch (error) {
                console.error(error);
                showMessage(error.hasOwnProperty('message') ? error.message : `Unable to login to Genesys Cloud ${JSON.stringify(error)}`, true);
                return
            } finally {
                document.getElementById("spinner").style.display = "none";
            }

            gcToken = userInfo.token
            localStorage.setItem("gcToken", gcToken);
            localStorage.setItem("userName", userInfo.name);

            if (id) {
                console.log(`found id ${id} in path, check for rapidRequest and draft version...`);
                document.getElementById("spinner").style.display = "block";
                // Try to load #rapidresponse request
                try {
                    $('#spinner_message')[0].innerHTML = "validating Id...";
                    request = await getRequest(id);
                    console.log(request);
                    $('#badgePill')[0].innerHTML = "1";
                    console.log(request);
                    $('#requestDetails')[0].innerHTML = `Related to Partner/Customer Name: <B>${request.partnerCustomerName}</B> requested by <em>${request.requesterName}</em>`;
                } catch (error) {
                    console.error(error);
                    if (error.status !== 404) {
                        document.getElementById("spinner").style.display = "none";
                        showMessage(JSON.stringify(error), true);
                        return;
                    }
                }

                // Try to load latest draft
                try {
                    $('#spinner_message')[0].innerHTML = "check for latest draft...";
                    console.log('check for draft questionnaire...');
                    caItem = await ca_getItem(id);
                    console.log(caItem);
                } catch (error) {
                    console.log(error);
                    if (error.status !== 404) {
                        document.getElementById("spinner").style.display = "none";
                        showMessage(JSON.stringify(error), true);
                        return;
                    }
                }
                document.getElementById("spinner").style.display = "none";

                if (!request && !caItem) {
                    showMessage("Provided requestId doesn't exist", true);
                    return;
                }
                if (request || caItem) {
                    loadDraftConfiguration();
                    enableForm(true);
                }

            } else {
                // New not related RequestForm                
                $('#badgePill')[0].innerHTML = "NEW";

                initLocationsGrid();
                initHolidaysGrid();
                initSchedulesGrid();
                initSkillsGrid();
                initWrapUpCodesGrid();
                initPromptsGrid();
                initQueuesGrid();
                initDIDsGrid();

                await saveDraft(false);
                enableForm(true);

            }
        }

        function enableForm(_bool) {
            $("#saveDraft").prop('disabled', !_bool);
            $("#exportCSV").prop('disabled', !_bool);
            $("#mainForm").attr("hidden", !_bool);
            if (request)
                $("#divRequestDetails").attr("hidden", !_bool);
        }

        function loadDraftConfiguration() {
            console.log('function loadDraftConfiguration');

            initLocationsGrid();
            initHolidaysGrid();
            initSchedulesGrid();
            initSkillsGrid();
            initWrapUpCodesGrid();
            initPromptsGrid();
            initQueuesGrid();
            initDIDsGrid();
            refreshWrapUpCodesDropDownForQueues();

            if (caItem && caItem.hasOwnProperty('organizationSetup')) {
                // Fill in Data
                $('#companyName').val(caItem.organizationSetup.companyName);
                $('#genesysCloudRegion').val(caItem.organizationSetup.genesysCloudRegion);
                $('#numberOfUsers').val(caItem.organizationSetup.numberOfUsers);
                initCallFlowExperience(caItem.callFlowExperience);
                $('#mainInboundNumber').val(caItem.dids.mainInboundNumber == "n/a" ? '' : caItem.dids.mainInboundNumber);
            }
        }

        function buildJSON() {
            console.log('function buildJSON');
            let json = {
                organizationSetup: {},
                schedules: [],
                holidays: [],
                locations: [],
                skills: [],
                wrapUpCodes: [],
                queues: [],
                prompts: [],
                callFlowExperience: {},
                dids: {
                    mainInboundNumber: 'n/a',
                    ranges: []
                }
            };

            if ($('#companyName').val())
                json.organizationSetup.companyName = $('#companyName').val();
            if ($('#genesysCloudRegion').val())
                json.organizationSetup.genesysCloudRegion = $('#genesysCloudRegion').val();
            if ($('#numberOfUsers').val())
                json.organizationSetup.numberOfUsers = $('#numberOfUsers').val();

            if ($("#jsGridLocations").jsGrid("option", "data").length > 0) {
                $.each($("#jsGridLocations").jsGrid("option", "data"), (key, item) => {
                    json.locations.push({
                        locationName: item.locationName,
                        streetAddress: item.streetAddress,
                        city: item.city,
                        state: item.state,
                        zipCode: item.zipCode,
                        country: item.country,
                        notes: item.notes,
                        emergencyNumber: item.emergencyNumber
                    })
                });
            }
            if ($("#jsGridSchedules").jsGrid("option", "data").length > 0) {
                json.schedules = $("#jsGridSchedules").jsGrid("option", "data");
            }
            if ($("#jsGridHolidays").jsGrid("option", "data").length > 0)
                json.holidays = $("#jsGridHolidays").jsGrid("option", "data");
            if ($("#jsGridSkills").jsGrid("option", "data").length > 0)
                json.skills = $("#jsGridSkills").jsGrid("option", "data");
            if ($("#jsGridWrapUpCodes").jsGrid("option", "data").length > 0)
                json.wrapUpCodes = $("#jsGridWrapUpCodes").jsGrid("option", "data");
            if ($("#jsGridPrompts").jsGrid("option", "data").length > 0) {
                json.prompts = $("#jsGridPrompts").jsGrid("option", "data");
            }
            if ($("#jsGridQueues").jsGrid("option", "data").length > 0) {
                $.each($("#jsGridQueues").jsGrid("option", "data"), (key, item) => {
                    json.queues.push({
                        queueName: item.queueName,
                        enableCallbacks: item.enableCallbacks,
                        enableEmails: item.enableEmails,
                        acw: item.acw,
                        acwTimeout: item.acwTimeout,
                        evaluationMethod: item.evaluationMethod,
                        alertingTimeout: item.alertingTimeout,
                        slPercentage: item.slPercentage,
                        slDuration: item.slDuration,
                        callingPartyName: item.callingPartyName,
                        callingPartyNumber: item.callingPartyNumber,
                        wrapUpCodes: item.wrapUpCodes
                    })
                });
            }
            json.callFlowExperience = callFlowExperience;
            /* //There are Empty Strings inside
            if ($('#mainInboundNumber').val().length > 0)
                json.dids.mainInboundNumber = $('#mainInboundNumber').val();
            */
            if ($("#jsGridDIDs").jsGrid("option", "data").length > 0) {
                $.each($("#jsGridDIDs").jsGrid("option", "data"), (key, item) => {
                    json.dids.ranges.push({
                        didStart: item.didStart,
                        didEnd: item.didEnd,
                        provider: "n/a",
                        didComment: item.didComment.length > 0 ? item.didComment : 'n/a'
                    })
                });
            }
            json.dids.mainInboundNumber = $('#mainInboundNumber').val().length > 0 ? $('#mainInboundNumber').val() : 'n/a';

            console.log(json);
            return json;
        }

        async function saveDraft(_manualSave) {
            console.log('saveDraft()');

            // Disable button
            $("#saveDraft").prop('disabled', true);
            $("#saveDraft").html(
                `<span class="spinner-border-sm text-light" role="status" aria-hidden="true"></span> Please wait...`
            )

            try {
                let json = buildJSON();
                if (caItem && caItem.id) {
                    await ca_updateItem(caItem.id, json);
                } else {
                    if (id)
                        json.id = id;
                    caItem = await ca_createItem(json);
                    console.log(`responseId created on CA db: ${caItem.id}`);
                    if (!id) {
                        window.history.pushState('', 'CC Rapid Response Request Form', `${window.location.href}?id=${caItem.id}`);
                    }
                    $("#saveUrl").html(`To get back later on to this questionnaire, use this url: <a href="${window.location.href}">${window.location.href}</a>`);
                    $("#saveUrl").show();
                    if (_manualSave)
                        $('#badgePill')[0].innerHTML = "";

                }
            } catch (error) {
                console.error(error);
                showMessage("Failed to update draft item", JSON.stringify(error));
                return
            } finally {
                // Enable button
                $("#saveDraft").prop('disabled', false);
                $("#saveDraft").html('Save draft');
            }
            if (_manualSave)
                showMessage("Draft updated", false);
        }

        function exportCSV() {
            console.log('function exportCSV()');
            let data = $.extend(true, {}, buildJSON());

            const replacer = (key, value) => (value === null || value === 'n/a') ? '' : value // specify how you want to handle null values here
            let header, csv_locations, csv_schedules, csv_holidays, csv_skills, csv_wrapUpCodes, csv_queues, csv_callFlowExperience, csv_dids, csv_prompts;

            // Locations
            if (data.locations && data.locations.length > 0) {
                console.log('build locations csv...');
                header = Object.keys(data.locations[0]);
                csv_locations = data.locations.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(';'))
                csv_locations.unshift(header.join(';'))
                csv_locations = csv_locations.join('\r\n')
            } else {
                console.log('locations are empty, skip csv build...');
            }

            // Schedules
            if (data.schedules && data.schedules.length > 0) {
                console.log('build schedules csv...');
                header = Object.keys(data.schedules[0]);
                csv_schedules = data.schedules.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(';'))
                csv_schedules.unshift(header.join(';'))
                csv_schedules = csv_schedules.join('\r\n')
            } else {
                console.log('schedules are empty, skip csv build...');
            }

            // Holidays
            if (data.holidays && data.holidays.length > 0) {
                console.log('build holidays csv...');
                header = Object.keys(data.holidays[0]);
                csv_holidays = data.holidays.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(';'))
                csv_holidays.unshift(header.join(';'))
                csv_holidays = csv_holidays.join('\r\n')
            } else {
                console.log('holidays are empty, skip csv build...');
            }

            // Skills
            if (data.skills && data.skills.length > 0) {
                console.log('build skills csv...');
                header = Object.keys(data.skills[0]);
                csv_skills = data.skills.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(';'))
                csv_skills.unshift(header.join(';'))
                csv_skills = csv_skills.join('\r\n')
            } else {
                console.log('skills are empty, skip csv build...');
            }

            // WrapUpCodes
            if (data.wrapUpCodes && data.wrapUpCodes.length > 0) {
                console.log('build wrapup-codes csv...');
                header = Object.keys(data.wrapUpCodes[0]);
                csv_wrapUpCodes = data.wrapUpCodes.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(';'))
                csv_wrapUpCodes.unshift(header.join(';'))
                csv_wrapUpCodes = csv_wrapUpCodes.join('\r\n')
            } else {
                console.log('wrapUp Codes are empty, skip csv build...');
            }

            // Prompts
            if (data.prompts && data.prompts.length > 0) {
                console.log('build prompts csv...');
                header = Object.keys(data.prompts[0]);
                csv_prompts = data.prompts.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(';'))
                csv_prompts.unshift(header.join(';'))
                csv_prompts = csv_prompts.join('\r\n')
            } else {
                console.log('prompts are empty, skip csv build...');
            }

            // Queues
            if (data.queues && data.queues.length > 0) {
                console.log('build queues csv...');
                // tune queue columns
                data.queues.forEach(function (item) {
                    delete item.enableCallbacks;
                    delete item.enableEmails;
                    if (item.wrapUpCodes && item.wrapUpCodes.length > 0)
                        item.wrapUpCodes = item.wrapUpCodes.join('|')
                    else
                        item.wrapUpCodes = "";
                });

                header = Object.keys(data.queues[0]);
                console.log(header);
                csv_queues = data.queues.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(';'))
                csv_queues.unshift(header.join(';'))
                csv_queues = csv_queues.join('\r\n')
            } else {
                console.log('queues are empty, skip csv build...');
            }

            // Call Flow Experience
            if (data.callFlowExperience) {
                console.log('build call flow experience csv...');
                // tune queue columns
                let tmpObj = [];

                for (var prop in data.callFlowExperience) {
                    if (Object.prototype.hasOwnProperty.call(data.callFlowExperience, prop)) {
                        if (prop === "default") continue;
                        tmpObj.push({
                            menuDigit: prop,
                            behavior: data.callFlowExperience[prop].behavior,
                            queueName: data.callFlowExperience[prop].queueName,
                            skill: data.callFlowExperience[prop].skill,
                            prompt: data.callFlowExperience[prop].prompt,
                            default: data.callFlowExperience.default === prop ? true : false
                        })
                    }
                }
                if (tmpObj.length > 0) {
                    header = Object.keys(tmpObj[0]);
                    csv_callFlowExperience = tmpObj.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(';'))
                    csv_callFlowExperience.unshift(header.join(';'))
                    csv_callFlowExperience = csv_callFlowExperience.join('\r\n')
                } else
                    console.log('callFlow settings are empty, skip csv build...');

            } else {
                console.log('callFlow settings are empty, skip csv build...');
            }

            // DIDs
            if (data.dids && data.dids.ranges.length > 0) {
                console.log('build dids csv...');
                // tune queue columns
                header = Object.keys(data.dids.ranges[0]);
                csv_dids = data.dids.ranges.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(';'))
                csv_dids.unshift(header.join(';'))
                csv_dids = csv_dids.join('\r\n')
            } else {
                console.log('dids are empty, skip csv build...');
            }


            console.log(`CSV: locations\n===================\n ${csv_locations}\n===================\n`);
            console.log(`CSV: schedules\n===================\n ${csv_schedules}\n===================\n`);
            console.log(`CSV: holidays\n===================\n ${csv_holidays}\n===================\n`);
            console.log(`CSV: skills\n===================\n ${csv_skills}\n===================\n`);
            console.log(`CSV: wrapUpCodes\n===================\n ${csv_wrapUpCodes}\n===================\n`);
            console.log(`CSV: queues\n===================\n ${csv_queues}\n===================\n`);
            console.log(`CSV: prompts\n===================\n ${csv_prompts}\n===================\n`);
            console.log(`CSV: callFlowExperience\n===================\n ${csv_callFlowExperience}\n===================\n`);
            console.log(`CSV: dids\n===================\n ${csv_dids}\n===================\n`);

            //download(csv_locations, 'locations.csv');

            zip.file("au-locations-import.csv", csv_locations);
            zip.file("au-schedules-import.csv", csv_schedules);
            zip.file("holidays.csv", csv_holidays);
            zip.file("au-skills-import.csv", csv_skills);
            zip.file("au-wrapup-codes-import.csv", csv_wrapUpCodes);
            zip.file("au-queues-full-import.csv", csv_queues);
            zip.file("prompts.csv", csv_prompts);
            zip.file("call-flow.csv", csv_callFlowExperience);
            zip.file("au-dids-import.csv", csv_dids);

            zip.generateAsync({ type: "blob" })
                .then(function (content) {
                    download(content, "automation_export.zip");
                });

        }

        function download(data, filename, type) {
            var file = new Blob([data], { type: type });
            if (window.navigator.msSaveOrOpenBlob) // IE10+
                window.navigator.msSaveOrOpenBlob(file, filename);
            else { // Others
                var a = document.createElement("a"),
                    url = URL.createObjectURL(file);
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                setTimeout(function () {
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                }, 0);
            }
        }

        //#region Locations

        var dbLocations = {
            loadData: function (filter) {
                return $.grep(this.locations, function (location) {
                    return (!filter.locationName || location.locationName.toLowerCase().indexOf(filter.locationName.toLowerCase()) > -1)

                });
            },
            insertItem: function (insertingLocation) {
                this.locations.push(insertingLocation);
            },
            updateItem: function (updatingLocation) { },
            deleteItem: function (deletingLocation) { }
        };

        window.dbLocations = dbLocations;

        var formSubmitHandlerLocations = $.noop;

        let validatorLocations = $("#editModalLocations #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerLocations();
            }
        });

        $("#addLocation").on('click', (e) => {
            e.preventDefault();
            showLocationsModal("Add", {});
        });

        function initLocationsGrid() {
            //console.log('caItem locations:', caItem.locations);
            dbLocations.locations = caItem.hasOwnProperty('locations') ? caItem.locations : [];

            $("#jsGridLocations").jsGrid({
                height: "auto",
                width: "100%",
                editing: true,
                autoload: true,
                sorting: false,
                filtering: false,
                paging: false,
                noDataContent: "No Locations",
                confirmDeleting: false,
                onError: function (args) {
                    console.error('Failed to load grid data:', args);
                    showMessage("An error occurred while loading your data", true);
                },
                rowClick: function (args) {
                    showLocationsModal("Edit", args.item);
                },
                onDataLoaded: function (args) {
                    $("#addLocation").attr('disabled', $("#jsGridLocations").jsGrid("option", "data").length >= 2);
                },
                onItemInserted: function (args) {
                    $("#addLocation").attr('disabled', $("#jsGridLocations").jsGrid("option", "data").length >= 2);
                },
                onItemUpdated: function (args) {
                    $("#addLocation").attr('disabled', $("#jsGridLocations").jsGrid("option", "data").length >= 2);
                },
                onItemDeleting: function (args) {
                    console.log("onItemDeleting");
                    if (!args.item.deleteConfirmed) { // custom property for confirmation
                        args.cancel = true; // cancel deleting
                        bootbox.confirm({
                            message: 'Do you really want to delete this location?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    args.item.deleteConfirmed = true;
                                    $("#jsGridLocations").jsGrid('deleteItem', args.item); // Remove item from grid
                                    removeFromArray(dbLocations.locations, args.item); // Remove item from db
                                    showMessage("Location deleted", false);
                                }
                            }
                        });
                    }
                },
                onItemDeleted: function (args) {
                    $("#addLocation").attr('disabled', $("#jsGridLocations").jsGrid("option", "data").length >= 2);
                },
                controller: dbLocations,
                fields: [
                    {
                        name: "locationName",
                        title: "Name",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searches.locationName = input.val();
                                $("#jsGridLocations").data('JSGrid').search(searches);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "city",
                        title: "City",
                        type: "text",
                        align: "center"
                    },
                    {
                        name: "state",
                        title: "State",
                        type: "text",
                        align: "center",
                        itemTemplate: function (value, item) {
                            return value === 'n/a' ? '' : value
                        }
                    },
                    {
                        name: "country",
                        title: "Country",
                        type: "text",
                        align: "center"
                    },
                    {
                        type: "control",
                        modeSwitchButton: false,
                        editButton: false,
                        width: 68,
                        align: "center",
                        headerTemplate: function () {
                            return "Actions";
                        }
                    }
                ]
            });
        }

        var showLocationsModal = function (dialogType, item) {
            console.log('Showing details for:', item);
            $("#editModalLocations #locationName").val(item.locationName);
            $("#editModalLocations #streetAddress").val(item.streetAddress);
            $("#editModalLocations #city").val(item.city);
            $("#editModalLocations #state").val((item.state && item.state !== 'n/a') ? item.state : '');
            $("#editModalLocations #zipCode").val(item.zipCode);
            $("#editModalLocations #country").val(item.country);
            $("#editModalLocations #country").selectpicker('refresh');
            $("#editModalLocations #notes").val((item.notes && item.notes !== 'n/a') ? item.notes : '');
            $("#editModalLocations #emergencyNumber").val(item.emergencyNumber);
            $("#editModalLocations #submit").html("<i class='fa fa-floppy-o'></i> Save");
            formSubmitHandlerLocations = function () {
                saveLocation(item, dialogType === "Add");
            };
            $("#editModalLocations").modal('show');
        };

        var saveLocation = function (item, isNew) {
            console.log('Extending item:', item);
            $.extend(item, {
                locationName: $("#editModalLocations #locationName").val(),
                streetAddress: $("#editModalLocations #streetAddress").val(),
                city: $("#editModalLocations #city").val(),
                state: $("#editModalLocations #state").val() == "" ? 'n/a' : $("#editModalLocations #state").val(),
                zipCode: $("#editModalLocations #zipCode").val(),
                country: $("#editModalLocations #country").val(),
                notes: $("#editModalLocations #notes").val() == "" ? 'n/a' : $("#editModalLocations #notes").val(),
                emergencyNumber: $("#editModalLocations #emergencyNumber").val(),
            });
            console.log('Extended Item:', item);
            console.log('IsNew?', isNew)
            $("#jsGridLocations").jsGrid(isNew ? "insertItem" : "updateItem", item);
            $("#editModalLocations").modal('hide');
        };

        $('#editModalLocations').on('hidden.bs.modal', async () => {
            initLocationsModal();
        });

        function initLocationsModal() {
            $("#editModalLocations #locationName").val("");
            $("#editModalLocations #streetAddress").val("");
            $("#editModalLocations #city").val("");
            $("#editModalLocations #state").val("");
            $("#editModalLocations #zipCode").val("");
            $("#editModalLocations #country").val("");
            $("#editModalLocations #country").selectpicker('refresh');
            $("#editModalLocations #notes").val("");
            $("#editModalLocations #emergencyNumber").val("");
            $("#editModalLocations #submit").html("<i class='fa fa-plus'></i> Add");

            validatorLocations.resetForm(); // Reset validation errors
        }

        //#endregion

        //#region Schedules

        let maxSchedules = 2;

        var dbSchedules = {
            loadData: function (filter) {
                return $.grep(this.schedules, function (schedule) {
                    return (!filter.scheduleName || schedule.scheduleName.toLowerCase().indexOf(filter.scheduleName.toLowerCase()) > -1)
                        && (!filter.start || schedule.start.toLowerCase().indexOf(filter.start.toLowerCase()) > -1)
                        && (!filter.end || schedule.end.toLowerCase().indexOf(filter.end.toLowerCase()) > -1)
                        && (!filter.rrule || schedule.rrule.toLowerCase().indexOf(filter.rrule.toLowerCase()) > -1);
                });
            },
            insertItem: function (insertingItem) {
                this.schedules.push(insertingItem);
            },
            updateItem: function (updatingItem) { },
            deleteItem: function (deletingItem) { }
        };

        window.dbSchedules = dbSchedules;

        var formSubmitHandlerSchedules = $.noop;

        let validatorSchedules = $("#editModalSchedules #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerSchedules();
            }
        });

        $("#repeatingEvent").on('change', () => {
            if ($("#repeatingEvent").is(':checked')) {
                $("#repeatingEventDiv").show();
                $("#singleEventDiv").hide();
            } else {
                $("#repeatingEventDiv").hide();
                $("#singleEventDiv").show();
            }
        });

        $("#allDay").on('change', () => {
            if ($("#allDay").is(':checked')) {
                $(".time-row").hide();
            } else {
                $(".time-row").show();
            }
        });

        $("#recurrenceType").on('change', () => {
            let recurrenceType = $("#recurrenceType").val();
            switch (recurrenceType) {
                case "Daily":
                    $("#weeklyControlsDiv").hide();
                    $("#monthlyControlsDiv").hide();
                    $("#yearlyControlsDiv").hide();
                    $("#yearMonth").hide();
                    break;
                case "Weekly":
                    $("#weeklyControlsDiv").show();
                    $("#monthlyControlsDiv").hide();
                    $("#yearlyControlsDiv").hide();
                    $("#yearMonth").hide();
                    break;
                case "Monthly":
                    $("#weeklyControlsDiv").hide();
                    $("#monthlyControlsDiv").show();
                    $("#yearlyControlsDiv").hide();
                    $("#yearMonth").hide();
                    break;
                case "Yearly":
                    $("#weeklyControlsDiv").hide();
                    $("#monthlyControlsDiv").hide();
                    $("#yearlyControlsDiv").show();
                    $("#yearMonth").show();
                    break;

                default:
                    break;
            }
        });

        $("#monthlyRecurrenceType").on('change', () => {
            let monthlyRecurrenceType = $("#monthlyRecurrenceType").val();
            switch (monthlyRecurrenceType) {
                case "On":
                    $("#byMonthDayDiv").show();
                    $("#byDayDiv").hide();
                    break;
                default:
                    $("#byMonthDayDiv").hide();
                    $("#byDayDiv").show();
                    break;
            }
        });

        $("#yearlyRecurrenceType").on('change', () => {
            let yearlyRecurrenceType = $("#yearlyControlsDiv #yearlyRecurrenceType").val();
            switch (yearlyRecurrenceType) {
                case "On":
                    $("#yearlyControlsDiv #byYearDayDiv").show();
                    $("#yearlyControlsDiv #byDayDiv").hide();
                    break;
                default:
                    $("#yearlyControlsDiv #byYearDayDiv").hide();
                    $("#yearlyControlsDiv #byDayDiv").show();
                    break;
            }
        });

        $("#singleEventAllDay").on('change', () => {
            if ($("#singleEventAllDay").is(':checked')) {
                $(".time-row").hide();
            } else {
                $(".time-row").show();
            }
        });

        $("#addSchedule").on('click', (e) => {
            e.preventDefault();
            showSchedulesModal("Add", {});
        });

        function initSchedulesGrid() {
            dbSchedules.schedules = caItem.hasOwnProperty('schedules') ? caItem.schedules : [];

            $("#jsGridSchedules").jsGrid({
                height: "auto",
                width: "100%",
                editing: true,
                autoload: true,
                sorting: true,
                filtering: false,
                paging: false,
                noDataContent: "No Schedules",
                confirmDeleting: false,
                onError: function (args) {
                    console.error('Failed to load grid data:', args);
                    showMessage("An error occurred while loading your data", true);
                },
                rowClick: function (args) {
                    showSchedulesModal("Edit", args.item);
                },
                onDataLoaded: function (args) {
                    $("#addSchedule").attr('disabled', $("#jsGridSchedules").jsGrid("option", "data").length >= maxSchedules);
                },
                onItemInserted: function (args) {
                    $("#addSchedule").attr('disabled', $("#jsGridSchedules").jsGrid("option", "data").length >= maxSchedules);
                },
                onItemUpdated: function (args) {
                    $("#addSchedule").attr('disabled', $("#jsGridSchedules").jsGrid("option", "data").length >= maxSchedules);
                },
                onItemDeleting: function (args) {
                    console.log("onItemDeleting");
                    if (!args.item.deleteConfirmed) { // custom property for confirmation
                        args.cancel = true; // cancel deleting
                        bootbox.confirm({
                            message: 'Do you really want to delete this schedule?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    args.item.deleteConfirmed = true;
                                    $("#jsGridSchedules").jsGrid('deleteItem', args.item); // Remove item from grid
                                    removeFromArray(dbSchedules.schedules, args.item); // Remove item from db
                                    showMessage("Schedule deleted", false);
                                }
                            }
                        });
                    }
                },
                onItemDeleted: function (args) {
                    $("#addSchedule").attr('disabled', $("#jsGridSchedules").jsGrid("option", "data").length >= maxSchedules);
                },
                controller: dbSchedules,
                fields: [
                    {
                        name: "scheduleName",
                        title: "Name",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searchesSchedules.scheduleName = input.val();
                                $("#jsGridSchedules").data('JSGrid').search(searchesSchedules);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "start",
                        title: "Start Date/Time",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searchesSchedules.start = input.val();
                                $("#jsGridSchedules").data('JSGrid').search(searchesSchedules);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "end",
                        title: "Until",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searchesSchedules.end = input.val();
                                $("#jsGridSchedules").data('JSGrid').search(searchesSchedules);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        name: "rrule",
                        title: "Recurrence Rule",
                        type: "text",
                        align: "center",
                        filterTemplate: function () {
                            let input = $("<input/>", { type: "text" });
                            input.on('keyup', () => {
                                searchesSchedules.rrule = input.val();
                                $("#jsGridSchedules").data('JSGrid').search(searchesSchedules);
                            });
                            return this.filterControl = input;
                        }
                    },
                    {
                        type: "control",
                        modeSwitchButton: false,
                        editButton: false,
                        width: 68,
                        align: "center",
                        headerTemplate: function () {
                            return "Actions";
                        }
                    }
                ]
            });
        }

        var showSchedulesModal = function (dialogType, item) {
            console.log('Showing details for:', item);

            if (Object.keys(item).length > 0) {
                $("#editModalSchedules #scheduleName").val(item.scheduleName);

                // Start/End Date/Time
                let startDate = moment(item.start);
                let endDate = moment(item.end);

                $("#editModalSchedules #startDate").datetimepicker('date', startDate);
                $("#editModalSchedules #endDate").datetimepicker('date', endDate);

                // All day or is start/end time set?
                if (startDate.hour() === 0 && startDate.minute() === 0 && startDate.second() === 0
                    && endDate.hour() === 23 && endDate.minute() === 59 && endDate.second() === 59) {
                    $("#editModalSchedules #allDay").prop('checked', true);
                    $("#editModalSchedules #allDay").change();
                } else {
                    $("#editModalSchedules #startTime").datetimepicker('date', startDate);
                    $("#editModalSchedules #endTime").datetimepicker('date', endDate);
                }

                // Recurrence
                let currentRRule = new rrule.rrulestr(item.rrule.replace("\n", " ").replace("", " "));
                console.log('Current RRule:', currentRRule);
                console.log('Current RRule options:', currentRRule.options);

                switch (currentRRule.origOptions.freq) {
                    case rrule.RRule.DAILY:
                        $("#editModalSchedules #repeatingEvent").prop('checked', true);
                        $("#editModalSchedules #repeatingEvent").change();
                        $("#editModalSchedules #recurrenceType").val('Daily');
                        $("#editModalSchedules #recurrenceType").change();
                        $("#editModalSchedules #interval").val(currentRRule.options.interval || 1);
                        break;
                    case rrule.RRule.WEEKLY:
                        $("#editModalSchedules #repeatingEvent").prop('checked', true);
                        $("#editModalSchedules #repeatingEvent").change();
                        $("#editModalSchedules #recurrenceType").val('Weekly');
                        $("#editModalSchedules #recurrenceType").change();
                        $("#editModalSchedules #interval").val(currentRRule.options.interval || 1);
                        if (currentRRule.origOptions.hasOwnProperty('byweekday') && currentRRule.origOptions.byweekday.length > 0) {
                            let byWeekDayArray = currentRRule.origOptions.byweekday;
                            $.each(byWeekDayArray, (i, byWeekDay) => {
                                switch (byWeekDay) {
                                    case rrule.RRule.MO:
                                        $("#editModalSchedules #weeklyControlsDiv #chkMonday").prop('checked', true);
                                        break;
                                    case rrule.RRule.TU:
                                        $("#editModalSchedules #weeklyControlsDiv #chkTuesday").prop('checked', true);
                                        break;
                                    case rrule.RRule.WE:
                                        $("#editModalSchedules #weeklyControlsDiv #chkWednesday").prop('checked', true);
                                        break;
                                    case rrule.RRule.TH:
                                        $("#editModalSchedules #weeklyControlsDiv #chkThursday").prop('checked', true);
                                        break;
                                    case rrule.RRule.FR:
                                        $("#editModalSchedules #weeklyControlsDiv #chkFriday").prop('checked', true);
                                        break;
                                    case rrule.RRule.SA:
                                        $("#editModalSchedules #weeklyControlsDiv #chkSaturday").prop('checked', true);
                                        break;
                                    case rrule.RRule.SU:
                                        $("#editModalSchedules #weeklyControlsDiv #chkSunday").prop('checked', true);
                                        break;
                                    default:
                                        console.error('Unknown week day:', byWeekDay);
                                        break;
                                }
                            });
                        }
                        break;
                    case rrule.RRule.MONTHLY:
                        $("#editModalSchedules #repeatingEvent").prop('checked', true);
                        $("#editModalSchedules #repeatingEvent").change();
                        $("#editModalSchedules #recurrenceType").val('Monthly');
                        $("#editModalSchedules #recurrenceType").change();
                        $("#editModalSchedules #interval").val(currentRRule.options.interval || 1);

                        if (currentRRule.origOptions.hasOwnProperty('bymonthday') && currentRRule.origOptions.bymonthday.length > 0) {
                            $("#editModalSchedules #monthlyRecurrenceType").val("On");
                            $("#editModalSchedules #monthlyRecurrenceType").change();
                            $("#editModalSchedules #byMonthDay").val(currentRRule.origOptions.bymonthday.join(','));
                        } else if (currentRRule.origOptions.hasOwnProperty('byweekday') && currentRRule.origOptions.byweekday.length > 0) {
                            console.log('currentRRule:', currentRRule);
                            if (currentRRule.origOptions.hasOwnProperty('bysetpos')) {
                                console.log('By Set Pos:', currentRRule.origOptions.bysetpos);
                                switch (currentRRule.origOptions.bysetpos) {
                                    case 1:
                                        $("#editModalSchedules #monthlyControlsDiv #monthlyRecurrenceType").val("First");
                                        $("#editModalSchedules #monthlyControlsDiv #monthlyRecurrenceType").change();
                                        break;
                                    case 2:
                                        $("#editModalSchedules #monthlyControlsDiv #monthlyRecurrenceType").val("Second");
                                        $("#editModalSchedules #monthlyControlsDiv #monthlyRecurrenceType").change();
                                        break;
                                    case 3:
                                        $("#editModalSchedules #monthlyControlsDiv #monthlyRecurrenceType").val("Third");
                                        $("#editModalSchedules #monthlyControlsDiv #monthlyRecurrenceType").change();
                                        break;
                                    case 4:
                                        $("#editModalSchedules #monthlyControlsDiv# monthlyRecurrenceType").val("Fourth");
                                        $("#editModalSchedules #monthlyControlsDiv# monthlyRecurrenceType").change();
                                        break;
                                    case -1:
                                        $("#editModalSchedules #monthlyControlsDiv #monthlyRecurrenceType").val("Last");
                                        $("#editModalSchedules #monthlyControlsDiv #monthlyRecurrenceType").change();
                                        break;
                                    default:
                                        consol.error('Unknown bySetPos:', currentRRule.origOptions.bysetpos)
                                        break;
                                }
                            } else {
                                $("#editModalSchedules #monthlyRecurrenceType").val("IfDayIs");
                                $("#editModalSchedules #monthlyRecurrenceType").change();
                            }
                            let byWeekDayArray = currentRRule.origOptions.byweekday;
                            $.each(byWeekDayArray, (i, byWeekDay) => {
                                switch (byWeekDay) {
                                    case rrule.RRule.MO:
                                        $("#editModalSchedules #monthlyControlsDiv #chkMonday").prop('checked', true);
                                        break;
                                    case rrule.RRule.TU:
                                        $("#editModalSchedules #monthlyControlsDiv #chkTuesday").prop('checked', true);
                                        break;
                                    case rrule.RRule.WE:
                                        $("#editModalSchedules #monthlyControlsDiv #chkWednesday").prop('checked', true);
                                        break;
                                    case rrule.RRule.TH:
                                        $("#editModalSchedules #monthlyControlsDiv #chkThursday").prop('checked', true);
                                        break;
                                    case rrule.RRule.FR:
                                        $("#editModalSchedules #monthlyControlsDiv #chkFriday").prop('checked', true);
                                        break;
                                    case rrule.RRule.SA:
                                        $("#editModalSchedules #monthlyControlsDiv #chkSaturday").prop('checked', true);
                                        break;
                                    case rrule.RRule.SU:
                                        $("#editModalSchedules #monthlyControlsDiv #chkSunday").prop('checked', true);
                                        break;
                                    default:
                                        console.error('Unknown week day:', byWeekDay);
                                        break;
                                }
                            });
                            if (!byWeekDayArray.includes(rrule.RRule.MO)) {
                                // Monday is checked by default so if it's not set, uncheck Mo
                                $("#editModalSchedules #monthlyControlsDiv #chkMonday").prop('checked', false);
                            }
                        }

                        break;
                    case rrule.RRule.YEARLY:
                        $("#editModalSchedules #repeatingEvent").prop('checked', true);
                        $("#editModalSchedules #repeatingEvent").change();
                        $("#editModalSchedules #recurrenceType").val('Yearly');
                        $("#editModalSchedules #recurrenceType").change();
                        $("#editModalSchedules #interval").val(currentRRule.origOptions.interval || 1);
                        break;
                    default:
                        console.log('No Recurrence');
                        break;
                }

                $("#editModalSchedules #submit").html("<i class='fa fa-floppy-o'></i> Save");
            }

            formSubmitHandlerSchedules = function () {
                saveSchedule(item, dialogType === "Add");
            };
            $("#editModalSchedules").modal('show');
        };

        var saveSchedule = function (item, isNew) {
            try {

                let newRRule = generateRRule();
                let newRRuleString = newRRule.toString();

                console.log('New RRule:', newRRule);
                console.log('New RRule String:', newRRuleString);

                console.log('Extending item:', item);

                $.extend(item, {
                    scheduleName: $("#editModalSchedules #scheduleName").val(),
                    start: newRRule.options.dtstart,
                    end: newRRule.options.until,
                    rrule: newRRuleString
                });
                console.log('Extended Item:', item);
                console.log('IsNew?', isNew)
                $("#jsGridSchedules").jsGrid(isNew ? "insertItem" : "updateItem", item);
                $("#editModalSchedules").modal('hide');
            } catch (error) {
                console.error(error);
                showMessage(error, true);
            }
        };

        $('#editModalSchedules').on('hidden.bs.modal', async () => {
            initSchedulesModal();
        });

        function initSchedulesModal() {
            $("#editModalSchedules #scheduleName").val("");

            // Repeating Event
            $("#editModalSchedules #repeatingEvent").prop('checked', false);
            $("#editModalSchedules #repeatingEvent").change();
            $("#editModalSchedules #interval").val(1);
            $("#editModalSchedules #recurrenceType").val('Daily');
            $("#editModalSchedules #recurrenceType").change();
            $("#editModalSchedules #yearMonth").val('');

            // Weekly
            $("#editModalSchedules #weeklyControlsDiv #chkMonday").prop('checked', true);
            $("#editModalSchedules #weeklyControlsDiv #chkTuesday").prop('checked', false);
            $("#editModalSchedules #weeklyControlsDiv #chkWednesday").prop('checked', false);
            $("#editModalSchedules #weeklyControlsDiv #chkThursday").prop('checked', false);
            $("#editModalSchedules #weeklyControlsDiv #chkFriday").prop('checked', false);
            $("#editModalSchedules #weeklyControlsDiv #chkSaturday").prop('checked', false);
            $("#editModalSchedules #weeklyControlsDiv #chkSunday").prop('checked', false);

            // Monthly
            $("#editModalSchedules #monthlyControlsDiv #monthlyRecurrenceType").val('On');
            $("#editModalSchedules #monthlyControlsDiv #monthlyRecurrenceType").change();
            $("#editModalSchedules #monthlyControlsDiv #byMonthDay").val('');
            $("#editModalSchedules #monthlyControlsDiv #byDayDiv #chkMonday").prop('checked', true);
            $("#editModalSchedules #monthlyControlsDiv #byDayDiv #chkTuesday").prop('checked', false);
            $("#editModalSchedules #monthlyControlsDiv #byDayDiv #chkWednesday").prop('checked', false);
            $("#editModalSchedules #monthlyControlsDiv #byDayDiv #chkThursday").prop('checked', false);
            $("#editModalSchedules #monthlyControlsDiv #byDayDiv #chkFriday").prop('checked', false);
            $("#editModalSchedules #monthlyControlsDiv #byDayDiv #chkSaturday").prop('checked', false);
            $("#editModalSchedules #monthlyControlsDiv #byDayDiv #chkSunday").prop('checked', false);

            // Yearly
            $("#editModalSchedules #yearlyControlsDiv #yearlyRecurrenceType").val('On');
            $("#editModalSchedules #yearlyControlsDiv #yearlyRecurrenceType").change();
            $("#editModalSchedules #yearlyControlsDiv #byMonthDay").val('');
            $("#editModalSchedules #yearlyControlsDiv #byYearDayDiv #chkMonday").prop('checked', true);
            $("#editModalSchedules #yearlyControlsDiv #byYearDayDiv #chkTuesday").prop('checked', false);
            $("#editModalSchedules #yearlyControlsDiv #byYearDayDiv #chkWednesday").prop('checked', false);
            $("#editModalSchedules #yearlyControlsDiv #byYearDayDiv #chkThursday").prop('checked', false);
            $("#editModalSchedules #yearlyControlsDiv #byYearDayDiv #chkFriday").prop('checked', false);
            $("#editModalSchedules #yearlyControlsDiv #byYearDayDiv #chkSaturday").prop('checked', false);
            $("#editModalSchedules #yearlyControlsDiv #byYearDayDiv #chkSunday").prop('checked', false);

            // All Day
            $("#editModalSchedules #allDay").prop('checked', false);
            $("#editModalSchedules #allDay").change();
            $("#editModalSchedules #startDate").datetimepicker('clear');
            $("#editModalSchedules #startTime").datetimepicker('clear');
            $("#editModalSchedules #endTime").datetimepicker('clear');
            $("#editModalSchedules #endDate").datetimepicker('clear');

            $("#editModalSchedules #submit").html("<i class='fa fa-plus'></i> Add");

            validatorSchedules.resetForm(); // Reset validation errors
        }

        //#region RRule

        function getAllEventsFromRRuleString(rruleString) {
            return new rrule.rrulestr(rruleString).all();
        }

        function generateRRule() {

            let recurrenceType = $("#editModalSchedules #recurrenceType").val();

            //#region Frequency

            let freq;
            if ($("#repeatingEvent").is(':checked')) {
                switch (recurrenceType) {
                    case "Daily":
                        freq = rrule.RRule.DAILY;
                        break;
                    case "Weekly":
                        freq = rrule.RRule.WEEKLY;
                        break;
                    case "Monthly":
                        freq = rrule.RRule.MONTHLY;
                        break;
                    case "Yearly":
                        freq = rrule.RRule.YEARLY;
                        break;
                    default:
                        console.error('Unsupported recurrence:', recurrenceType);
                        showMessage("Unsupported Recurrence: " + recurrenceType, true);
                        break;
                }
            }

            //#endregion

            //#region Interval

            let interval;
            if ($("#repeatingEvent").is(':checked')) {
                interval = $("#editModalSchedules #interval").val();
            }

            //#endregion

            //#region Date/Time Start/End

            let dtStart, until;

            // Is Start Date set?
            if ($('input[data-target="#startDate"]').val().length > 0) {
                dtStart = $("#startDate").datetimepicker('date');
            } else {
                dtStart = new Date(); // Today
            }

            // Is End Date set?
            if ($('input[data-target="#endDate"]').val().length > 0) {
                until = $("#endDate").datetimepicker('date') || null;
            }

            if ($("#allDay").is(':checked')) {
                // Set start time to 00:00:00
                console.log('Set start time to 12:00:00.000 AM');
                dtStart = dtStart.startOf('day');

                if (until) {
                    // Set until time to 23:59:59
                    console.log('Set end time to 23:59:59.999');
                    until = until.endOf('day');
                }
            } else {
                if ($('input[data-target="#startTime"]').val().length > 0) {
                    // Set start time with startTime field value
                    console.log("Set start time with startTime field value");
                    let startTime = $("#startTime").datetimepicker('date').toDate();
                    dtStart.hours(startTime.getHours());
                    dtStart.minutes(startTime.getMinutes());
                    dtStart.seconds(0);
                    dtStart.milliseconds(0);
                }

                if ($('input[data-target="#endTime"]').val().length > 0 && until) {
                    // Set end time with endTime field value
                    console.log("Set end time with endTime field value");
                    let endTime = $("#endTime").datetimepicker('date').toDate();
                    until.hours(endTime.getHours());
                    until.minutes(endTime.getMinutes());
                    until.seconds(0);
                    until.milliseconds(0);
                }
            }

            //#endregion

            //#region Weekly

            let byWeekDay = [];
            if (recurrenceType === "Weekly") {
                console.log('Weekly recurrence');
                if ($("#editModalSchedules #weeklyControlsDiv #chkMonday").is(':checked')) { byWeekDay.push(rrule.RRule.MO); }
                if ($("#editModalSchedules #weeklyControlsDiv #chkTuesday").is(':checked')) { byWeekDay.push(rrule.RRule.TU); }
                if ($("#editModalSchedules #weeklyControlsDiv #chkWednesday").is(':checked')) { byWeekDay.push(rrule.RRule.WE); }
                if ($("#editModalSchedules #weeklyControlsDiv #chkThursday").is(':checked')) { byWeekDay.push(rrule.RRule.TH); }
                if ($("#editModalSchedules #weeklyControlsDiv #chkFriday").is(':checked')) { byWeekDay.push(rrule.RRule.FR); }
                if ($("#editModalSchedules #weeklyControlsDiv #chkSaturday").is(':checked')) { byWeekDay.push(rrule.RRule.SA); }
                if ($("#editModalSchedules #weeklyControlsDiv #chkSunday").is(':checked')) { byWeekDay.push(rrule.RRule.SU); }
            }
            console.log('By Week Day:', byWeekDay);

            //#endregion

            //#region Monthly

            let byMonthDay = [], bySetPos;
            if (recurrenceType === "Monthly") {
                console.log('Monthly recurrence');
                let monthlyRecurrenceType = $("#editModalSchedules #monthlyControlsDiv #monthlyRecurrenceType").val();
                if (monthlyRecurrenceType === "On") {
                    byMonthDay.push($("#byMonthDay").val());
                } else {
                    console.log('Monthly Recurrence Type:', monthlyRecurrenceType);
                    switch (monthlyRecurrenceType) {
                        case "IfDayIs":
                            // Nothing to do here
                            break;
                        case "First":
                            bySetPos = [1]
                            break;
                        case "Second":
                            bySetPos = [2];
                            break;
                        case "Third":
                            bySetPos = [3];
                            break;
                        case "Fourth":
                            bySetPos = [4];
                            break;
                        case "Last":
                            bySetPos = [-1];
                            break;
                        default:
                            console.error("Unsupported monthly recurrence type:", monthlyRecurrenceType);
                            showMessage("Unsupported monthly recurrence type: " + monthlyRecurrenceType, true);
                            break;
                    }
                    if ($("#editModalSchedules #monthlyControlsDiv #chkMonday").is(':checked')) { byWeekDay.push(rrule.RRule.MO); }
                    if ($("#editModalSchedules #monthlyControlsDiv #chkTuesday").is(':checked')) { byWeekDay.push(rrule.RRule.TU); }
                    if ($("#editModalSchedules #monthlyControlsDiv #chkWednesday").is(':checked')) { byWeekDay.push(rrule.RRule.WE); }
                    if ($("#editModalSchedules #monthlyControlsDiv #chkThursday").is(':checked')) { byWeekDay.push(rrule.RRule.TH); }
                    if ($("#editModalSchedules #monthlyControlsDiv #chkFriday").is(':checked')) { byWeekDay.push(rrule.RRule.FR); }
                    if ($("#editModalSchedules #monthlyControlsDiv #chkSaturday").is(':checked')) { byWeekDay.push(rrule.RRule.SA); }
                    if ($("#editModalSchedules #monthlyControlsDiv #chkSunday").is(':checked')) { byWeekDay.push(rrule.RRule.SU); }
                }
            }

            //#endregion

            //#region Yearly

            let byMonth = [];
            if (recurrenceType === "Yearly") {
                console.log('Yearly recurrence');

                // Got a month?
                let yearMonthSelect = $("#editModalSchedules #yearMonthSelect").val();
                if (yearMonthSelect.length > 0) {
                    byMonth.push(parseInt(yearMonthSelect));
                }

                // Recurrence
                let yearlyRecurrenceType = $("#editModalSchedules #yearlyControlsDiv #yearlyRecurrenceType").val();
                if (yearlyRecurrenceType === "On") {
                    byMonthDay.push($("#byYearDay").val());
                } else {
                    console.log('Yearly Recurrence Type:', yearlyRecurrenceType);
                    switch (yearlyRecurrenceType) {
                        case "IfDayIs":
                            // Nothing to do here
                            break;
                        case "First":
                            bySetPos = [1]
                            break;
                        case "Second":
                            bySetPos = [2];
                            break;
                        case "Third":
                            bySetPos = [3];
                            break;
                        case "Fourth":
                            bySetPos = [4];
                            break;
                        case "Last":
                            bySetPos = [-1];
                            break;
                        default:
                            console.error("Unsupported monthly recurrence type:", monthlyRecurrenceType);
                            showMessage("Unsupported monthly recurrence type: " + monthlyRecurrenceType, true);
                            break;
                    }
                    if ($("#editModalSchedules #yearlyControlsDiv #chkMonday").is(':checked')) { byWeekDay.push(rrule.RRule.MO); }
                    if ($("#editModalSchedules #yearlyControlsDiv #chkTuesday").is(':checked')) { byWeekDay.push(rrule.RRule.TU); }
                    if ($("#editModalSchedules #yearlyControlsDiv #chkWednesday").is(':checked')) { byWeekDay.push(rrule.RRule.WE); }
                    if ($("#editModalSchedules #yearlyControlsDiv #chkThursday").is(':checked')) { byWeekDay.push(rrule.RRule.TH); }
                    if ($("#editModalSchedules #yearlyControlsDiv #chkFriday").is(':checked')) { byWeekDay.push(rrule.RRule.FR); }
                    if ($("#editModalSchedules #yearlyControlsDiv #chkSaturday").is(':checked')) { byWeekDay.push(rrule.RRule.SA); }
                    if ($("#editModalSchedules #yearlyControlsDiv #chkSunday").is(':checked')) { byWeekDay.push(rrule.RRule.SU); }
                }
            }

            //#endregion

            let rule = new rrule.RRule({
                freq: freq,
                interval: interval,
                dtstart: dtStart.toDate(),
                until: until.toDate(),
                byweekday: byWeekDay,
                bymonthday: byMonthDay,
                bysetpos: bySetPos,
                bymonth: byMonth
                //wkst: wkst,
                //count: count,
                //tzid: tzId,
                //bynmonthday: byNMonthDay,
                //byyearday: byYearDay,
                //byweekno: byWeekNo,
                //bynweekday: byNWeekDay,
                //byhour: byHour,
                //byminute: byMinute,
                //bysecond: bySecond,
                //byeaster: byEaster
            });
            console.log('Generated RRule:', rule);

            return rule;
        }

        $("#generateRRule").on('click', (e) => {
            e.preventDefault();
            let generatedRRuleCode = generateRRule().toString();
            console.log('Display RRule:', generatedRRuleCode);
            $("#generatedRRuleCode").text(generatedRRuleCode.toString());
        });

        //#endregion

        //#endregion

        //#region Holidays

        var dbHolidays = {
            loadData: function (filter) {
                return $.grep(this.holidays, function (holiday) {
                    return (!filter.holidayName || holiday.holidayName.toLowerCase().indexOf(filter.holidayName.toLowerCase()) > -1)
                        && (!filter.holidayDate || holiday.holidayDate.toLowerCase().indexOf(filter.holidayDate.toLowerCase()) > -1);
                });
            },
            insertItem: function (insertingHoliday) {
                this.holidays.push(insertingHoliday);
            },
            updateItem: function (updatingHoliday) { },
            deleteItem: function (deletingHoliday) { }
        };

        window.dbHolidays = dbHolidays;

        var formSubmitHandlerHolidays = $.noop;

        let validatorHolidays = $("#editModalHolidays #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerHolidays();
            }
        });

        $("#addHoliday").on('click', (e) => {
            e.preventDefault();
            showHolidaysModal("Add", {});
        });

        function initHolidaysGrid() {
            const maxHolidays = 99;

            dbHolidays.holidays = caItem.hasOwnProperty('holidays') ? caItem.holidays : [];

            $("#jsGridHolidays").jsGrid({
                height: "auto",
                width: "100%",
                editing: true,
                autoload: true,
                sorting: false,
                filtering: false,
                paging: false,
                noDataContent: "No Holidays",
                confirmDeleting: false,
                onError: function (args) {
                    console.error('Failed to load grid data:', args);
                    showMessage("An error occurred while loading your data", true);
                },
                rowClick: function (args) {
                    showHolidaysModal("Edit", args.item);
                },
                onDataLoaded: function (args) {
                    $("#addHoliday").attr('disabled', $("#jsGridHolidays").jsGrid("option", "data").length >= maxHolidays);
                },
                onItemInserted: function (args) {
                    $("#addHoliday").attr('disabled', $("#jsGridHolidays").jsGrid("option", "data").length >= maxHolidays);
                },
                onItemUpdated: function (args) {
                    $("#addHoliday").attr('disabled', $("#jsGridHolidays").jsGrid("option", "data").length >= maxHolidays);
                },
                onItemDeleting: function (args) {
                    console.log("onItemDeleting");
                    if (!args.item.deleteConfirmed) { // custom property for confirmation
                        args.cancel = true; // cancel deleting
                        bootbox.confirm({
                            message: 'Do you really want to delete this holiday?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    args.item.deleteConfirmed = true;
                                    $("#jsGridHolidays").jsGrid('deleteItem', args.item); // Remove item from grid
                                    removeFromArray(dbHolidays.holidays, args.item); // Remove item from db
                                    showMessage("Holiday deleted", false);
                                }
                            }
                        });
                    }
                },
                onItemDeleted: function (args) {
                    $("#addHoliday").attr('disabled', $("#jsGridHolidays").jsGrid("option", "data").length >= maxHolidays);
                },
                controller: dbHolidays,
                fields: [
                    {
                        name: "holidayName",
                        title: "Name",
                        type: "text",
                        align: "center"
                    },
                    {
                        name: "holidayDate",
                        title: "Date",
                        type: "text",
                        align: "center",
                        itemTemplate: function (value, item) {
                            if (value) {
                                return moment(value).format('L');
                            } else {
                                return value;
                            }
                        }
                    },
                    {
                        type: "control",
                        modeSwitchButton: false,
                        editButton: false,
                        width: 68,
                        align: "center",
                        headerTemplate: function () {
                            return "Actions";
                        }
                    }
                ]
            });
        }

        var showHolidaysModal = function (dialogType, item) {
            console.log('Showing details for:', item);

            $("#editModalHolidays #holidayName").val(item.holidayName)
            if (item.holidayDate) $("#editModalHolidays #holidayDate").datetimepicker('date', moment(item.holidayDate));
            $("#editModalHolidays #submit").html("<i class='fa fa-floppy-o'></i> Save");
            formSubmitHandlerHolidays = function () {
                saveHoliday(item, dialogType === "Add");
            };
            $("#editModalHolidays").modal('show');
        };

        var saveHoliday = function (item, isNew) {
            console.log('Extending item:', item);
            $.extend(item, {
                holidayName: $("#editModalHolidays #holidayName").val(),
                holidayDate: $("#editModalHolidays #holidayDate").datetimepicker('date').toDate()
            });
            console.log('Extended Item:', item);
            console.log('IsNew?', isNew)
            $("#jsGridHolidays").jsGrid(isNew ? "insertItem" : "updateItem", item);
            $("#editModalHolidays").modal('hide');
        };

        $("#editModalHolidays").on('shown.bs.modal', function () {
            $("#holidayName").focus();
        });

        $('#editModalHolidays').on('hidden.bs.modal', async () => {
            console.log('Clearing holidays modal')
            initHolidaysModal();
        });

        function initHolidaysModal() {
            $("#editModalHolidays #holidayName").val("");
            $("#editModalHolidays #holidayDate").datetimepicker('clear');
            $("#editModalHolidays #submit").html("<i class='fa fa-plus'></i> Add");

            validatorHolidays.resetForm(); // Reset validation errors
        }

        //#endregion

        //#region ACD Skills

        var dbSkills = {
            loadData: function (filter) {
                return $.grep(this.skills, function (skill) {
                    return (!filter.skillName || skill.skillName.toLowerCase().indexOf(filter.skillName.toLowerCase()) > -1);
                });
            },
            insertItem: function (insertingSkill) {
                this.skills.push(insertingSkill);
            },
            updateItem: function (updatingSkill) { },
            deleteItem: function (deletingSkill) { }
        };

        window.dbSkills = dbSkills;

        var formSubmitHandlerSkills = $.noop;

        let validatorSkills = $("#editModalSkills #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerSkills();
            }
        });

        $("#addSkill").on('click', (e) => {
            e.preventDefault();
            showSkillsModal("Add", {});
        });

        function initSkillsGrid() {
            const maxSkills = 10;

            dbSkills.skills = caItem.hasOwnProperty('skills') ? caItem.skills : [];

            $("#jsGridSkills").jsGrid({
                height: "auto",
                width: "100%",
                editing: true,
                autoload: true,
                sorting: false,
                filtering: false,
                paging: false,
                noDataContent: "No Skills",
                confirmDeleting: false,
                onError: function (args) {
                    console.error('Failed to load grid data:', args);
                    showMessage("An error occurred while loading your data", true);
                },
                rowClick: function (args) {
                    showSkillsModal("Edit", args.item);
                },
                onDataLoaded: function (args) {
                    $("#addSkill").attr('disabled', $("#jsGridSkills").jsGrid("option", "data").length >= maxSkills);
                },
                onItemInserted: function (args) {
                    $("#addSkill").attr('disabled', $("#jsGridSkills").jsGrid("option", "data").length >= maxSkills);
                },
                onItemUpdated: function (args) {
                    $("#addSkill").attr('disabled', $("#jsGridSkills").jsGrid("option", "data").length >= maxSkills);
                },
                onItemDeleting: function (args) {
                    console.log("onItemDeleting");
                    if (!args.item.deleteConfirmed) { // custom property for confirmation
                        args.cancel = true; // cancel deleting
                        bootbox.confirm({
                            message: 'Do you really want to delete this Skill?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    args.item.deleteConfirmed = true;
                                    $("#jsGridSkills").jsGrid('deleteItem', args.item); // Remove item from grid
                                    removeFromArray(dbSkills.skills, args.item); // Remove item from db
                                    showMessage("Skill deleted", false);
                                }
                            }
                        });
                    }
                },
                onItemDeleted: function (args) {
                    $("#addSkill").attr('disabled', $("#jsGridSkills").jsGrid("option", "data").length >= maxSkills);
                },
                controller: dbSkills,
                fields: [
                    {
                        name: "skillName",
                        title: "Name",
                        type: "text",
                        align: "center"
                    },
                    {
                        type: "control",
                        modeSwitchButton: false,
                        editButton: false,
                        width: 68,
                        align: "center",
                        headerTemplate: function () {
                            return "Actions";
                        }
                    }
                ]
            });
        }

        var showSkillsModal = function (dialogType, item) {
            console.log('Showing details for:', item);
            $("#editModalSkills #skillName").val(item.skillName);
            $("#editModalSkills #submit").html("<i class='fa fa-floppy-o'></i> Save");
            formSubmitHandlerSkills = function () {
                saveSkill(item, dialogType === "Add");
            };
            $("#editModalSkills").modal('show');

        };

        var saveSkill = function (item, isNew) {
            console.log('Extending item:', item);
            $.extend(item, {
                skillName: $("#editModalSkills #skillName").val()
            });
            console.log('Extended Item:', item);
            console.log('IsNew?', isNew)
            $("#jsGridSkills").jsGrid(isNew ? "insertItem" : "updateItem", item);
            $("#editModalSkills").modal('hide');
        };

        $("#editModalSkills").on('shown.bs.modal', function () {
            $("#skillName").focus();
        });

        $('#editModalSkills').on('hidden.bs.modal', async () => {
            initSkillsModal();
        });

        function initSkillsModal() {
            $("#editModalSkills #skillName").val("");
            $("#editModalSkills #submit").html("<i class='fa fa-plus'></i> Add");

            validatorSkills.resetForm(); // Reset validation errors
        }

        //#endregion

        //#region WrapUp Codes

        var dbWrapUpCodes = {
            loadData: function (filter) {
                return $.grep(this.wrapUpCodes, function (code) {
                    return (!filter.wrapUpCode || code.wrapUpCode.toLowerCase().indexOf(filter.wrapUpCode.toLowerCase()) > -1);
                });
            },
            insertItem: function (insertingWrapUpCode) {
                this.wrapUpCodes.push(insertingWrapUpCode);
            },
            updateItem: function (updatingWrapUpCode) { },
            deleteItem: function (deletingWrapUpCode) { }
        };

        window.dbWrapUpCodes = dbWrapUpCodes;

        var formSubmitHandlerWrapUpCodes = $.noop;

        let validatorWrapUpCodes = $("#editModalWrapUpCodes #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerWrapUpCodes();
            }
        });

        $("#addWrapUpCode").on('click', (e) => {
            e.preventDefault();
            showWrapUpCodesModal("Add", {});
        });

        function initWrapUpCodesGrid() {
            const maxItems = 10;

            dbWrapUpCodes.wrapUpCodes = caItem.hasOwnProperty('wrapUpCodes') ? caItem.wrapUpCodes : [];

            $("#jsGridWrapUpCodes").jsGrid({
                height: "auto",
                width: "100%",
                editing: true,
                autoload: true,
                sorting: false,
                filtering: false,
                paging: false,
                noDataContent: "No WrapUp Codes",
                confirmDeleting: false,
                onError: function (args) {
                    console.error('Failed to load grid data:', args);
                    showMessage("An error occurred while loading your data", true);
                },
                rowClick: function (args) {
                    showWrapUpCodesModal("Edit", args.item);
                },
                onDataLoaded: function (args) {
                    $("#addWrapUpCode").attr('disabled', $("#jsGridWrapUpCodes").jsGrid("option", "data").length >= maxItems);
                },
                onItemInserted: function (args) {
                    $("#addWrapUpCode").attr('disabled', $("#jsGridWrapUpCodes").jsGrid("option", "data").length >= maxItems);
                    refreshWrapUpCodesDropDownForQueues();
                },
                onItemUpdated: function (args) {
                    $("#addWrapUpCode").attr('disabled', $("#jsGridWrapUpCodes").jsGrid("option", "data").length >= maxItems);
                    refreshWrapUpCodesDropDownForQueues();
                },
                onItemDeleting: function (args) {
                    console.log("onItemDeleting");
                    if (!args.item.deleteConfirmed) { // custom property for confirmation
                        args.cancel = true; // cancel deleting
                        bootbox.confirm({
                            message: 'Do you really want to delete this WrapUp Code?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    args.item.deleteConfirmed = true;
                                    $("#jsGridWrapUpCodes").jsGrid('deleteItem', args.item); // Remove item from grid
                                    removeFromArray(dbWrapUpCodes.wrapUpCodes, args.item); // Remove item from db
                                    refreshWrapUpCodesDropDownForQueues();
                                    showMessage("WrapUp Code deleted", false);
                                }
                            }
                        });
                    }
                },
                onItemDeleted: function (args) {
                    $("#addWrapUpCode").attr('disabled', $("#jsGridWrapUpCodes").jsGrid("option", "data").length >= maxItems);
                },
                controller: dbWrapUpCodes,
                fields: [
                    {
                        name: "wrapUpCode",
                        title: "Name",
                        type: "text",
                        align: "center"
                    },
                    {
                        type: "control",
                        modeSwitchButton: false,
                        editButton: false,
                        width: 68,
                        align: "center",
                        headerTemplate: function () {
                            return "Actions";
                        }
                    }
                ]
            });
        }

        var showWrapUpCodesModal = function (dialogType, item) {
            console.log('Showing details for:', item);
            $("#editModalWrapUpCodes #wrapUpCode").val(item.wrapUpCode);
            $("#editModalWrapUpCodes #submit").html("<i class='fa fa-floppy-o'></i> Save");
            formSubmitHandlerWrapUpCodes = function () {
                saveWrapUpCode(item, dialogType === "Add");
            };
            $("#editModalWrapUpCodes").modal('show');

        };

        var saveWrapUpCode = function (item, isNew) {
            console.log('Extending item:', item);
            $.extend(item, {
                wrapUpCode: $("#editModalWrapUpCodes #wrapUpCode").val()
            });
            console.log('Extended Item:', item);
            console.log('IsNew?', isNew);

            $("#jsGridWrapUpCodes").jsGrid(isNew ? "insertItem" : "updateItem", item);
            $("#editModalWrapUpCodes").modal('hide');
        };

        $("#editModalWrapUpCodes").on('shown.bs.modal', function () {
            $("#wrapUpCode").focus();
        });

        $('#editModalWrapUpCodes').on('hidden.bs.modal', async () => {
            initWrapUpCodesModal();
        });

        function initWrapUpCodesModal() {
            $("#editModalWrapUpCodes #wrapUpCode").val("");
            $("#editModalWrapUpCodes #submit").html("<i class='fa fa-plus'></i> Add");

            validatorWrapUpCodes.resetForm(); // Reset validation errors
        }

        function refreshWrapUpCodesDropDownForQueues() {
            console.log('refreshWrapUpCodesDropDownForQueues()');
            $("#editModalQueues #queueWrapUpCode option").remove();

            if (dbWrapUpCodes.wrapUpCodes && dbWrapUpCodes.wrapUpCodes.length > 0) {
                $.each(dbWrapUpCodes.wrapUpCodes, (i, aItem) => {
                    console.log('wrapUpCodeName: ', aItem.wrapUpCode);
                    $("<option/>", { value: aItem.wrapUpCode }).text(aItem.wrapUpCode).appendTo("#editModalQueues #queueWrapUpCode");
                });
                $("#editModalQueues #queueWrapUpCode").selectpicker('refresh');
            } else {
                console.log('No WrapUp codes found...');
            }
        }

        //#endregion

        //#region Queues

        $("#queueWrapUpCode").selectpicker({
            width: '100%',
            selectedTextFormat: 'count > 3',
            title: "Select one or more WrapUp Codes"
        });


        var dbQueues = {
            loadData: function (filter) {
                return $.grep(this.queues, function (queue) {
                    return (!filter.queues || queue.queueName.toLowerCase().indexOf(filter.queueName.toLowerCase()) > -1);
                });
            },
            insertItem: function (insertingQueue) {
                this.queues.push(insertingQueue);
            },
            updateItem: function (updatingQueue) { },
            deleteItem: function (deletingQueue) { }
        };

        window.dbQueues = dbQueues;

        var formSubmitHandlerQueues = $.noop;

        let validatorQueues = $("#editModalQueues #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerQueues();
            }
        });

        $("#addQueue").on('click', (e) => {
            e.preventDefault();
            showQueuesModal("Add", {});
        });

        $("#editModalQueues #acw").on('change', (e) => {
            e.preventDefault();
            if ($("#editModalQueues #acw").val() !== "MANDATORY, OPTIONAL")
                $("#editModalQueues #acwTimeout").attr('disabled', false)
            else {
                $("#editModalQueues #acwTimeout").attr('disabled', true);
                $("#editModalQueues #acwTimeout").val('');
            }
        });

        function initQueuesGrid() {
            const maxItems = 3;

            dbQueues.queues = caItem.hasOwnProperty('queues') ? caItem.queues : [];

            $("#jsGridQueues").jsGrid({
                height: "auto",
                width: "100%",
                editing: true,
                autoload: true,
                sorting: true,
                filtering: false,
                paging: false,
                noDataContent: "No Queues",
                confirmDeleting: false,
                onError: function (args) {
                    console.error('Failed to load grid data:', args);
                    showMessage("An error occurred while loading your data", true);
                },
                rowClick: function (args) {

                    showQueuesModal("Edit", args.item);
                },
                onDataLoaded: function (args) {
                    $("#addQueue").attr('disabled', $("#jsGridQueues").jsGrid("option", "data").length >= maxItems);
                },
                onItemInserted: function (args) {
                    $("#addQueue").attr('disabled', $("#jsGridQueues").jsGrid("option", "data").length >= maxItems);
                },
                onItemUpdated: function (args) {
                    $("#addQueue").attr('disabled', $("#jsGridQueues").jsGrid("option", "data").length >= maxItems);
                },
                onItemDeleting: function (args) {
                    console.log("onItemDeleting");
                    if (!args.item.deleteConfirmed) { // custom property for confirmation
                        args.cancel = true; // cancel deleting
                        bootbox.confirm({
                            message: 'Do you really want to delete this Queue?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    args.item.deleteConfirmed = true;
                                    $("#jsGridQueues").jsGrid('deleteItem', args.item); // Remove item from grid
                                    removeFromArray(dbQueues.queues, args.item); // Remove item from db
                                    showMessage("Queue deleted", false);
                                }
                            }
                        });
                    }
                },
                onItemDeleted: function (args) {
                    $("#addQueue").attr('disabled', $("#jsGridQueues").jsGrid("option", "data").length >= maxItems);
                },

                controller: dbQueues,
                fields: [
                    {
                        name: "queueName",
                        title: "Queue Name",
                        type: "text",
                        align: "center"
                    },
                    {
                        name: "enableCallbacks",
                        title: "Supports Callbacks",
                        type: "text",
                        align: "center",
                        itemTemplate: function (value, item) {
                            return value ? '<span class="fa fa-check text-success"></span>' : ''
                        }
                    },
                    {
                        name: "enableEmails",
                        title: "Supports Emails",
                        type: "text",
                        align: "center",
                        itemTemplate: function (value, item) {
                            return value ? '<span class="fa fa-check text-success"></span>' : ''
                        }
                    },
                    {
                        type: "control",
                        modeSwitchButton: false,
                        editButton: false,
                        width: 68,
                        align: "center",
                        headerTemplate: function () {
                            return "Actions";
                        }
                    }
                ]
            });
        }

        var showQueuesModal = function (dialogType, item) {
            console.log('Showing details for:', item);
            $('#queueAdvancedSettings').collapse('hide');
            $("#editModalQueues #queueWrapUpCode").selectpicker('refresh');

            $("#editModalQueues #queueName").val(item.queueName);
            $("#editModalQueues #enableCallbacks").prop('checked', item.enableCallbacks);
            $("#editModalQueues #enableEmails").prop('checked', item.enableEmails);
            $("#editModalQueues #acw").val(item.acw ? item.acw : 'MANDATORY, OPTIONAL');
            $("#editModalQueues #acwTimeout").val((item.acwTimeout && item.acwTimeout !== 'n/a') ? item.acwTimeout : '');
            if ($("#editModalQueues #acw").val() !== "MANDATORY, OPTIONAL")
                $("#editModalQueues #acwTimeout").attr('disabled', false);
            else
                $("#editModalQueues #acwTimeout").attr('disabled', true);

            $("#editModalQueues #evaluationMethod").val(item.evaluationMethod ? item.evaluationMethod : 'NONE');
            $("#editModalQueues #alertingTimeout").val((item.alertingTimeout && item.alertingTimeout !== 'n/a') ? item.alertingTimeout : '15');
            $("#editModalQueues #slPercentage").val((item.slPercentage && item.slPercentage !== 'n/a') ? item.slPercentage : '80');
            $("#editModalQueues #slDuration").val(item.slDuration ? item.slDuration : '20');
            $("#editModalQueues #callingPartyName").val((item.callingPartyName && item.callingPartyName !== 'n/a') ? item.callingPartyName : undefined);
            $("#editModalQueues #callingPartyNumber").val((item.callingPartyNumber && item.callingPartyNumber !== 'n/a') ? item.callingPartyNumber : undefined);
            $("#editModalQueues #queueWrapUpCode").val(item.wrapUpCodes ? item.wrapUpCodes : undefined);
            $("#editModalQueues #queueWrapUpCode").selectpicker('refresh');

            $("#editModalQueues #submit").html("<i class='fa fa-floppy-o'></i> Save");
            formSubmitHandlerQueues = function () {
                saveQueue(item, dialogType === "Add");
            };
            $("#editModalQueues").modal('show');

        };

        var saveQueue = function (item, isNew) {
            console.log('Extending item:', item);
            $.extend(item, {
                queueName: $("#editModalQueues #queueName").val(),
                enableCallbacks: $("#editModalQueues #enableCallbacks").is(":checked"),
                enableEmails: $("#editModalQueues #enableEmails").is(":checked"),
                acw: $("#editModalQueues #acw").val(),
                acwTimeout: $("#editModalQueues #acwTimeout").val() == "" ? 'n/a' : $("#editModalQueues #acwTimeout").val(),
                evaluationMethod: $("#editModalQueues #evaluationMethod").val(),
                alertingTimeout: $("#editModalQueues #alertingTimeout").val() == "" ? '15' : $("#editModalQueues #alertingTimeout").val(),
                slPercentage: $("#editModalQueues #slPercentage").val() == "" ? '80' : $("#editModalQueues #slPercentage").val(),
                slDuration: $("#editModalQueues #slDuration").val() == "" ? '20' : $("#editModalQueues #slDuration").val(),
                callingPartyName: $("#editModalQueues #callingPartyName").val() == "" ? 'n/a' : $("#editModalQueues #callingPartyName").val(),
                callingPartyNumber: $("#editModalQueues #callingPartyNumber").val() == "" ? 'n/a' : $("#editModalQueues #callingPartyNumber").val(),
                wrapUpCodes: $("#editModalQueues #queueWrapUpCode").val()
            });
            console.log('Extended Item:', item);
            console.log('IsNew?', isNew)
            $("#jsGridQueues").jsGrid(isNew ? "insertItem" : "updateItem", item);
            $("#editModalQueues").modal('hide');
        };

        $("#editModalQueues").on('shown.bs.modal', function () {
            $("#queueName").focus();
        });

        $('#editModalQueues').on('hidden.bs.modal', async () => {
            initQueuesModal();
        });

        function initQueuesModal() {
            $("#editModalQueues #queueName").val("");
            $("#editModalQueues #enableCallbacks").prop('checked', false);
            $("#editModalQueues #enableEmails").prop('checked', false);
            $("#editModalQueues #submit").html("<i class='fa fa-plus'></i> Add");

            validatorQueues.resetForm(); // Reset validation errors
        }

        //#endregion

        //#region Prompts

        let drop = document.getElementById('promptUpload');
        let uploadedFileAnchor = $("#editModalPrompts #uploadedFile");

        let s3BucketBasePath = "//cc-requests-prompts-bucket.s3.eu-central-1.amazonaws.com";

        let defaultPrompts = [
            {
                messageName: "Main Greeting Message",
                promptText: "Thank you for calling <Company Name>",
                promptName: "MainGreeting.wav",
                promptFile: "n/a",
                useTTS: false
            },
            {
                messageName: "Main Menu Message",
                promptText: "If you are a new customer and looking for more information about out product, press 1.  If you have purchased our product and currenting have any issues or inquiries, press 2.  If you are a 3rd party vendor seeking marketing material, press 3.  For all other inquiries press 4.  To repeat this options press star.",
                promptName: "MainMenu.wav",
                promptFile: "n/a",
                useTTS: false
            },
            {
                messageName: "Closed Message",
                promptText: "Our offices are closed at present; please call back during our normal opening hours which are 8 AM to 5 PM, Monday through Friday.",
                promptName: "ClosedMessage.wav",
                promptFile: "n/a",
                useTTS: false
            },
            {
                messageName: "Holiday Message",
                promptText: "We are closed for holiday.  Please see our website at www.company.com/businesshours for when we will return to normal operating hours.  Have a great day.",
                promptName: "HolidayMessage.wav",
                promptFile: "n/a",
                useTTS: false
            },
            {
                messageName: "Emergency Message",
                promptText: "We are experiencing interruption in our service.  You can find out more information at www.company.com/events for next steps and when we will return to normal operations.  We apologize for any inconvenience this may have caused.",
                promptName: "EmergencyMessage.wav",
                promptFile: "n/a",
                useTTS: false
            }
        ];

        var dbPrompts = {
            loadData: function (filter) {
                return $.grep(this.prompts, function (prompt) {
                    return (!filter.messageName || prompt.messageName.toLowerCase().indexOf(filter.messageName.toLowerCase()) > -1);
                });
            },
            insertItem: function (insertingItem) {
                this.prompts.push(insertingItem);
            },
            updateItem: function (updatingItem) { },
            deleteItem: function (deletingItem) { }
        };

        window.dbPrompts = dbPrompts;

        var formSubmitHandlerPrompts = $.noop;

        let validatorPrompts = $("#editModalPrompts #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerPrompts();
            }
        });

        function initPromptsGrid() {
            const maxItems = 5;

            dbPrompts.prompts = caItem.hasOwnProperty('prompts') ? caItem.prompts : [];

            if (dbPrompts.prompts.length === 0) {
                dbPrompts.prompts = defaultPrompts;
            }

            $("#jsGridPrompts").jsGrid({
                height: "auto",
                width: "100%",
                editing: true,
                autoload: true,
                sorting: false,
                filtering: false,
                paging: false,
                noDataContent: "No Prompts",
                confirmDeleting: false,
                onError: function (args) {
                    console.error('Failed to load grid data:', args);
                    showMessage("An error occurred while loading your data", true);
                },
                rowClick: function (args) {
                    showPromptModal("Edit", args.item);
                },
                onDataLoaded: function (args) {
                },
                onItemInserted: function (args) {
                },
                onItemUpdated: function (args) {
                },
                onItemDeleting: function (args) {
                    console.log("onItemDeleting");
                    if (!args.item.deleteConfirmed) { // custom property for confirmation
                        args.cancel = true; // cancel deleting
                        bootbox.confirm({
                            message: 'Do you really want to delete this Prompt?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    args.item.deleteConfirmed = true;
                                    $("#jsGridPrompts").jsGrid('deleteItem', args.item); // Remove item from grid
                                    removeFromArray(dbPrompts.prompts, args.item); // Remove item from db
                                    showMessage("Prompt deleted", false);
                                }
                            }
                        });
                    }
                },
                onItemDeleted: function (args) {
                },
                controller: dbPrompts,
                fields: [
                    {
                        name: "messageName",
                        title: "Message Name",
                        type: "text",
                        align: "center"
                    },
                    {
                        name: "promptText",
                        title: "Prompt Text",
                        type: "text",
                        align: "center"
                    },
                    {
                        name: "promptName",
                        title: "Prompt Name",
                        type: "text",
                        align: "center"
                    },
                    {
                        name: "promptFile",
                        title: "Prompt File",
                        type: "text",
                        align: "center"
                    },
                    {
                        name: "useTTS",
                        title: "useTTS",
                        type: "checkbox",
                        align: "center"
                    },
                    {
                        type: "control",
                        modeSwitchButton: false,
                        editButton: false,
                        width: 68,
                        align: "center",
                        headerTemplate: function () {
                            return "Actions";
                        }
                    }
                ]
            });
        }

        var showPromptModal = function (dialogType, item) {
            console.log('Showing details for:', item);
            $("#editModalPrompts #messageName").val(item.messageName);
            $("#editModalPrompts #promptText").val(item.promptText);
            $("#editModalPrompts #promptName").val(item.promptName);
            $("#editModalPrompts #promptFile").val(item.promptFile);
            $("#editModalPrompts #useTTS").attr('checked', item.useTTS);
            $("#editModalPrompts #submit").html("<i class='fa fa-floppy-o'></i> Save");
            formSubmitHandlerPrompts = function () {
                savePrompt(item, dialogType === "Add");
            };
            $("#editModalPrompts").modal('show');
        };

        var savePrompt = function (item, isNew) {
            try {
                console.log('Extending item:', item);
                let promptFile = $("#editModalPrompts #uploadedFile").text();
                if (!promptFile || promptFile.length === 0) {
                    promptFile = "n/a";
                }
                let promptFileLink = $("#editModalPrompts #uploadedFile").attr("href");

                $.extend(item, {
                    messageName: $("#editModalPrompts #messageName").val(),
                    promptText: $("#editModalPrompts #promptText").val(),
                    promptName: $("#editModalPrompts #promptName").val(),
                    promptFile: promptFileLink || "n/a",
                    useTTS: $("#editModalPrompts #useTTS").is(':checked')
                });
                console.log('Extended Item:', item);
                console.log('IsNew?', isNew);

                $("#jsGridPrompts").jsGrid(isNew ? "insertItem" : "updateItem", item);
                $("#editModalPrompts").modal('hide');
            } catch (error) {
                console.error(error);
                showMessage(error, true);
            }
        };

        $("#editModalPrompts").on('shown.bs.modal', function () {
            $("#promptText").focus();
        });

        $('#editModalPrompts').on('hidden.bs.modal', async () => {
            initPromptsModal();
        });

        function initPromptsModal() {
            $("#editModalPrompts #messageName").val("");
            $("#editModalPrompts #promptText").val("");
            $("#editModalPrompts #promptName").val("");
            //$("#editModalPrompts #promptFile").val("");
            uploadedFileAnchor.attr("href", "");
            uploadedFileAnchor.text("");
            $("#editModalPrompts #promptUploadFile").val("");
            $("#editModalPrompts #useTTS").attr('checked', false);
            $("#editModalPrompts #submit").html("<i class='fa fa-floppy-o'></i> Save");

            validatorPrompts.resetForm(); // Reset validation errors
        }

        $("#editModalPrompts #useTTS").on('change', () => {
            if ($("#editModalPrompts #useTTS").is(':checked')) {
                $("#editModalPrompts #promptTextDiv").show();
                $("#editModalPrompts #promptUploadDiv").hide();
            } else {
                $("#editModalPrompts #promptTextDiv").hide();
                $("#editModalPrompts #promptUploadDiv").show();
            }
        });

        //TODO Set promptFile value in grid
        //TODO Add validator for uploaded file label

        //#region Upload Prompt

        $("#editModalPrompts #promptUploadFile").on('change', (e) => {
            let files = e.target.files;
            uploadFiles(files);
        });

        function cancel(e) {
            e.preventDefault();
            return false;
        }

        function handleDrop(e) {
            e.preventDefault();
            var dt = e.dataTransfer;
            var files = dt.files;
            uploadFiles(files);
            return false;
        }

        function uploadFiles(files) {
            for (var i = 0; i < files.length; i++) {
                var file = files[i];
                var reader = new FileReader();
                reader.addEventListener('loadend', function (e) {
                    fetch(apiBasePath + "/cloudautomation/uploadUrl", {
                        method: "POST",
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            name: file.name,
                            type: file.type,
                            requestId: id,
                            token: gcToken
                        })
                    })
                        .then(function (response) {
                            return response.json();
                        })
                        .then(function (json) {
                            return fetch(json.uploadUrl, {
                                method: "PUT",
                                body: new Blob([reader.result], { type: file.type })
                            })
                        })
                        .then(function (putResponse) {
                            let link = `${s3BucketBasePath}/${id}/${file.name}`;
                            uploadedFileAnchor.attr("href", link);
                            uploadedFileAnchor.text(file.name);
                        });
                });
                reader.readAsArrayBuffer(file);
            }
        }

        // Tells the browser that we *can* drop on this target
        drop.addEventListener('dragenter', (e) => {
            $("#editModalPrompts #promptUploadInput").addClass("drop-active");
            return cancel(e);
        });

        drop.addEventListener('dragover', (e) => {
            $("#editModalPrompts #promptUploadInput").addClass("drop-active");
            return cancel(e);
        });

        drop.addEventListener('dragleave', (e) => {
            $("#editModalPrompts #promptUploadInput").removeClass("drop-active");
        });

        drop.addEventListener('drop', (e) => {
            $("#editModalPrompts #promptUploadInput").removeClass("drop-active");
            handleDrop(e);
        });

        //#endregion

        //#endregion

        //#region Call Flow Experience

        let callFlowExperience = {
        };

        $('.num').click(function () {
            var menuDigit = $.trim($(this).find('.txt').clone().children().remove().end().text());
            console.log(menuDigit);
            if (callFlowExperience.hasOwnProperty(menuDigit)) {
                console.log(`Edit ${callFlowExperience[menuDigit]} for digit: ${menuDigit}`);
                showCallFlowExperienceModal("Edit", menuDigit, callFlowExperience[menuDigit]);
            } else {
                console.log(`Adding new call flow experience for digit: ${menuDigit}`);
                showCallFlowExperienceModal("Add", menuDigit, {});
            }
        });

        var formSubmitHandlerCallFlowExperience = $.noop;

        let validatorCallFlowExperience = $("#editModalCallFlowExperience #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerCallFlowExperience();
            }
        });

        var showCallFlowExperienceModal = function (dialogType, menuDigit, item) {

            // Populate queues
            $("#editModalCallFlowExperience #queues").empty();
            $("<option/>", { value: "", disabled: true, selected: true }).text("Select a Queue").appendTo("#queues");
            $.each($("#jsGridQueues").jsGrid("option", "data"), (key, item) => {
                $("<option/>", { value: item.queueName }).text(item.queueName).appendTo("#queues");
            });

            // Populate skills
            $("#editModalCallFlowExperience #skills").empty();
            $("<option/>", { value: "", disabled: true, selected: true }).text("Select a Skill").appendTo("#skills");
            $.each($("#jsGridSkills").jsGrid("option", "data"), (key, item) => {
                $("<option/>", { value: item.skillName }).text(item.skillName).appendTo("#skills");
            });

            // Populate prompts
            $("#editModalCallFlowExperience #prompts").empty();
            $("<option/>", { value: "", disabled: true, selected: true }).text("Select a Prompt").appendTo("#prompts");
            $.each($("#jsGridPrompts").jsGrid("option", "data"), (key, item) => {
                $("<option/>", { value: item.promptName }).text(item.messageName).appendTo("#prompts");
            });

            switch (dialogType) {
                case "Edit":
                    console.log('Showing details for:', item);
                    if (!item.hasOwnProperty('menuDigit')) { item.menuDigit = menuDigit; }

                    $("#editModalCallFlowExperience #title").text(`Option ${item.menuDigit}`);
                    $("#editModalCallFlowExperience #default").prop('checked', callFlowExperience.default === item.menuDigit);
                    $("#editModalCallFlowExperience #behavior").val(item.behavior);
                    $("#editModalCallFlowExperience #behavior").change();
                    $("#editModalCallFlowExperience #queues").val(item.queueName);
                    $("#editModalCallFlowExperience #skills").val(item.skill);
                    $("#editModalCallFlowExperience #prompts").val(item.prompt);

                    formSubmitHandlerCallFlowExperience = function () {
                        saveCallFlowExperience(item, dialogType === "Edit");
                    };
                    break;
                case "Add":
                    console.log('Showing modal for menu digit:', menuDigit);
                    item.menuDigit = menuDigit;
                    formSubmitHandlerCallFlowExperience = function () {
                        saveCallFlowExperience(item, dialogType === "Add");
                    };
                    break;
                default:
                    console.error('Unknown dialog type:', dialogType);
                    showMessage('Unknown dialog type: ' + dialogType, true);
                    break;
            }
            $("#editModalCallFlowExperience").modal('show');
        };

        $("#editModalCallFlowExperience #behavior").on('change', () => {
            let behavior = $("#editModalCallFlowExperience #behavior").val();
            switch (behavior) {
                case "transferToQueue":
                    $("#editModalCallFlowExperience #queuesDiv").show();
                    $("#editModalCallFlowExperience #skillsDiv").show();
                    $("#editModalCallFlowExperience #promptsDiv").hide();
                    break;
                case "playMessageAndDisconnect":
                    $("#editModalCallFlowExperience #queuesDiv").hide();
                    $("#editModalCallFlowExperience #skillsDiv").hide();
                    $("#editModalCallFlowExperience #promptsDiv").show();
                    break;
                case "repeatMenu":
                    $("#editModalCallFlowExperience #queuesDiv").hide();
                    $("#editModalCallFlowExperience #skillsDiv").hide();
                    $("#editModalCallFlowExperience #promptsDiv").hide();
                    break;
                default:
                    $("#editModalCallFlowExperience #queuesDiv").hide();
                    $("#editModalCallFlowExperience #skillsDiv").hide();
                    $("#editModalCallFlowExperience #promptsDiv").hide();
                    break;
            }
        });

        var saveCallFlowExperience = function (item, isNew) {
            try {
                console.log('Extending item:', item);
                $.extend(item, {
                    behavior: $("#editModalCallFlowExperience #behavior").val(),
                    queueName: $("#editModalCallFlowExperience #queues").val(),
                    skill: $("#editModalCallFlowExperience #skills").val(),
                    prompt: $("#editModalCallFlowExperience #prompts").val()
                });
                if ($("#editModalCallFlowExperience #default").is(":checked")) {
                    callFlowExperience.default = item.menuDigit;
                }
                console.log('Extended Item:', item);
                console.log('IsNew?', isNew);
                let newItem = {};
                Object.assign(newItem, item); // Copy object
                delete newItem.menuDigit;

                // Do not try to save queue if it's empty
                if (!newItem.queueName || newItem.queueName.length === 0) {
                    delete newItem.queueName;
                }

                // Do not try to save skill if it's empty
                if (!newItem.skill || newItem.skill.length === 0) {
                    delete newItem.skill;
                }

                // Do not try to save prompt if it's empty
                if (!newItem.prompt || newItem.prompt.length === 0) {
                    delete newItem.prompt;
                }

                // if (!callFlowExperience.hasOwnProperty(item.menuDigit)) {
                //     callFlowExperience[menuDigit] =: {} });
                // }
                callFlowExperience[item.menuDigit] = newItem;
                console.log('Call Flow Experience:', callFlowExperience);

                refreshPhonePad();

                $("#editModalCallFlowExperience").modal('hide');
            } catch (error) {
                console.error(error);
                showMessage(error, true);
            }
        };

        var refreshPhonePad = function () {

            // Clear existing colors
            $.each($("[data-digit]"), (i, item) => {
                item.classList.remove('text-success');
                item.parentNode.classList.remove('bg-secondary');
            });

            // Set text colors if digit has fields set
            $.each(callFlowExperience, (i, callFlowExperienceItem) => {
                let digitControl = $(`*[data-digit='${i}']`).eq(0);
                if (callFlowExperienceItem.hasOwnProperty('behavior') && callFlowExperienceItem.behavior.length > 0) {
                    digitControl.removeClass('text-success').addClass('text-success'); // Making sure it's not added twice
                } else {
                    digitControl.removeClass('text-success');
                }
            });

            // Set background color for default digit
            if (callFlowExperience.hasOwnProperty('default') && callFlowExperience.default.length > 0) {
                let defaultDigitControl = $(`*[data-digit='${callFlowExperience.default}']`).eq(0);

                // Set round circle color
                let parentDiv = defaultDigitControl.parent(); // Round item is parent of the digit text
                parentDiv.removeClass('bg-secondary').addClass('bg-secondary'); // Making sure it's not added twice
            }
        }

        var initCallFlowExperience = function (savedCallFlowExperience) {
            callFlowExperience = savedCallFlowExperience;
            refreshPhonePad();
        }

        $("#editModalCallFlowExperience").on('shown.bs.modal', function () {
            $("#editModalCallFlowExperience #menuDigit").focus();
        });

        $('#editModalCallFlowExperience').on('hidden.bs.modal', async () => {
            initCallFlowExperienceModal();
        });

        function initCallFlowExperienceModal() {
            $("#editModalCallFlowExperience #default").prop('checked', false);
            $("#editModalCallFlowExperience #behavior").val("");
            $("#editModalCallFlowExperience #behavior").change();
            $("#editModalCallFlowExperience #queues").val("");
            $("#editModalCallFlowExperience #skills").val("");
            $("#editModalCallFlowExperience #prompts").val("");
            $("#editModalCallFlowExperience #submit").html("<i class='fa fa-plus'></i> Add");

            validatorCallFlowExperience.resetForm(); // Reset validation errors
        }

        //#endregion

        //#region DIDs

        var dbDIDs = {
            loadData: function (filter) {
                console.log(this);
                return $.grep(this.DIDs.ranges, function (DID) {
                    return (!filter.didStart || DID.didStart.toLowerCase().indexOf(filter.didStart.toLowerCase()) > -1);
                });
            },
            insertItem: function (insertingDID) {
                this.DIDs.ranges.push(insertingDID);
            },
            updateItem: function (updatingDID) { },
            deleteItem: function (deletingDID) { }
        };

        window.dbDIDs = dbDIDs;

        var formSubmitHandlerDIDs = $.noop;

        let validatorDIDs = $("#editModalDIDs #modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success",
            submitHandler: function () {
                formSubmitHandlerDIDs();
            }
        });

        $("#addDID").on('click', (e) => {
            e.preventDefault();
            showDIDsModal("Add", {});
        });

        function initDIDsGrid() {
            const maxItems = 10;

            dbDIDs.DIDs = caItem.hasOwnProperty('dids') ? caItem.dids : { mainInboundNumber: '', ranges: [] };

            $("#jsGridDIDs").jsGrid({
                height: "auto",
                width: "100%",
                editing: true,
                autoload: true,
                sorting: false,
                filtering: false,
                paging: false,
                noDataContent: "No DID Numbers",
                confirmDeleting: false,
                onError: function (args) {
                    console.error('Failed to load grid data:', args);
                    showMessage("An error occurred while loading your data", true);
                },
                rowClick: function (args) {
                    showDIDsModal("Edit", args.item);
                },
                onDataLoaded: function (args) {
                    $("#addDID").attr('disabled', $("#jsGridDIDs").jsGrid("option", "data").length >= maxItems);
                },
                onItemInserted: function (args) {
                    $("#addDID").attr('disabled', $("#jsGridDIDs").jsGrid("option", "data").length >= maxItems);
                },
                onItemUpdated: function (args) {
                    $("#addDID").attr('disabled', $("#jsGridDIDs").jsGrid("option", "data").length >= maxItems);
                },
                onItemDeleting: function (args) {
                    console.log("onItemDeleting");
                    if (!args.item.deleteConfirmed) { // custom property for confirmation
                        args.cancel = true; // cancel deleting
                        bootbox.confirm({
                            message: 'Do you really want to delete this DID Number?',
                            buttons: {
                                confirm: {
                                    label: "Delete!",
                                    className: "btn-danger"
                                },
                                cancel: {
                                    label: "No",
                                    className: "btn-secondary"
                                }
                            },
                            callback: async function (result) {
                                if (result) {
                                    args.item.deleteConfirmed = true;
                                    $("#jsGridDIDs").jsGrid('deleteItem', args.item); // Remove item from grid
                                    removeFromArray(dbDIDs.DIDs.ranges, args.item); // Remove item from db
                                    showMessage("DID deleted", false);
                                }
                            }
                        });
                    }
                },
                onItemDeleted: function (args) {
                    $("#addDID").attr('disabled', $("#jsGridDIDs").jsGrid("option", "data").length >= maxItems);
                },
                controller: dbDIDs,
                fields: [
                    {
                        name: "didStart",
                        title: "DID Start Range",
                        type: "text",
                        align: "center"
                    },
                    {
                        name: "didEnd",
                        title: "DID End Range",
                        type: "text",
                        align: "center"
                    },
                    {
                        type: "control",
                        modeSwitchButton: false,
                        editButton: false,
                        width: 68,
                        align: "center",
                        headerTemplate: function () {
                            return "Actions";
                        }
                    }
                ]
            });
        }

        var showDIDsModal = function (dialogType, item) {
            console.log('Showing details for:', item);
            $("#editModalDIDs #didStart").val(item.didStart);
            $("#editModalDIDs #didEnd").val(item.didEnd);
            $("#editModalDIDs #didComment").val(item.didComment);
            $("#editModalDIDs #submit").html("<i class='fa fa-floppy-o'></i> Save");
            formSubmitHandlerDIDs = function () {
                saveDID(item, dialogType === "Add");
            };
            $("#editModalDIDs").modal('show');

        };

        var saveDID = function (item, isNew) {
            console.log('Extending item:', item);
            $.extend(item, {
                didStart: $("#editModalDIDs #didStart").val(),
                didEnd: $("#editModalDIDs #didEnd").val(),
                didComment: $("#editModalDIDs #didComment").val()
            });
            console.log('Extended Item:', item);
            console.log('IsNew?', isNew)
            $("#jsGridDIDs").jsGrid(isNew ? "insertItem" : "updateItem", item);
            $("#editModalDIDs").modal('hide');
        };

        $("#editModalDIDs").on('shown.bs.modal', function () {
            $("#didStart").focus();
        });

        $('#editModalDIDs').on('hidden.bs.modal', async () => {
            initDIDsModal();
        });

        function initDIDsModal() {
            $("#editModalDIDs #didStart").val("");
            $("#editModalDIDs #didEnd").val("");
            $("#editModalDIDs #didComment").val("");
            $("#editModalDIDs #submit").html("<i class='fa fa-plus'></i> Add");

            validatorDIDs.resetForm(); // Reset validation errors
        }

        //#endregion

        //#region Other Useful Functions

        function removeFromArray(array, value) {
            let idx = array.indexOf(value);
            if (idx !== -1) {
                array.splice(idx, 1);
            }
            return array;
        }

        function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
        };

        //#endregion

    </script>

    <!--Coollabs -->
    <script async defer src="https://cdn.coollabs.io/save.js"></script>

</body>

</html>