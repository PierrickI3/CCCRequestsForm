<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <title>CCC Homeworker Request Form</title>
    <link rel="shortcut icon" href="/favicon.ico">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Bootstrap DatePicker -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker3.min.css" integrity="sha256-FAOaXTpl90/K8cXmSdsskbQN3nKYulhCpPbcFzGTWKI=" crossorigin="anonymous" />
    <!-- jQuery Toast -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.css" rel="stylesheet">
    <!-- Bootstrap Select -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="./css/custom.css">

</head>

<body>
    <img class="overlay" src="./images/devmode.png" id="devModeImage" hidden alt="devMode" />
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand" href="#">
            <img src="images/genesys.png" width="30" height="30" class="d-inline-block align-top" alt="">
            <span class="badge badge-warning">#homeworker</span> Questionnaire <small><span class="badge badge-pill badge-warning" id="regionBadge"></span></small>
        </a>

        <ul class="mb-0">
            <ul class="nav navbar-nav" style="float: right;">
                <li>
                    <a href="#" id="reviewRequestsButton" class="admin btn btn-primary btn-sm" hidden>Review Requests</a>
                </li>

            </ul>
            <ul class="nav navbar-nav mr-2" style="float: right;">
                <li>
                    <a href="../index.html" id="backToCCCRequestForm" class="admin btn btn-secondary btn-sm" hidden>Back to CC Request Form</a>
                </li>

            </ul>

        </ul>

    </nav>

    <div class="alert alert-danger fade show" role="alert" id="alert" hidden>
        <strong>Maintenance Alert</strong> This site is being updated. Please wait.
        <a class="btn btn-light" href="#" onclick="location.reload();"><i class="fa fa-refresh"></i> Refresh</a>
    </div>

    <p id="requestId">requestId: </p>

    <noscript>You need to enable JavaScript to run this app.</noscript>
    <!--#region Imports -->
    <!-- Bootstrap core JavaScript-->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <!-- Core plugin JavaScript-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js" integrity="sha256-4iQZ6BVL4qNKlQ27TExEhBN1HFPvAvAMbFavKKosSWQ=" crossorigin="anonymous"></script>
    <!-- Bootstrap DatePicker -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js" integrity="sha256-bqVeqGdJ7h/lYPq6xrPv/YGzMEb6dNxlfiTUHSgRCp8=" crossorigin="anonymous"></script>
    <!-- Genesys Cloud -->
    <script src="https://sdk-cdn.mypurecloud.com/javascript/61.0.0/purecloud-platform-client-v2.min.js"></script>
    <!-- JQuery Validate -->
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/additional-methods.min.js"></script>
    <!-- jQuery Toast -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.js"></script>
    <!-- Bootstrap Select -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>
    <!-- Our Scripts -->
    <script src="js/gc.js"></script>
    <script src="js/requests.js"></script>
    <script src="js/tools.js"></script>
    <!-- Dictionary -->
    <script src="js/dictionary.js"></script>

    <!--#endregion -->

    <script>
        let gcToken;

        let requestId = getUrlParameter("id");
        if (requestId)
            $('#requestId')[0].innerHTML = "requestId: " + requestId;
        else
            $('#requestId')[0].innerHTML = "not related to rapid request"


        init();
        async function init() {

            try {
                await getMe();
                if (!maintenanceMode) $("#submit").attr('disabled', false);
            } catch (error) {
                showMessage(error.hasOwnProperty('message') ? error.message : `Unable to login to Genesys Cloud ${JSON.stringify(error)}`, true);
                $("#submit").attr('disabled', true);
                return
            }

            gcToken = userInfo.token
            localStorage.setItem("gcToken", gcToken);
            localStorage.setItem("userName", userInfo.name);

            // Populate user info
            $("#requesterName").val(userInfo.name);
            $("#requesterEmail").val(userInfo.mail);
            $("#requesterPhoneNumber").val(userInfo.phone);

            // Show Admin fields?

            if (userInfo.groups.some(g => adminGroups["super"].includes(g))) {
                console.log('Show super admin stuff')
                $(".admin").show();
                $(".admin").removeAttr('hidden');
                $("#reviewRequestsButton").attr("href", "requests.html?region=super-user");
                $("#regionBadge").text('super-user');
            } else if (userInfo.groups.some(g => adminGroups["EMEA"].includes(g))) {
                console.log('Show admin stuff')
                $(".admin").show();
                $(".admin").removeAttr('hidden');
                $("#reviewRequestsButton").attr("href", "requests.html?region=EMEA");
                $("#regionBadge").text('EMEA');
            } else if (userInfo.groups.some(g => adminGroups["NA"].includes(g))) {
                console.log('Show admin stuff')
                $(".admin").show();
                $(".admin").removeAttr('hidden');
                $("#reviewRequestsButton").attr("href", "requests.html?region=NA");
                $("#regionBadge").text('NA');
            } else if (userInfo.groups.some(g => adminGroups["APAC"].includes(g))) {
                console.log('Show admin stuff')
                $(".admin").show();
                $(".admin").removeAttr('hidden');
                $("#reviewRequestsButton").attr("href", "requests.html?region=APAC");
                $("#regionBadge").text('APAC');
            } else if (userInfo.groups.some(g => adminGroups["LATAM"].includes(g))) {
                console.log('Show admin stuff')
                $(".admin").show();
                $(".admin").removeAttr('hidden');
                $("#reviewRequestsButton").attr("href", "requests.html?region=LATAM");
                $("#regionBadge").text('LATAM');
            } else {
                console.log('Hide admin stuff')
                $(".admin").hide();
                $(".admin").attr('hidden', true);
                $("#regionBadge").text('');
                $("#reviewRequestsButton").hide();
            }
        }

        function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
        };


    </script>

    <!--Coollabs -->
    <script async defer src="https://cdn.coollabs.io/save.js"></script>

</body>

</html>