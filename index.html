<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <title>CCC Request Form</title>
    <link rel="shortcut icon" href="/favicon.ico">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Bootstrap DatePicker -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker3.min.css" integrity="sha256-FAOaXTpl90/K8cXmSdsskbQN3nKYulhCpPbcFzGTWKI=" crossorigin="anonymous" />
    <!-- jQuery Toast -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.css" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand" href="#">
            <img src="images/genesys.png" width="30" height="30" class="d-inline-block align-top" alt="">
            Cloud Competency Center Request Form
        </a>
        <a href="#" id="reviewRequestsButton" class="admin btn btn-primary">Review Requests</a>
    </nav>

    <div class="container-fluid">
        <br>
        <div class="form-row">
            <div class="form-group col-sm-8">

                <form id="modal-form">
                    <div class="form-row">
                        <div class="form-group col-md-5">
                            <label for="region">Region</label>
                            <select id="region" name="region" class="form-control" required>
                                <option value="" disabled selected>Select a Region</option>
                                <option value="APAC">APAC</option>
                                <option value="EMEA">EMEA</option>
                                <option value="LATAM">LATAM</option>
                                <option value="NA">North America</option>
                            </select>
                        </div>
                        <div class="form-group col-md-5">
                            <label for="subRegion">Sub-Region</label>
                            <select id="subRegion" name="subRegion" class="form-control" required>
                                <option value="" disabled selected>Select a Sub-Region</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-5">
                            <label for="product">Product</label>
                            <select id="product" name="product" class="form-control" required>
                                <option value="" disabled selected>Select a Product</option>
                                <option value="Genesys Cloud">Genesys Cloud</option>
                                <option value="Genesys Engage">Genesys Engage</option>
                                <option value="Genesys Engage Cloud">Genesys Engage Cloud</option>
                                <option value="PureConnect">PureConnect</option>
                            </select>
                        </div>
                        <div class="form-group col-md-5">
                            <label for="requestType">Request Type</label>
                            <select id="requestType" name="requestType" class="form-control" required>
                                <option value="" disabled selected>Select a Request Type</option>
                                <option value="Additional Privacy Support">Additional Privacy Support</option>
                                <option value="Additional Security Support">Additional Security Support</option>
                                <option value="Associate SC & AE Enablement">Associate SC & AE Enablement</option>
                                <option value="Cloud Migrations">Cloud Migrations</option>
                                <option value="Critical Situation Management">Critical Situation Management</option>
                                <option value="End to End Partner Enablement">End to End Partner Enablement</option>
                                <option value="Innovation (Custom Demos, Integrations, Beta Testing)">Innovation (Custom
                                    Demos,
                                    Integrations, Beta Testing)</option>
                                <option value="Must Win/Strategic Opportunity Support">Must Win/Strategic Opportunity
                                    Support
                                </option>
                                <option value="Partner Enablement">Partner Enablement (Summits/Events/Webinars)</option>
                                <option value="POCs & Pilots for Strategic Opportunities">POCs & Pilots for Strategic
                                    Opportunities</option>
                                <option value="Technical Design/Architecture Review">Technical Design/Architecture
                                    Review
                                </option>
                                <option value="Test Drive">Test Drive</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-5">
                            <label for="requesterName">Requester Name</label>
                            <input type="text" class="form-control" id="requesterName" name="requesterName" placeholder="Your Name" required>
                        </div>
                        <div class="form-group col-md-5">
                            <label for="requesterEmail">Requester Email</label>
                            <input type="text" class="form-control" id="requesterEmail" name="requesterEmail" placeholder="Your Email Address" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-5">
                            <label for="requesterPhoneNumber">Requester Phone #</label>
                            <input type="text" class="form-control" id="requesterPhoneNumber" name="requesterPhoneNumber" placeholder="Your Phone Number" required>
                        </div>
                        <div class="form-group col-md-2">
                            <label for="datepicker">Need Completed By</label>
                            <div class="input-group date">
                                <input type="text" id="datepicker" class="form-control" required />
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-10">
                            <label for="description">Description</label>
                            <textarea class="form-control" id="description" name="description" placeholder="Describe your request" required></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-10">
                            <label for="partnerCustomerName">Partner and/or Customer Name</label>
                            <input type="text" class="form-control" id="partnerCustomerName" name="partnerCustomerName" placeholder="Partner and/or Customer Name" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-10">
                            <label for="salesforceAccountOpportunity">Salesforce Account / Opportunity URL</label>
                            <input type="text" class="form-control" id="salesforceAccountOpportunity" name="salesforceAccountOpportunity" placeholder="Link to Salesforce opportunity or account" required>
                        </div>
                    </div>
                </form>

                <br>
                <button type="submit" id="submit" class="btn btn-primary">Submit</button>

            </div>
            <div class="form-group col-sm-4">
                <center>
                    <H3>Welcome to the Competence Centre Request Form.</H3>
                </center>
                <p>
                    This form can be used to request assistance on a variety of topics across different product types.
                </p>
                <p>
                    Fill out the form as required. Some fields are automatically completed using your Genesys Cloud
                    details.
                    Press Submit to submit the request or Cancel to cancel the request.</p>
                <ol>
                    <li>Region</li>
                    <ul><i>Enter the region you are located in.</i></ul>
                    <li>Sub-region</li>
                    <ul><i>Enter the sub-region you are located in.</i></ul>
                    <li>Need Completed By</li>
                    <ul><i>Enter a date you require the work completed. Please note, this is not a guarantee and will be
                            discussed with the Competence Centre Program Manager when they contact you.</i></ul>
                    <li>Request Type</li>
                    <ul><i>Enter the request type you require. A description of requests is given below. Please note
                            that not all request types are available in every region.</i></ul>
                    <li>Request Description</li>
                    <ul><i>Enter a brief summary of the work required. Your Competence Centre Program Manager will
                            contact you to discuss the request further.</i></ul>
                    <li>Partner and/or Customer Name</li>
                    <ul><i>If applicable, enter the Partner and/or Customer name the request is related to.</i></ul>
                    <li>SFDC URL (Account or Opportunity)</li>
                    <ul><i>If applicable, provide the link to the account or opportunity in Salesforce. This will
                            provide the Competence Centre Program Manager with more background and will help with your
                            resource allocation.</i></ul>
                </ol>

            </div>
        </div>
    </div>


    <noscript>You need to enable JavaScript to run this app.</noscript>
    <!-- Bootstrap core JavaScript-->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <!-- Core plugin JavaScript-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js" integrity="sha256-4iQZ6BVL4qNKlQ27TExEhBN1HFPvAvAMbFavKKosSWQ=" crossorigin="anonymous"></script>
    <!-- Bootstrap DatePicker -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js" integrity="sha256-bqVeqGdJ7h/lYPq6xrPv/YGzMEb6dNxlfiTUHSgRCp8=" crossorigin="anonymous"></script>
    <!-- Genesys Cloud -->
    <script src="https://sdk-cdn.mypurecloud.com/javascript/61.0.0/purecloud-platform-client-v2.min.js"></script>
    <!-- JQuery Validate -->
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/additional-methods.min.js"></script>
    <!-- jQuery Toast -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.js"></script>
    <!-- Our Scripts -->
    <script src="js/gc.js"></script>
    <script src="js/requests.js"></script>
    <script src="js/tools.js"></script>

    <script>

        let regions = {
            APAC: [
                "Asia", "Australia", "New Zeland"
            ],
            EMEA: [
                "Central", "North", "South"
            ],
            LATAM: [
                "Andean", "Brazil", "Mexico", "Southern-Cone"
            ],
            NA: [
                "Central", "Eastern", "Western"
            ]
        }


        let requestsType = {

            EMEA: [
                "Cloud Migrations", "Innovation (Custom Demos, Integrations, Beta Testing)", "Must Win/Strategic Opportunity Support", "POCs & Pilots for Strategic Opportunities", "Technical Design/Architecture Review", "Other"
            ],
            Default: [
                "Additional Privacy Support", "Additional Security Support", "Associate SC & AE Enablement", "Cloud Migrations", "Critical Situation Management", "End to End Partner Enablement", "Innovation (Custom Demos, Integrations, Beta Testing)", "Must Win/Strategic Opportunity Support", "Partner Enablement (Summits/Events/Webinars)", "POCs & Pilots for Strategic Opportunities", "Technical Design/Architecture Review", "Test Drive", "Other"
            ]

        }


        let adminGroups = {
            "EMEA": [
                "4bfbc98d-35d6-4a85-85f9-4e661c1a32c0"
            ],
            "NA": [
                "1234"
            ],
            "LATAM": [
                "1234"
            ],
            "APAC": [
                "1234"
            ]
        };

        $(function () {
            $("#datepicker").datepicker({
                daysOfWeekDisabled: "0,6",
                todayHighlight: true,
                autoclose: true,
                startDate: new Date()
            });
        });

        init();
        async function init() {
            var userInfo = await getMe();

            // Populate user info
            $("#requesterName").val(userInfo.name);
            $("#requesterEmail").val(userInfo.mail);
            $("#requesterPhoneNumber").val(userInfo.phone);

            // Show Admin fields?
            if (userInfo.groups.some(g => adminGroups["EMEA"].includes(g))) {
                $(".admin").show();
                $("#reviewRequestsButton").attr("href", "requests.html?region=EMEA");
            } else if (userInfo.groups.some(g => adminGroups["NA"].includes(g))) {
                $(".admin").show();
                $("#reviewRequestsButton").attr("href", "requests.html?region=NA");
            } else if (userInfo.groups.some(g => adminGroups["APAC"].includes(g))) {
                $(".admin").show();
                $("#reviewRequestsButton").attr("href", "requests.html?region=APAC");
            } else if (userInfo.groups.some(g => adminGroups["LATAM"].includes(g))) {
                $(".admin").show();
                $("#reviewRequestsButton").attr("href", "requests.html?region=LATAM");
            } else {
                $(".admin").hide();
            }
        }

        $("#region").on("change", () => {
            $("#subRegion").empty();
            for (let subregion of regions[$("#region").val()]) {
                $("<option/>", { value: subregion }).text(subregion).appendTo("#subRegion");
            }
            updateRequestTypeBasedOnRegion();
        });

        $("#product").on("change", () => {
            updateRequestTypeBasedOnRegion();
        });

        function updateRequestTypeBasedOnRegion() {
            if ($("#region").val() === "EMEA" && ($("#product").val() == "Genesys Engage" || $("#product").val() == "Genesys Engage Cloud")) {
                $("#requestType").empty();
                for (let aRequest of requestsType[$("#region").val()]) {
                    $("<option/>", { value: aRequest }).text(aRequest).appendTo("#requestType");
                }
            } else {
                $("#requestType").empty();
                for (let aRequest of requestsType["Default"]) {
                    $("<option/>", { value: aRequest }).text(aRequest).appendTo("#requestType");
                }
            }
        }

        $("#modal-form").validate({
            errorClass: "text-danger",
            successClass: "test-success"
        });

        $("#submit").on("click", async (e) => {
            e.preventDefault();
            if (!$("#modal-form").valid()) {
                showMessage("Missing or invalid fields", true);
                return;
            }

            let region = $("#region").val();
            let subRegion = $("#subRegion").val();
            let product = $("#product").val();
            let requestType = $("#requestType").val();
            let requesterName = $("#requesterName").val();
            let requesterEmail = $("#requesterEmail").val();
            let requesterPhoneNumber = $("#requesterPhoneNumber").val();
            let needCompletedBy = moment($("#datepicker").datepicker('getDate')).format("YYYY-MM-DDT00:00:00.000") + "Z";
            let description = $("#description").val();
            let partnerCustomerName = $("#partnerCustomerName").val();
            let salesforceAccountOpportunity = $("#salesforceAccountOpportunity").val();

            console.log(`Region: ${region}, subRegion: ${subRegion}, Product: ${product}, Request Type: ${requestType}, Requester Name: ${requesterName}, Requester Email: ${requesterEmail}, Requester Phone Number: ${requesterPhoneNumber}, Need Completed By: ${needCompletedBy}, Description: ${description}, Partner or Customer Name: ${partnerCustomerName}, Salesforce Opportunity: ${salesforceAccountOpportunity}`);

            try {
                await postRequests(region, subRegion, product, requestType, requesterName, requesterEmail, requesterPhoneNumber, needCompletedBy, description, partnerCustomerName, salesforceAccountOpportunity);
                console.log('Success!');
                showMessage("Request submitted. Thanks!");
                sendNotification(`> :loudspeaker: New CCC Request for **${product}** received from [@${userInfo.name}](#/person/${userInfo.id}) (${requestType}) `, region);
            } catch (error) {
                console.error(error);
                showMessage(error, true);
            }
        });

    </script>

</body>

</html>